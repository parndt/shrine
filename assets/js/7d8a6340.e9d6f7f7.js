"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6273],{3905:(e,a,t)=>{t.d(a,{Zo:()=>i,kt:()=>f});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},p=Object.keys(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=n.createContext({}),d=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},i=function(e){var a=d(e.components);return n.createElement(l.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,p=e.originalType,l=e.parentName,i=o(e,["components","mdxType","originalType","parentName"]),c=d(t),u=r,f=c["".concat(l,".").concat(u)]||c[u]||m[u]||p;return t?n.createElement(f,s(s({ref:a},i),{},{components:t})):n.createElement(f,s({ref:a},i))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var p=t.length,s=new Array(p);s[0]=u;var o={};for(var l in a)hasOwnProperty.call(a,l)&&(o[l]=a[l]);o.originalType=e,o[c]="string"==typeof e?e:r,s[1]=o;for(var d=2;d<p;d++)s[d]=t[d];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},3599:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>f,frontMatter:()=>o,metadata:()=>d,toc:()=>c});var n=t(7462),r=t(3366),p=(t(7294),t(3905)),s=["components"],o={title:"Refresh Metadata"},l=void 0,d={unversionedId:"plugins/refresh_metadata",id:"plugins/refresh_metadata",title:"Refresh Metadata",description:"The refreshmetadata plugin allows you to re-extract",source:"@site/../doc/plugins/refresh_metadata.md",sourceDirName:"plugins",slug:"/plugins/refresh_metadata",permalink:"/docs/plugins/refresh_metadata",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/plugins/refresh_metadata.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1573669120,formattedLastUpdatedAt:"Nov 13, 2019",frontMatter:{title:"Refresh Metadata"},sidebar:"plugins",previous:{title:"Metadata Attributes",permalink:"/docs/plugins/metadata_attributes"},next:{title:"Restore Cached Data",permalink:"/docs/plugins/restore_cached_data"}},i={},c=[{value:"Attacher",id:"attacher",level:2},{value:"Uploaded File",id:"uploaded-file",level:2}],m={toc:c},u="wrapper";function f(e){var a=e.components,t=(0,r.Z)(e,s);return(0,p.kt)(u,(0,n.Z)({},m,t,{components:a,mdxType:"MDXLayout"}),(0,p.kt)("p",null,"The ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/blob/master/lib/shrine/plugins/refresh_metadata.rb"},(0,p.kt)("inlineCode",{parentName:"a"},"refresh_metadata"))," plugin allows you to re-extract\nmetadata from an uploaded file."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":refresh_metadata"))))),(0,p.kt)("p",null,"It provides ",(0,p.kt)("inlineCode",{parentName:"p"},"#refresh_metadata!")," method, which triggers metadata extraction\n(calls ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine#extract_metadata"),") with the uploaded file opened for reading,\nand updates the existing metadata hash with the results. This can be done\non the ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," or the ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile")," level."),(0,p.kt)("h2",{id:"attacher"},"Attacher"),(0,p.kt)("p",null,"Calling ",(0,p.kt)("inlineCode",{parentName:"p"},"#refresh_metadata!")," on a ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object will re-extract\nmetadata of the attached file, and when used with a ",(0,p.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},"model"),", it will write new\nfile data back into the attachment attribute."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.refresh_metadata!")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file.metadata    "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# re-extracted metadata")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.record.file_data "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> '{ ... data with updated metadata ... }'"))))),(0,p.kt)("p",null,"The ",(0,p.kt)("inlineCode",{parentName:"p"},"Attacher#context")," hash will be forwarded to metadata extraction, as well\nas any options that you pass in."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# via context")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.context["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":foo"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.refresh_metadata! "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'# passes `{ foo: "bar" }` options to metadata extraction')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# via arguments")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.refresh_metadata!(foo"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'# passes `{ foo: "bar" }` options to metadata extraction'))))),(0,p.kt)("h2",{id:"uploaded-file"},"Uploaded File"),(0,p.kt)("p",null,"The ",(0,p.kt)("inlineCode",{parentName:"p"},"#refresh_metadata!")," method can be called on a ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile")," object\nas well."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.refresh_metadata!")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.metadata "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# re-extracted metadata"))))),(0,p.kt)("p",null,"If the uploaded file is not open, it is opened before and closed after metadata\nextraction. For remote storage services this will make an HTTP request.\nHowever, only the portion of the file needed for extracting metadata will be\ndownloaded."),(0,p.kt)("p",null,"If the uploaded file is already open, it is passed to metadata extraction as\nis."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file."),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  uploaded_file.refresh_metadata! "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# uses the already opened file")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)("p",null,"Any options passed in will be forwarded to metadata extraction:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.refresh_metadata!(foo"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'# passes `{ foo: "bar" }` options to metadata extraction'))))))}f.isMDXComponent=!0}}]);