"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4161],{3905:(a,e,n)=>{n.d(e,{Zo:()=>m,kt:()=>k});var t=n(7294);function s(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}function p(a,e){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.push.apply(n,t)}return n}function r(a){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){s(a,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))}))}return a}function l(a,e){if(null==a)return{};var n,t,s=function(a,e){if(null==a)return{};var n,t,s={},p=Object.keys(a);for(t=0;t<p.length;t++)n=p[t],e.indexOf(n)>=0||(s[n]=a[n]);return s}(a,e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(a);for(t=0;t<p.length;t++)n=p[t],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(a,n)&&(s[n]=a[n])}return s}var o=t.createContext({}),c=function(a){var e=t.useContext(o),n=e;return a&&(n="function"==typeof a?a(e):r(r({},e),a)),n},m=function(a){var e=c(a.components);return t.createElement(o.Provider,{value:e},a.children)},i="mdxType",F={inlineCode:"code",wrapper:function(a){var e=a.children;return t.createElement(t.Fragment,{},e)}},N=t.forwardRef((function(a,e){var n=a.components,s=a.mdxType,p=a.originalType,o=a.parentName,m=l(a,["components","mdxType","originalType","parentName"]),i=c(n),N=s,k=i["".concat(o,".").concat(N)]||i[N]||F[N]||p;return n?t.createElement(k,r(r({ref:e},m),{},{components:n})):t.createElement(k,r({ref:e},m))}));function k(a,e){var n=arguments,s=e&&e.mdxType;if("string"==typeof a||s){var p=n.length,r=new Array(p);r[0]=N;var l={};for(var o in e)hasOwnProperty.call(e,o)&&(l[o]=e[o]);l.originalType=a,l[i]="string"==typeof a?a:s,r[1]=l;for(var c=2;c<p;c++)r[c]=n[c];return t.createElement.apply(null,r)}return t.createElement.apply(null,n)}N.displayName="MDXCreateElement"},6952:(a,e,n)=>{n.r(e),n.d(e,{assets:()=>m,contentTitle:()=>o,default:()=>k,frontMatter:()=>l,metadata:()=>c,toc:()=>i});var t=n(7462),s=n(3366),p=(n(7294),n(3905)),r=["components"],l={title:"Versions"},o=void 0,c={unversionedId:"plugins/versions",id:"plugins/versions",title:"Versions",description:"The versions plugin enables your uploader to deal with versions,",source:"@site/../doc/plugins/versions.md",sourceDirName:"plugins",slug:"/plugins/versions",permalink:"/docs/plugins/versions",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/plugins/versions.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1579102350,formattedLastUpdatedAt:"Jan 15, 2020",frontMatter:{title:"Versions"}},m={},i=[{value:"Fallbacks",id:"fallbacks",level:2},{value:"Arrays",id:"arrays",level:2},{value:"Original file",id:"original-file",level:2},{value:"Context",id:"context",level:2}],F={toc:i},N="wrapper";function k(a){var e=a.components,n=(0,s.Z)(a,r);return(0,p.kt)(N,(0,t.Z)({},F,n,{components:e,mdxType:"MDXLayout"}),(0,p.kt)("p",null,"The ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/blob/master/lib/shrine/plugins/versions.rb"},(0,p.kt)("inlineCode",{parentName:"a"},"versions"))," plugin enables your uploader to deal with versions,\nby allowing you to return a Hash of files when processing."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":versions"))))),(0,p.kt)("p",null,"Here is an example of processing image thumbnails using the ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/janko/image_processing"},"image_processing"),"\ngem:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing/mini_magick"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":processing")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"process("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io, "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"options|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  versions "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { original"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," io } "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# retain original")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  io.download "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |original|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    pipeline "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageProcessing"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MiniMagick"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".source(original)")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    versions["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," pipeline.resize_to_limit!("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"800"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"800"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    versions["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":medium"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," pipeline.resize_to_limit!("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"500"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"500"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    versions["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":small"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," pipeline.resize_to_limit!("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"300"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"300"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  versions "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# return the hash of processed files")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)("p",null,"You probably want to load the ",(0,p.kt)("inlineCode",{parentName:"p"},"delete_raw")," plugin to automatically delete\nprocessed files after they have been uploaded."),(0,p.kt)("p",null,"Now when you access the stored attachment through the model, a hash of uploaded\nfiles will be returned:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_data "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=>")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# '{")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "original": {"id":"0gsdf.jpg", "storage":"store", "metadata":{...}},')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "large": {"id":"lg043.jpg", "storage":"store", "metadata":{...}},')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "medium": {"id":"kd9fk.jpg", "storage":"store", "metadata":{...}},')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "small": {"id":"932fl.jpg", "storage":"store", "metadata":{...}}')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# }'")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=>")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# {")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :original => #<Shrine::UploadedFile id=0gsdf.jpg" ...}>,')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :large    => #<Shrine::UploadedFile id=lg043.jpg" ...}>,')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :medium   => #<Shrine::UploadedFile id=kd9fk.jpg" ...}>,')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :small    => #<Shrine::UploadedFile id=932fl.jpg" ...}>,')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# }")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":medium"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]     "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":medium"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"].url "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "/uploads/store/lg043.jpg"'))))),(0,p.kt)("p",null,"The plugin also extends the ",(0,p.kt)("inlineCode",{parentName:"p"},"Attacher#url")," to accept versions:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_url("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_url("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":small"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", public"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# with URL options"))))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"Shrine.uploaded_file")," will also instantiate a hash of ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile"),"\nobjects if given data with versions. If you want to apply a change to all files\nin an attachment, regardless of whether it consists of a single file or a hash\nof versions, you can pass a block to ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine.uploaded_file")," and it will yield\neach file:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".uploaded_file(attachment_data) "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |uploaded_file|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)("h2",{id:"fallbacks"},"Fallbacks"),(0,p.kt)("p",null,"If versions are processed in a background job, there will be a period where the\nuser will browse the site before versions have finished processing. In this\nperiod ",(0,p.kt)("inlineCode",{parentName:"p"},"Attacher#url")," will by default fall back to the original file."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_url("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# falls back to `user.avatar_url`"))))),(0,p.kt)("p",null,"This behaviour is convenient if you want to gracefully degrade to the cached\nfile until the background job has finished processing. However, if you would\nrather provide your own default URLs for versions, you can disable this\nfallback:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":versions"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", fallback_to_original"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"false"))))),(0,p.kt)("p",null,"If you already have some versions processed in the foreground after a\nbackground job is kicked off (with the ",(0,p.kt)("inlineCode",{parentName:"p"},"recache")," plugin), you can have URLs for\nversions that are yet to be processed fall back to existing versions:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":versions"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", fallbacks"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"thumb_2x "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumb"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"large_2x "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ... (background job is kicked off)")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_url("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumb_2x"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# returns :thumb URL until :thumb_2x becomes available")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_url("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large_2x"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# returns :large URL until :large_2x becomes available"))))),(0,p.kt)("h2",{id:"arrays"},"Arrays"),(0,p.kt)("p",null,"In addition to Hashes, the plugin also supports Arrays of files. For example,\nyou might want to split a PDf into pages:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"process("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io, "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"options|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  versions "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { pages"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," [] }")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  io.download "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |pdf|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    page_count "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MiniMagick"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(pdf.path).pages.count")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    pipeline   "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageProcessing"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MiniMagick"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".source(pdf).convert("),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"jpg"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    page_count.times "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |page_number|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      versions["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":pages"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," pipeline.loader(page"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," page_number).call")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  versions")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)("p",null,"You can also combine Hashes and Arrays, there is no limit to the level of\nnesting."),(0,p.kt)("h2",{id:"original-file"},"Original file"),(0,p.kt)("p",null,"It's recommended to always keep the original file after processing versions,\nwhich you can do by adding the yielded ",(0,p.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile")," object as one of\nthe versions, by convention named ",(0,p.kt)("inlineCode",{parentName:"p"},":original"),":"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"process("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io, "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"options|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# processing thumbnail")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  { original"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," io, thumbnail"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," thumbnail }")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)("p",null,"If both temporary and permanent storage are Amazon S3, the cached original will\nsimply be copied over to permanent storage (without any downloading and\nreuploading), so in these cases the performance impact of storing the original\nfile in addition to processed versions is neglibible."),(0,p.kt)("h2",{id:"context"},"Context"),(0,p.kt)("p",null,"The version name will be available via ",(0,p.kt)("inlineCode",{parentName:"p"},":version")," when generating location or a\ndefault URL."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#62E884"}},"generate_location"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"io"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"version"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"uploads/"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"version"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"-"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{super}"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".default_url "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |version"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/images/defaults/"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"version"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},".jpg"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))}k.isMDXComponent=!0}}]);