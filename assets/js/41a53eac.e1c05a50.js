"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6468],{3905:(a,e,t)=>{t.d(e,{Zo:()=>m,kt:()=>N});var n=t(7294);function p(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function r(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,n)}return t}function s(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){p(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function l(a,e){if(null==a)return{};var t,n,p=function(a,e){if(null==a)return{};var t,n,p={},r=Object.keys(a);for(n=0;n<r.length;n++)t=r[n],e.indexOf(t)>=0||(p[t]=a[t]);return p}(a,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);for(n=0;n<r.length;n++)t=r[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(p[t]=a[t])}return p}var o=n.createContext({}),c=function(a){var e=n.useContext(o),t=e;return a&&(t="function"==typeof a?a(e):s(s({},e),a)),t},m=function(a){var e=c(a.components);return n.createElement(o.Provider,{value:e},a.children)},d="mdxType",i={inlineCode:"code",wrapper:function(a){var e=a.children;return n.createElement(n.Fragment,{},e)}},k=n.forwardRef((function(a,e){var t=a.components,p=a.mdxType,r=a.originalType,o=a.parentName,m=l(a,["components","mdxType","originalType","parentName"]),d=c(t),k=p,N=d["".concat(o,".").concat(k)]||d[k]||i[k]||r;return t?n.createElement(N,s(s({ref:e},m),{},{components:t})):n.createElement(N,s({ref:e},m))}));function N(a,e){var t=arguments,p=e&&e.mdxType;if("string"==typeof a||p){var r=t.length,s=new Array(r);s[0]=k;var l={};for(var o in e)hasOwnProperty.call(e,o)&&(l[o]=e[o]);l.originalType=a,l[d]="string"==typeof a?a:p,s[1]=l;for(var c=2;c<r;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}k.displayName="MDXCreateElement"},6898:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>m,contentTitle:()=>o,default:()=>N,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var n=t(7462),p=t(3366),r=(t(7294),t(3905)),s=["components"],l={title:"Using Attacher"},o=void 0,c={unversionedId:"attacher",id:"attacher",title:"Using Attacher",description:"This guide explains what is Shrine::Attacher and how to use it.",source:"@site/../doc/attacher.md",sourceDirName:".",slug:"/attacher",permalink:"/docs/attacher",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/attacher.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1578769044,formattedLastUpdatedAt:"Jan 11, 2020",frontMatter:{title:"Using Attacher"},sidebar:"guides",previous:{title:"Retrieving Uploads",permalink:"/docs/retrieving-uploads"},next:{title:"File System",permalink:"/docs/storage/file-system"}},m={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Storage",id:"storage",level:2},{value:"Attaching",id:"attaching",level:2},{value:"Attaching cached",id:"attaching-cached",level:3},{value:"Attaching stored",id:"attaching-stored",level:3},{value:"Uploading",id:"uploading",level:3},{value:"Changes",id:"changes",level:3},{value:"Finalizing",id:"finalizing",level:2},{value:"Promoting",id:"promoting",level:3},{value:"Replacing",id:"replacing",level:3},{value:"Retrieving",id:"retrieving",level:2},{value:"File",id:"file",level:3},{value:"Attached",id:"attached",level:3},{value:"URL",id:"url",level:3},{value:"Data",id:"data",level:3},{value:"Deleting",id:"deleting",level:2},{value:"Context",id:"context",level:2}],i={toc:d},k="wrapper";function N(a){var e=a.components,t=(0,p.Z)(a,s);return(0,r.kt)(k,(0,n.Z)({},i,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide explains what is ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," and how to use it."),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"The attachment logic is handled by a ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object. The\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment")," module simply provides a convenience layer around a\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object, which can be accessed via the ",(0,r.kt)("inlineCode",{parentName:"p"},"#<name>_attacher"),"\nattribute."),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<ImageUploader::Attacher>"))))),(0,r.kt)("p",null,"We can also instantiate the same ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object directly:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# called by `photo.image`")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.url  "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# called by `photo.image_url`"))))),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},(0,r.kt)("inlineCode",{parentName:"a"},"model")),", ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/entity"},(0,r.kt)("inlineCode",{parentName:"a"},"entity")),", and ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/column"},(0,r.kt)("inlineCode",{parentName:"a"},"column"))," plugins\nprovide additional ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," methods (such as\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher.from_model")," we see above), but in this guide we'll focus only\non the core ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," methods."),(0,r.kt)("p",null,"So, we'll assume a ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object not backed by any model/entity:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"))))),(0,r.kt)("h2",{id:"storage"},"Storage"),(0,r.kt)("p",null,"By default, an ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher")," will use the ",(0,r.kt)("inlineCode",{parentName:"p"},":cache")," storage as the ",(0,r.kt)("strong",{parentName:"p"},"temporary"),"\nstorage, and the ",(0,r.kt)("inlineCode",{parentName:"p"},":store")," storage as the ",(0,r.kt)("strong",{parentName:"p"},"permanent")," storage."),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Memory"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Memory"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.cache_key "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :cache")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.store_key "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store"))))),(0,r.kt)("p",null,"We can also change the default storage:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.cache_key "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :other_cache")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.store_key "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :other_store"))))),(0,r.kt)("p",null,"You can also change default attacher options on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment"),"\nmodule:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#cache")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#store")," methods will retrieve corresponding\nuploaders:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.cache "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<MyUploader @storage_key=:cache>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.store "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<MyUploader @storage_key=:store>"))))),(0,r.kt)("h2",{id:"attaching"},"Attaching"),(0,r.kt)("h3",{id:"attaching-cached"},"Attaching cached"),(0,r.kt)("p",null,"For attaching files submitted via a web form, ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#assign")," can be used:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign(file)"))))),(0,r.kt)("p",null,"If given a raw file, it will upload it to temporary storage:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign(file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="asdf.jpg" storage=:cache ...>'))))),(0,r.kt)("p",null,"If given cached file data (JSON or Hash), it will set the cached file:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"asdf.jpg","storage":"cache","metadata":{...}}'),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="asdf.jpg" storage=:cache ...>'))))),(0,r.kt)("p",null,"If given an empty string, it will no-op:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'""'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# no-op"))))),(0,r.kt)("p",null,"If given ",(0,r.kt)("inlineCode",{parentName:"p"},"nil"),", it will clear the attached file:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> <Shrine::UploadedFile>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign("),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil"))))),(0,r.kt)("p",null,"This plays nicely with the recommended HTML form fields for the attachment. If\nyou're not using the ",(0,r.kt)("inlineCode",{parentName:"p"},"hidden")," form field (and therefore don't need empty\nstrings to be handled), you can also use ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach_cached"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# uploads file to cache")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached(file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# sets cached file")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"asdf.jpg","storage":"cache","metadata":{...}}'),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached({ "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"id"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"asdf.jpg"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { ... } })")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached({ id"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"asdf.jpg"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { ... } })")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# unsets attached file")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached("),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")"))))),(0,r.kt)("h3",{id:"attaching-stored"},"Attaching stored"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach")," method uploads a given file to permanent storage:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="asdf.jpg" storage=:store ...>'))))),(0,r.kt)("p",null,"This method is useful when attaching files from scripts, where validation\ndoesn't need to be performed, and where temporary storage can be skipped."),(0,r.kt)("p",null,"You can specify a different destination storage with the ",(0,r.kt)("inlineCode",{parentName:"p"},":storage")," option:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(file, storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="asdf.jpg" storage=:other_store ...>'))))),(0,r.kt)("p",null,"Any additional options passed to ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach_cached"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#assign")," are forwarded to the uploader:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(file, metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"foo"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," })       "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adding metadata")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(file, upload_options"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { acl"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"private"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," }) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# setting upload options")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(file, location"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"path/to/file"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")           "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# setting upload location"))))),(0,r.kt)("h3",{id:"uploading"},"Uploading"),(0,r.kt)("p",null,"If you want to upload a file to without attaching it, you can use\n",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#upload"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file)               "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:store ...>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")       "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:cache ...>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_store"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:other_store ...>"))))),(0,r.kt)("p",null,"This is useful if you want to attacher ",(0,r.kt)("a",{parentName:"p",href:"#context"},"context")," such as ",(0,r.kt)("inlineCode",{parentName:"p"},":record"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},":name")," to be automatically passed to the uploader."),(0,r.kt)("p",null,"You can also pass additional options for ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine#upload"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file, metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"foo"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," })       "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adding metadata")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file, upload_options"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { acl"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"private"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," }) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# setting upload options")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.upload(file, location"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"path/to/file"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")           "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# setting upload location"))))),(0,r.kt)("h3",{id:"changes"},"Changes"),(0,r.kt)("p",null,"When a new file is attached, calling ",(0,r.kt)("a",{parentName:"p",href:"#finalization"},(0,r.kt)("inlineCode",{parentName:"a"},"Attacher#finalize"))," will\nperform additional actions such as promotion and deleting any previous file.\nIt will also trigger ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/validation"},"validation"),"."),(0,r.kt)("p",null,"You can check whether a new file has been attached with ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#changed?"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.changed? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true"))))),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#change")," to attach an ",(0,r.kt)("inlineCode",{parentName:"p"},"UploadedFile")," object as is:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="foo" ...>')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.change(uploaded_file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="foo" ...>')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.changed? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true"))))),(0,r.kt)("p",null,"If you want to attach a file without triggering dirty tracking or validation,\nyou can use ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#set"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="foo" ...>')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.set(uploaded_file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="foo" ...>')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.changed? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false"))))),(0,r.kt)("h2",{id:"finalizing"},"Finalizing"),(0,r.kt)("p",null,"After the file is attached (with ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#assign"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach_cached"),",\nor ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach"),'), and data has been validated, the attachment can be\n"finalized":'),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.finalize"))))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#finalize")," method performs ",(0,r.kt)("a",{parentName:"p",href:"#promoting"},"promoting")," and\n",(0,r.kt)("a",{parentName:"p",href:"#replacing"},"replacing"),". It also clears dirty tracking:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.changed? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.finalize")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.changed? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false"))))),(0,r.kt)("h3",{id:"promoting"},"Promoting"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#finalize")," checks if the attached file has been uploaded to temporary\nstorage, and in this case uploads it to permanent storage."),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached(io)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.finalize "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# uploads attached file to permanent storage")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:store ...>"))))),(0,r.kt)("p",null,"Internally it calls ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#promote_cached"),", which you can call directly if\nyou want to pass any promote options:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:cache ...>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.promote_cached "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# uploads attached file to permanent storage if new and cached")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile storage=:store ...>"))))),(0,r.kt)("p",null,"You can also call ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#promote")," if you want to upload attached file to\npermanent storage, regardless of whether it's cached or newly attached:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.promote"))))),(0,r.kt)("p",null,"Any options passed to ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#promote_cached")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#promote")," will be\nforwarded to ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine#upload"),"."),(0,r.kt)("h3",{id:"replacing"},"Replacing"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#finalize")," also deletes the previous attached file if any:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"previous_file "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," attacher.file")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(io)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.finalize")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"previous_file.exists? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false"))))),(0,r.kt)("p",null,"Internally it calls ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#destroy_previous")," to do this:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.destroy_previous"))))),(0,r.kt)("h2",{id:"retrieving"},"Retrieving"),(0,r.kt)("h3",{id:"file"},"File"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#file")," is used to retrieve the attached file:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>"))))),(0,r.kt)("p",null,"If no file is attached, ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#file")," returns nil:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil"))))),(0,r.kt)("p",null,"If you want to assert a file is attached, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#file!"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file! "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#~> Shrine::Error: no file is attached"))))),(0,r.kt)("h3",{id:"attached"},"Attached"),(0,r.kt)("p",null,"You can also check whether a file is attached with ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attached?"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attached? "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# returns whether file is attached"))))),(0,r.kt)("p",null,"If you want to check to which storage a file is uploaded to, you can use\n",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#cached?")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#stored?"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(io)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.stored?                "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true (checks current file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.stored?(attacher.file) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true (checks given file)"))))),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach_cached(io)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.cached?                "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true (checks current file)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.cached?(attacher.file) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true (checks given file)"))))),(0,r.kt)("h3",{id:"url"},"URL"),(0,r.kt)("p",null,"The attached file URL can be retrieved with ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#url"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.url "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "https://example.com/file.jpg"'))))),(0,r.kt)("p",null,"If no file is attached, ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#url")," returns ",(0,r.kt)("inlineCode",{parentName:"p"},"nil"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.url "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil"))))),(0,r.kt)("h3",{id:"data"},"Data"),(0,r.kt)("p",null,"You can retrieve plain attached file data with ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#data"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.data "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# {")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "id" => "abc123.jpg",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "storage" => "store",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "metadata" => {')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#     "size" => 223984,')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#     "filename" => "nature.jpg",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#     "mime_type" => "image/jpeg",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#   }")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# }"))))),(0,r.kt)("p",null,"This data can be stored somewhere, and later the attached file can be loaded\nfrom it:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# new attacher")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_data(data)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# existing attacher")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.load_data(data)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>"))))),(0,r.kt)("p",null,"Internally ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#uploaded_file")," is used to convert uploaded file data into\na ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile")," object:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.uploaded_file("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"id"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"..."),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"..."),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { ... }) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.uploaded_file(id"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"..."),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", storage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"..."),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", metadata"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { ... })             "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.uploaded_file("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"...","storage":"...","metadata":{...}}'),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")          "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>"))))),(0,r.kt)("p",null,"You will likely want to use a higher level abstraction for saving and loading\nthis data, see ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/column"},(0,r.kt)("inlineCode",{parentName:"a"},"column")),", ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/entity"},(0,r.kt)("inlineCode",{parentName:"a"},"entity"))," and ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},(0,r.kt)("inlineCode",{parentName:"a"},"model")),"\nplugins for more details."),(0,r.kt)("h2",{id:"deleting"},"Deleting"),(0,r.kt)("p",null,"The attached file can be deleted via ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#destroy_attached"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.destroy_attached"))))),(0,r.kt)("p",null,"This will not delete cached files, to not interrupt any potential\n",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/backgrounding"},"backgrounding")," that might be in process."),(0,r.kt)("p",null,"If you want to delete the attached file regardless of storage it's uploaded to,\nyou can use ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#destroy"),":"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.destroy"))))),(0,r.kt)("h2",{id:"context"},"Context"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#context")," hash is automatically forwarded to the uploader on\n",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#upload"),". When ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},(0,r.kt)("inlineCode",{parentName:"a"},"model"))," or ",(0,r.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},(0,r.kt)("inlineCode",{parentName:"a"},"entity"))," plugin is loaded,\nthis will include ",(0,r.kt)("inlineCode",{parentName:"p"},":record")," and ",(0,r.kt)("inlineCode",{parentName:"p"},":name")," values:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.context "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> { record: #<Photo>, name: :image }"))))),(0,r.kt)("p",null,"You can add here any other parameters you want to forward to the uploader:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.context["),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":foo"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,r.kt)("p",null,"However, it's generally better practice to pass uploader options directly to\n",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#assign"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attach"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#promote")," or any other method\nthat's calling ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#upload"),"."))}N.isMDXComponent=!0}}]);