"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6093],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>N});var n=t(7294);function p(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){p(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,p=function(e,a){if(null==e)return{};var t,n,p={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(p[t]=e[t]);return p}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(p[t]=e[t])}return p}var o=n.createContext({}),m=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},c=function(e){var a=m(e.components);return n.createElement(o.Provider,{value:a},e.children)},i="mdxType",F={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,p=e.mdxType,s=e.originalType,o=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),i=m(t),d=p,N=i["".concat(o,".").concat(d)]||i[d]||F[d]||s;return t?n.createElement(N,l(l({ref:a},c),{},{components:t})):n.createElement(N,l({ref:a},c))}));function N(e,a){var t=arguments,p=a&&a.mdxType;if("string"==typeof e||p){var s=t.length,l=new Array(s);l[0]=d;var r={};for(var o in a)hasOwnProperty.call(a,o)&&(r[o]=a[o]);r.originalType=e,r[i]="string"==typeof e?e:p,l[1]=r;for(var m=2;m<s;m++)l[m]=t[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4204:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>o,default:()=>N,frontMatter:()=>r,metadata:()=>m,toc:()=>i});var n=t(7462),p=t(3366),s=(t(7294),t(3905)),l=["components"],r={title:"Upgrading from Refile"},o=void 0,m={unversionedId:"refile",id:"refile",title:"Upgrading from Refile",description:"This guide is aimed at helping Refile users transition to Shrine, and it consists",source:"@site/../doc/refile.md",sourceDirName:".",slug:"/refile",permalink:"/docs/refile",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/refile.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1645289847,formattedLastUpdatedAt:"Feb 19, 2022",frontMatter:{title:"Upgrading from Refile"},sidebar:"guides",previous:{title:"Upgrading from Paperclip",permalink:"/docs/paperclip"}},c={},i=[{value:"Overview",id:"overview",level:2},{value:"Uploader",id:"uploader",level:3},{value:"URL",id:"url",level:4},{value:"Persistence",id:"persistence",level:3},{value:"Processing",id:"processing",level:3},{value:"Validation",id:"validation",level:3},{value:"Direct uploads",id:"direct-uploads",level:3},{value:"Multiple uploads",id:"multiple-uploads",level:3},{value:"Migrating from Refile",id:"migrating-from-refile",level:2},{value:"1. Add Shrine column",id:"1-add-shrine-column",level:3},{value:"2. Dual write",id:"2-dual-write",level:3},{value:"3. Data migration",id:"3-data-migration",level:3},{value:"4. Rewrite code",id:"4-rewrite-code",level:3},{value:"5. Remove Refile columns",id:"5-remove-refile-columns",level:3},{value:"Refile to Shrine direct mapping",id:"refile-to-shrine-direct-mapping",level:2},{value:"<code>Refile</code>",id:"refile",level:3},{value:"<code>.cache</code>, <code>.store</code>, <code>.backends</code>",id:"cache-store-backends",level:4},{value:"<code>.app</code>, <code>.mount_point</code>, <code>.automount</code>",id:"app-mount_point-automount",level:4},{value:"<code>.allow_uploads_to</code>",id:"allow_uploads_to",level:4},{value:"<code>.logger</code>",id:"logger",level:4},{value:"<code>.processors</code>, <code>.processor</code>",id:"processors-processor",level:4},{value:"<code>.types</code>",id:"types",level:4},{value:"<code>.extract_filename</code>",id:"extract_filename",level:4},{value:"<code>.extract_content_type</code>",id:"extract_content_type",level:4},{value:"<code>.app_url</code>, <code>.upload_url</code>, <code>.attachment_upload_url</code>, <code>.presign_url</code>, <code>.attachment_presign_url</code>",id:"app_url-upload_url-attachment_upload_url-presign_url-attachment_presign_url",level:4},{value:"<code>.attachment_url</code>, <code>.file_url</code>",id:"attachment_url-file_url",level:4},{value:"<code>.host</code>, <code>.cdn_host</code>, <code>.app_host</code>, <code>.allow_downloads_from</code>, <code>allow_origin</code>, <code>.content_max_age</code>",id:"host-cdn_host-app_host-allow_downloads_from-allow_origin-content_max_age",level:4},{value:"<code>.secret_key</code>, <code>.token</code>, <code>.valid_token?</code>",id:"secret_key-token-valid_token",level:4},{value:"<code>Attachment</code>",id:"attachment",level:3},{value:"<code>:extension</code>, <code>:content_type</code>, <code>:type</code>",id:"extension-content_type-type",level:4},{value:"<code>:cache</code>, <code>:store</code>",id:"cache-store",level:4},{value:"<code>:raise_errors</code>",id:"raise_errors",level:4},{value:"<code>accepts_attachments_for</code>",id:"accepts_attachments_for",level:3},{value:"Form helpers",id:"form-helpers",level:3},{value:"<code>attachment_field</code>",id:"attachment_field",level:4},{value:"Model methods",id:"model-methods",level:3},{value:"<code>remove_&lt;attachment&gt;</code>",id:"remove_attachment",level:4},{value:"<code>remote_&lt;attachment&gt;_url</code>",id:"remote_attachment_url",level:4}],F={toc:i},d="wrapper";function N(e){var a=e.components,t=(0,p.Z)(e,l);return(0,s.kt)(d,(0,n.Z)({},F,t,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"This guide is aimed at helping Refile users transition to Shrine, and it consists\nof three parts:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Explanation of the key differences in design between Refile and Shrine"),(0,s.kt)("li",{parentName:"ol"},"Instructions how to migrate an existing app that uses Refile to Shrine"),(0,s.kt)("li",{parentName:"ol"},"Extensive reference of Refile's interface with Shrine equivalents")),(0,s.kt)("h2",{id:"overview"},"Overview"),(0,s.kt)("p",null,'Shrine borrows many great concepts from Refile: Refile\'s "backends" are here\nnamed "storages", it uses the same IO abstraction for uploading and\nrepresenting uploaded files, similar attachment logic, and direct uploads are\nsupported as well.'),(0,s.kt)("h3",{id:"uploader"},"Uploader"),(0,s.kt)("p",null,"While in Refile you work with storages directly, Shrine uses ",(0,s.kt)("em",{parentName:"p"},"uploaders")," which\nwrap storage uploads:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"storage "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"storage "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::Storage::S3>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload(image, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.storage "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::Storage::S3>"))))),(0,s.kt)("p",null,"This way, Shrine can perform tasks like generating location, extracting\nmetadata, processing, and logging, which are all storage-agnostic, and leave\nstorages to deal only with actual file storage. And these tasks can be\nconfigured differently depending on the types of files you're uploading:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  add_metadata "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":exif"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MiniMagick"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(io).exif")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"VideoUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  add_metadata "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":duration"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"FFMPEG"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Movie"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(io.path).duration")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"url"},"URL"),(0,s.kt)("p",null,"While Refile serves all files through the Rack endpoint mounted in your app,\nShrine serves files directly from storage services:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Refile"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".attachment_url("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "/attachments/cache/50dfl833lfs0gfh.jpg"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".image.url "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "https://my-bucket.s3.amazonaws.com/cache/50dfl833lfs0gfh.jpg"'))))),(0,s.kt)("p",null,"If you're using storage which don't expose files over URL (e.g. a database\nstorage), or you want to secure your downloads, you can also serve files\nthrough your app using the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/download_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"download_endpoint"))," plugin."),(0,s.kt)("h3",{id:"persistence"},"Persistence"),(0,s.kt)("p",null,"Refile persists the uploaded file location and metadata into individual\ncolumns:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<attachment>_id")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<attachment>_filename")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<attachment>_content_type")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<attachment>_size"))),(0,s.kt)("p",null,"Shrine, on the other hand, saves all uploaded file data into a single\n",(0,s.kt)("inlineCode",{parentName:"p"},"<attachment>_data")," column:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"{")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"id"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"path/to/image.jpg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"store"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"metadata"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"filename"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"nature.jpg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"size"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"4739472"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"mime_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},": "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image/jpeg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.id          "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "path/to/image.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.metadata    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> { "filename" => "...", "size" => ..., "mime_type" => "..." }')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.original_filename "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "nature.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.size              "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 4739472")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.mime_type         "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"'))))),(0,s.kt)("p",null,"This column can be queried if it's made a JSON column. Alternatively, you can\nuse the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/metadata_attributes"},(0,s.kt)("inlineCode",{parentName:"a"},"metadata_attributes"))," plugin to save metadata\ninto separate columns."),(0,s.kt)("h3",{id:"processing"},"Processing"),(0,s.kt)("p",null,"Shrine provides on-the-fly processing via the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivation_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"derivation_endpoint"))," plugin:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing/mini_magick"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":derivation_endpoint"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    secret_key"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR SECRET KEY>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"     "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"derivations/image"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# needs to match the mount point in routes")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  derivation "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumbnail"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |file, width, height|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageProcessing"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"MiniMagick")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      .source(file)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      .resize_to_limit!(width.to_i, height.to_i)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".derivation_endpoint "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/derivations/image"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"Shrine also support eager processing using the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivatives"},(0,s.kt)("inlineCode",{parentName:"a"},"derivatives")),"\nplugin."),(0,s.kt)("h3",{id:"validation"},"Validation"),(0,s.kt)("p",null,"In Refile, file validation is defined statically on attachment definition:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  attachment "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    extension"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[jpg jpeg png webp],")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    content_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"webp]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"In Shrine, validation is performed on the instance-level, which allows you to\nmake the validation conditional:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":validation_helpers")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".validate "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_max_size "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"10"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_extension "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[jpg jpeg png webp]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," validate_mime_type "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"webp]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      validate_max_dimensions ["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"5000"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"5000"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"Refile extracts the MIME type from the file extension, which means it can\neasily be spoofed (just give a PHP file a ",(0,s.kt)("inlineCode",{parentName:"p"},".jpg")," extension). Shrine has the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/determine_mime_type"},(0,s.kt)("inlineCode",{parentName:"a"},"determine_mime_type"))," plugin for determining MIME type\nfrom file ",(0,s.kt)("em",{parentName:"p"},"content"),"."),(0,s.kt)("h3",{id:"direct-uploads"},"Direct uploads"),(0,s.kt)("p",null,"Shrine borrows Refile's idea of direct uploads, and ships with\n",(0,s.kt)("inlineCode",{parentName:"p"},"upload_endpoint")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"presign_endpoint")," plugins which provide endpoints for\nuploading files and generating presigns."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":upload_endpoint")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload_endpoint("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Rack app that uploads files to specified storage")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":upload_endpoint")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".presign_endpoint("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Rack app that generates presigns for specified storage"))))),(0,s.kt)("p",null,"While Refile ships with a plug-and-play JavaScript for direct uploads, Shrine\ninstead adopts ",(0,s.kt)("a",{parentName:"p",href:"https://uppy.io"},"Uppy"),", a modern and modular JavaScript file upload library that\nhappens to integrate well with Shrine."),(0,s.kt)("h3",{id:"multiple-uploads"},"Multiple uploads"),(0,s.kt)("p",null,"Shrine doesn't have support for multiple uploads out-of-the-box like Refile\ndoes. Instead, you can implement them using a separate table with a one-to-many\nrelationship to which the files will be attached. The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/multiple-files"},"Multiple Files")," guide\nexplains this setup in more detail."),(0,s.kt)("h2",{id:"migrating-from-refile"},"Migrating from Refile"),(0,s.kt)("p",null,"You have an existing app using Refile and you want to transfer it to\nShrine. Let's assume we have a ",(0,s.kt)("inlineCode",{parentName:"p"},"Photo"),' model with the "image" attachment.'),(0,s.kt)("h3",{id:"1-add-shrine-column"},"1. Add Shrine column"),(0,s.kt)("p",null,"First we need to create the ",(0,s.kt)("inlineCode",{parentName:"p"},"image_data")," column for Shrine:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"add_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":text"))))),(0,s.kt)("h3",{id:"2-dual-write"},"2. Dual write"),(0,s.kt)("p",null,"Afterwards we need to make new uploads write to the ",(0,s.kt)("inlineCode",{parentName:"p"},"image_data")," column. This\ncan be done by including the below module to all models that have Refile\nattachments:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," ...,")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," ...,")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":model")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"module"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"RefileShrineSynchronization")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"write_shrine_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"self"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", name)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," read_attribute("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_id"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},").present?")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      attacher.set shrine_file(name)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"else")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      attacher.set "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"shrine_file"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".uploaded_file(")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"       send("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_id"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      metadata"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"        "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"size"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," (send("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_size"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," respond_to?("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_size"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"        "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"filename"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," (send("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_filename"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," respond_to?("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_filename"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"        "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"mime_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," (send("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_content_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," respond_to?("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"_content_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    )")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Base")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  attachment "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"RefileShrineSynchronization")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  before_save "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    write_shrine_data("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," image_id_changed?")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"After you deploy this code, the ",(0,s.kt)("inlineCode",{parentName:"p"},"image_data")," column should now be successfully\nsynchronized with new attachments."),(0,s.kt)("h3",{id:"3-data-migration"},"3. Data migration"),(0,s.kt)("p",null,"Next step is to run a script which writes all existing Refile attachments to\n",(0,s.kt)("inlineCode",{parentName:"p"},"image_data"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".find_each "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |photo|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  photo.write_shrine_data("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  photo.save!")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h3",{id:"4-rewrite-code"},"4. Rewrite code"),(0,s.kt)("p",null,"Now you should be able to rewrite your application so that it uses Shrine\ninstead of Refile (you can consult the reference in the next section). You can\nremove the ",(0,s.kt)("inlineCode",{parentName:"p"},"RefileShrineSynchronization")," module as well."),(0,s.kt)("h3",{id:"5-remove-refile-columns"},"5. Remove Refile columns"),(0,s.kt)("p",null,"If everything is looking good, we can remove Refile columns:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"remove_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_id")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"remove_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_size")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"remove_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_filename")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"remove_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_content_type"))))),(0,s.kt)("h2",{id:"refile-to-shrine-direct-mapping"},"Refile to Shrine direct mapping"),(0,s.kt)("h3",{id:"refile"},(0,s.kt)("inlineCode",{parentName:"h3"},"Refile")),(0,s.kt)("h4",{id:"cache-store-backends"},(0,s.kt)("inlineCode",{parentName:"h4"},".cache"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".store"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".backends")),(0,s.kt)("p",null,'Shrine calles these "storages", and it doesn\'t have special accessors for\n',(0,s.kt)("inlineCode",{parentName:"p"},":cache")," and ",(0,s.kt)("inlineCode",{parentName:"p"},":store"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Foo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"args),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Bar"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"args),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,s.kt)("h4",{id:"app-mount_point-automount"},(0,s.kt)("inlineCode",{parentName:"h4"},".app"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".mount_point"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".automount")),(0,s.kt)("p",null,"The Rack apps provided by the ",(0,s.kt)("inlineCode",{parentName:"p"},"*_endpoint")," Shrine plugins are mounted\nexplicitly:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds `POST /images/upload` endpoint")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload_endpoint("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/images/upload"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"allow_uploads_to"},(0,s.kt)("inlineCode",{parentName:"h4"},".allow_uploads_to")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine.upload_endpoint")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine.presign_endpoint")," builders require you\nto specify the storage that will be used."),(0,s.kt)("h4",{id:"logger"},(0,s.kt)("inlineCode",{parentName:"h4"},".logger")),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger"))))),(0,s.kt)("h4",{id:"processors-processor"},(0,s.kt)("inlineCode",{parentName:"h4"},".processors"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".processor")),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":derivatives")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  derivation "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumbnail"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |file, width, height|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"types"},(0,s.kt)("inlineCode",{parentName:"h4"},".types")),(0,s.kt)("p",null,"Shrine defines validations on the uploader class level:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"MyUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":validation_helpers")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".validate "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_max_size "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"5"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"extract_filename"},(0,s.kt)("inlineCode",{parentName:"h4"},".extract_filename")),(0,s.kt)("p",null,"Shrine's equivalent is a ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#extract_filename")," private method. You can\ninstead use the ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#extract_metadata")," public method."),(0,s.kt)("h4",{id:"extract_content_type"},(0,s.kt)("inlineCode",{parentName:"h4"},".extract_content_type")),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/determine_mime_type"},(0,s.kt)("inlineCode",{parentName:"a"},"determine_mime_type"))," plugin provides a\n",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine.determine_mime_type")," method."),(0,s.kt)("h4",{id:"app_url-upload_url-attachment_upload_url-presign_url-attachment_presign_url"},(0,s.kt)("inlineCode",{parentName:"h4"},".app_url"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".upload_url"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".attachment_upload_url"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".presign_url"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".attachment_presign_url")),(0,s.kt)("p",null,"Shrine requires you to use your framework to generate URLs to mounted\nendpoints."),(0,s.kt)("h4",{id:"attachment_url-file_url"},(0,s.kt)("inlineCode",{parentName:"h4"},".attachment_url"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".file_url")),(0,s.kt)("p",null,"You can call ",(0,s.kt)("inlineCode",{parentName:"p"},"#url")," on the uploaded file, or ",(0,s.kt)("inlineCode",{parentName:"p"},"#<name>_url")," on the model.\nAlternatively, you can use ",(0,s.kt)("inlineCode",{parentName:"p"},"#download_url")," provided by the ",(0,s.kt)("inlineCode",{parentName:"p"},"download_endpoint"),"\nplugin."),(0,s.kt)("h4",{id:"host-cdn_host-app_host-allow_downloads_from-allow_origin-content_max_age"},(0,s.kt)("inlineCode",{parentName:"h4"},".host"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".cdn_host"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".app_host"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".allow_downloads_from"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},"allow_origin"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".content_max_age")),(0,s.kt)("p",null,"These can be configured on individual ",(0,s.kt)("inlineCode",{parentName:"p"},"*_endpoint")," plugins."),(0,s.kt)("h4",{id:"secret_key-token-valid_token"},(0,s.kt)("inlineCode",{parentName:"h4"},".secret_key"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".token"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},".valid_token?")),(0,s.kt)("p",null,"The secret key is required for the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivation_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"derivation_endpoint")),", but these methods are not\nexposed."),(0,s.kt)("h3",{id:"attachment"},(0,s.kt)("inlineCode",{parentName:"h3"},"Attachment")),(0,s.kt)("p",null,"Shrine's equivalent to calling the attachment is including an attachment module\nof an uploader:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"extension-content_type-type"},(0,s.kt)("inlineCode",{parentName:"h4"},":extension"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},":content_type"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},":type")),(0,s.kt)("p",null,"In Shrine validations are done instance-level inside the uploader, most\ncommonly with the ",(0,s.kt)("inlineCode",{parentName:"p"},"validation_helpers")," plugin:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":validation_helpers")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".validate "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_extension "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[jpg jpeg png]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_mime_type "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"cache-store"},(0,s.kt)("inlineCode",{parentName:"h4"},":cache"),", ",(0,s.kt)("inlineCode",{parentName:"h4"},":store")),(0,s.kt)("p",null,"Shrine provides a ",(0,s.kt)("inlineCode",{parentName:"p"},"default_storage")," plugin for setting custom storages on the\nuploader:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":custom_cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Foo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"args)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":custom_store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Bar"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"args)"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":default_storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":custom_cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":custom_store")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"raise_errors"},(0,s.kt)("inlineCode",{parentName:"h4"},":raise_errors")),(0,s.kt)("p",null,"No equivalent currently exists in Shrine."),(0,s.kt)("h3",{id:"accepts_attachments_for"},(0,s.kt)("inlineCode",{parentName:"h3"},"accepts_attachments_for")),(0,s.kt)("p",null,"No equivalent in Shrine, but take a look at the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/multiple-files"},"Multiple Files")," guide."),(0,s.kt)("h3",{id:"form-helpers"},"Form helpers"),(0,s.kt)("h4",{id:"attachment_field"},(0,s.kt)("inlineCode",{parentName:"h4"},"attachment_field")),(0,s.kt)("p",null,"The following Refile code"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |form|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.attachment_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"is equivalent to the following Shrine code"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cached_attachment_data"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |form|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.hidden_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_profile_image_data, id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.file_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h3",{id:"model-methods"},"Model methods"),(0,s.kt)("h4",{id:"remove_attachment"},(0,s.kt)("inlineCode",{parentName:"h4"},"remove_<attachment>")),(0,s.kt)("p",null,"Shrine comes with a ",(0,s.kt)("inlineCode",{parentName:"p"},"remove_attachment")," plugin which adds the same\n",(0,s.kt)("inlineCode",{parentName:"p"},"#remove_<attachment>")," method to the model."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":remove_attachment"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |form|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.hidden_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_profile_image_data, id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.file_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.check_box "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":remove_profile_image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h4",{id:"remote_attachment_url"},(0,s.kt)("inlineCode",{parentName:"h4"},"remote_<attachment>_url")),(0,s.kt)("p",null,"Shrine comes with a ",(0,s.kt)("inlineCode",{parentName:"p"},"remote_url")," plugin which adds the same\n",(0,s.kt)("inlineCode",{parentName:"p"},"#<attachment>_remote_url")," method to the model."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":remote_url"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |form|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.hidden_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@user"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_profile_image_data, id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.file_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  form.text_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":profile_image_remote_url")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))}N.isMDXComponent=!0}}]);