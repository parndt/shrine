"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2999],{3905:(a,e,t)=>{t.d(e,{Zo:()=>m,kt:()=>N});var n=t(7294);function p(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function s(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,n)}return t}function l(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?s(Object(t),!0).forEach((function(e){p(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function r(a,e){if(null==a)return{};var t,n,p=function(a,e){if(null==a)return{};var t,n,p={},s=Object.keys(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||(p[t]=a[t]);return p}(a,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(p[t]=a[t])}return p}var o=n.createContext({}),c=function(a){var e=n.useContext(o),t=e;return a&&(t="function"==typeof a?a(e):l(l({},e),a)),t},m=function(a){var e=c(a.components);return n.createElement(o.Provider,{value:e},a.children)},i="mdxType",d={inlineCode:"code",wrapper:function(a){var e=a.children;return n.createElement(n.Fragment,{},e)}},F=n.forwardRef((function(a,e){var t=a.components,p=a.mdxType,s=a.originalType,o=a.parentName,m=r(a,["components","mdxType","originalType","parentName"]),i=c(t),F=p,N=i["".concat(o,".").concat(F)]||i[F]||d[F]||s;return t?n.createElement(N,l(l({ref:e},m),{},{components:t})):n.createElement(N,l({ref:e},m))}));function N(a,e){var t=arguments,p=e&&e.mdxType;if("string"==typeof a||p){var s=t.length,l=new Array(s);l[0]=F;var r={};for(var o in e)hasOwnProperty.call(e,o)&&(r[o]=e[o]);r.originalType=a,r[i]="string"==typeof a?a:p,l[1]=r;for(var c=2;c<s;c++)l[c]=t[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}F.displayName="MDXCreateElement"},18:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>m,contentTitle:()=>o,default:()=>N,frontMatter:()=>r,metadata:()=>c,toc:()=>i});var n=t(7462),p=t(3366),s=(t(7294),t(3905)),l=["components"],r={title:"Model"},o=void 0,c={unversionedId:"plugins/model",id:"plugins/model",title:"Model",description:"The model plugin provides integration for handling attachment on",source:"@site/../doc/plugins/model.md",sourceDirName:"plugins",slug:"/plugins/model",permalink:"/docs/plugins/model",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/plugins/model.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1607207208,formattedLastUpdatedAt:"Dec 5, 2020",frontMatter:{title:"Model"},sidebar:"plugins",previous:{title:"Entity",permalink:"/docs/plugins/entity"},next:{title:"Sequel",permalink:"/docs/plugins/sequel"}},m={},i=[{value:"Attachment",id:"attachment",level:2},{value:"<code>#&lt;name&gt;=</code>",id:"name",level:4},{value:"<code>#&lt;name&gt;_changed?</code>",id:"name_changed",level:4},{value:"Disabling caching",id:"disabling-caching",level:4},{value:"<code>#&lt;name&gt;_attacher</code>",id:"name_attacher",level:4},{value:"Entity",id:"entity",level:3},{value:"Attacher",id:"attacher",level:2},{value:"Loading model",id:"loading-model",level:3},{value:"Writing attachment data",id:"writing-attachment-data",level:3},{value:"Serialization",id:"serialization",level:2}],d={toc:i},F="wrapper";function N(a){var e=a.components,t=(0,p.Z)(a,l);return(0,s.kt)(F,(0,n.Z)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/blob/master/lib/shrine/plugins/model.rb"},(0,s.kt)("inlineCode",{parentName:"a"},"model"))," plugin provides integration for handling attachment on\nmutable structs. It is built on top of the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/entity"},(0,s.kt)("inlineCode",{parentName:"a"},"entity"))," plugin."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":model"))))),(0,s.kt)("h2",{id:"attachment"},"Attachment"),(0,s.kt)("p",null,"Including a ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment")," module into a model class will:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"add ",(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/plugins/entity"},"entity")," attachment methods"),(0,s.kt)("li",{parentName:"ul"},"add ",(0,s.kt)("inlineCode",{parentName:"li"},"#<name>=")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"#<name>_changed?")," methods")),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"attr_accessor"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="bc2e13.jpg" storage=:cache ...>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"bc2e13.jpg","storage":"cache","metadata":{...}}\'')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher.finalize")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="397eca.jpg" storage=:store ...>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"397eca.jpg","storage":"store","metadata":{...}}\''))))),(0,s.kt)("h4",{id:"name"},(0,s.kt)("inlineCode",{parentName:"h4"},"#<name>=")),(0,s.kt)("p",null,"Calls ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#assign")," by default, which uploads the file to temporary storage\nand attaches it, updating the model attribute."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :cache")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data        "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"...","storage":"cache","metadata":{...}}\''))))),(0,s.kt)("h4",{id:"name_changed"},(0,s.kt)("inlineCode",{parentName:"h4"},"#<name>_changed?")),(0,s.kt)("p",null,"Calls ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#changed?")," which returns whether the attachment has changed."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_changed? "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_changed? "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true"))))),(0,s.kt)("h4",{id:"disabling-caching"},"Disabling caching"),(0,s.kt)("p",null,"If you don't want to use temporary storage, you can have ",(0,s.kt)("inlineCode",{parentName:"p"},"#<name>=")," upload\ndirectly to permanent storage."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":model"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"false"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data        "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"...","storage":"store","metadata":{...}}\''))))),(0,s.kt)("p",null,"This can be configured on the attacher level as well:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher(model_cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"false"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store"))))),(0,s.kt)("h4",{id:"name_attacher"},(0,s.kt)("inlineCode",{parentName:"h4"},"#<name>_attacher")),(0,s.kt)("p",null,"Returns an ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher")," instance backed by the model instance, memoized in an\ninstance variable."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<ImageUploader::Attacher> (memoizes the instance)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<ImageUploader::Attacher> (returns memoized instance)"))))),(0,s.kt)("p",null,"When attacher options are passed, the attacher instance is refreshed:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher(cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":other_cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher.cache_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :other_cache"))))),(0,s.kt)("h3",{id:"entity"},"Entity"),(0,s.kt)("p",null,"If you still want to include ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment"),' modules to immutable\nentities, you can disable "model" behaviour by passing ',(0,s.kt)("inlineCode",{parentName:"p"},"model: false"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"attr_reader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", model"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"false"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h2",{id:"attacher"},"Attacher"),(0,s.kt)("p",null,"You can also use ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," directly (with or without the\n",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment")," module):"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"attr_accessor"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign(file) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# cache")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="bc2e13.jpg" storage=:cache ...>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"bc2e13.jpg","storage":"cache","metadata":{...}}\'')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.finalize "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# promote")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="397eca.jpg" storage=:store ...>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"397eca.jpg","storage":"store","metadata":{...}}\''))))),(0,s.kt)("h3",{id:"loading-model"},"Loading model"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher.from_model")," method can be used for creating an ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher"),"\ninstance backed by a model object."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.record    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Photo>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.name      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attribute "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :image_data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach(io)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"...","storage":"...","metadata":{...}}\''))))),(0,s.kt)("p",null,"You can also load an entity into an existing attacher with\n",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#load_model"),"."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"...","storage":"...","metadata":{...}}'),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.load_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<ImageUploader::UploadedFile>"))))),(0,s.kt)("p",null,"Or just ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#set_model")," if you don't want to load attachment data:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"...","storage":"...","metadata":{...}}'),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.set_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# doesn't load attachment data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil"))))),(0,s.kt)("h3",{id:"writing-attachment-data"},"Writing attachment data"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#write")," method writes attachment data to the ",(0,s.kt)("inlineCode",{parentName:"p"},"#<name>_data"),"\nattribute on the model instance."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," uploaded_file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.write")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"...","storage":"...","metadata":{...}}\''))))),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#write")," method is automatically called on ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#set"),", as well\nas ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#assign"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#attach_cached"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#attach"),",\n",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#promote")," and any other attacher method that calls ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#set"),"."),(0,s.kt)("h2",{id:"serialization"},"Serialization"),(0,s.kt)("p",null,"By default, attachment data is serialized into JSON using the ",(0,s.kt)("inlineCode",{parentName:"p"},"JSON")," standard\nlibrary. If you want to change how data is serialized, see the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/column#serializer"},(0,s.kt)("inlineCode",{parentName:"a"},"column"))," plugin docs."))}N.isMDXComponent=!0}}]);