"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6683],{3905:(a,e,t)=>{t.d(e,{Zo:()=>c,kt:()=>k});var n=t(7294);function p(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function s(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,n)}return t}function r(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?s(Object(t),!0).forEach((function(e){p(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function l(a,e){if(null==a)return{};var t,n,p=function(a,e){if(null==a)return{};var t,n,p={},s=Object.keys(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||(p[t]=a[t]);return p}(a,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(p[t]=a[t])}return p}var o=n.createContext({}),m=function(a){var e=n.useContext(o),t=e;return a&&(t="function"==typeof a?a(e):r(r({},e),a)),t},c=function(a){var e=m(a.components);return n.createElement(o.Provider,{value:e},a.children)},i="mdxType",d={inlineCode:"code",wrapper:function(a){var e=a.children;return n.createElement(n.Fragment,{},e)}},N=n.forwardRef((function(a,e){var t=a.components,p=a.mdxType,s=a.originalType,o=a.parentName,c=l(a,["components","mdxType","originalType","parentName"]),i=m(t),N=p,k=i["".concat(o,".").concat(N)]||i[N]||d[N]||s;return t?n.createElement(k,r(r({ref:e},c),{},{components:t})):n.createElement(k,r({ref:e},c))}));function k(a,e){var t=arguments,p=e&&e.mdxType;if("string"==typeof a||p){var s=t.length,r=new Array(s);r[0]=N;var l={};for(var o in e)hasOwnProperty.call(e,o)&&(l[o]=e[o]);l.originalType=a,l[i]="string"==typeof a?a:p,r[1]=l;for(var m=2;m<s;m++)r[m]=t[m];return n.createElement.apply(null,r)}return n.createElement.apply(null,t)}N.displayName="MDXCreateElement"},5162:(a,e,t)=>{t.d(e,{Z:()=>r});var n=t(7294),p=t(6010);const s={tabItem:"tabItem_Ymn6"};function r(a){var e=a.children,t=a.hidden,r=a.className;return n.createElement("div",{role:"tabpanel",className:(0,p.Z)(s.tabItem,r),hidden:t},e)}},4866:(a,e,t)=>{t.d(e,{Z:()=>f});var n=t(7462),p=t(7294),s=t(6010),r=t(2466),l=t(6550),o=t(1980),m=t(7392),c=t(12);function i(a){return function(a){var e,t;return null!=(e=null==(t=p.Children.map(a,(function(a){if(!a||(0,p.isValidElement)(a)&&(e=a.props)&&"object"==typeof e&&"value"in e)return a;var e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof a.type?a.type:a.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?e:[]}(a).map((function(a){var e=a.props;return{value:e.value,label:e.label,attributes:e.attributes,default:e.default}}))}function d(a){var e=a.values,t=a.children;return(0,p.useMemo)((function(){var a=null!=e?e:i(t);return function(a){var e=(0,m.l)(a,(function(a,e){return a.value===e.value}));if(e.length>0)throw new Error('Docusaurus error: Duplicate values "'+e.map((function(a){return a.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(a),a}),[e,t])}function N(a){var e=a.value;return a.tabValues.some((function(a){return a.value===e}))}function k(a){var e=a.queryString,t=void 0!==e&&e,n=a.groupId,s=(0,l.k6)(),r=function(a){var e=a.queryString,t=void 0!==e&&e,n=a.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,o._X)(r),(0,p.useCallback)((function(a){if(r){var e=new URLSearchParams(s.location.search);e.set(r,a),s.replace(Object.assign({},s.location,{search:e.toString()}))}}),[r,s])]}function F(a){var e,t,n,s,r=a.defaultValue,l=a.queryString,o=void 0!==l&&l,m=a.groupId,i=d(a),F=(0,p.useState)((function(){return function(a){var e,t=a.defaultValue,n=a.tabValues;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!N({value:t,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+n.map((function(a){return a.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var p=null!=(e=n.find((function(a){return a.default})))?e:n[0];if(!p)throw new Error("Unexpected error: 0 tabValues");return p.value}({defaultValue:r,tabValues:i})})),y=F[0],u=F[1],h=k({queryString:o,groupId:m}),g=h[0],E=h[1],f=(e=function(a){return a?"docusaurus.tab."+a:null}({groupId:m}.groupId),t=(0,c.Nk)(e),n=t[0],s=t[1],[n,(0,p.useCallback)((function(a){e&&s.set(a)}),[e,s])]),b=f[0],v=f[1],C=function(){var a=null!=g?g:b;return N({value:a,tabValues:i})?a:null}();return(0,p.useLayoutEffect)((function(){C&&u(C)}),[C]),{selectedValue:y,selectValue:(0,p.useCallback)((function(a){if(!N({value:a,tabValues:i}))throw new Error("Can't select invalid tab value="+a);u(a),E(a),v(a)}),[E,v,i]),tabValues:i}}var y=t(2389);const u={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function h(a){var e=a.className,t=a.block,l=a.selectedValue,o=a.selectValue,m=a.tabValues,c=[],i=(0,r.o5)().blockElementScrollPositionUntilNextRender,d=function(a){var e=a.currentTarget,t=c.indexOf(e),n=m[t].value;n!==l&&(i(e),o(n))},N=function(a){var e,t=null;switch(a.key){case"Enter":d(a);break;case"ArrowRight":var n,p=c.indexOf(a.currentTarget)+1;t=null!=(n=c[p])?n:c[0];break;case"ArrowLeft":var s,r=c.indexOf(a.currentTarget)-1;t=null!=(s=c[r])?s:c[c.length-1]}null==(e=t)||e.focus()};return p.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":t},e)},m.map((function(a){var e=a.value,t=a.label,r=a.attributes;return p.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===e?0:-1,"aria-selected":l===e,key:e,ref:function(a){return c.push(a)},onKeyDown:N,onClick:d},r,{className:(0,s.Z)("tabs__item",u.tabItem,null==r?void 0:r.className,{"tabs__item--active":l===e})}),null!=t?t:e)})))}function g(a){var e=a.lazy,t=a.children,n=a.selectedValue,s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){var r=s.find((function(a){return a.props.value===n}));return r?(0,p.cloneElement)(r,{className:"margin-top--md"}):null}return p.createElement("div",{className:"margin-top--md"},s.map((function(a,e){return(0,p.cloneElement)(a,{key:e,hidden:a.props.value!==n})})))}function E(a){var e=F(a);return p.createElement("div",{className:(0,s.Z)("tabs-container",u.tabList)},p.createElement(h,(0,n.Z)({},a,e)),p.createElement(g,(0,n.Z)({},a,e)))}function f(a){var e=(0,y.Z)();return p.createElement(E,(0,n.Z)({key:String(e)},a))}},8183:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>y,frontMatter:()=>m,metadata:()=>i,toc:()=>N});var n=t(7462),p=t(3366),s=(t(7294),t(3905)),r=t(4866),l=t(5162),o=["components"],m={id:"getting-started",title:"Getting Started"},c=void 0,i={unversionedId:"getting-started",id:"getting-started",title:"Getting Started",description:"Quick start",source:"@site/../doc/getting_started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/getting_started.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1685660850,formattedLastUpdatedAt:"Jun 1, 2023",frontMatter:{id:"getting-started",title:"Getting Started"},sidebar:"guides",previous:{title:"Advantages of Shrine",permalink:"/docs/advantages"},next:{title:"The Design of Shrine",permalink:"/docs/design"}},d={},N=[{value:"Quick start",id:"quick-start",level:2},{value:"Storage",id:"storage",level:2},{value:"Uploader",id:"uploader",level:2},{value:"Uploading",id:"uploading",level:3},{value:"IO abstraction",id:"io-abstraction",level:3},{value:"Uploaded file",id:"uploaded-file",level:2},{value:"Attaching",id:"attaching",level:2},{value:"Attachment module",id:"attachment-module",level:3},{value:"Attacher",id:"attacher",level:3},{value:"Temporary storage",id:"temporary-storage",level:3},{value:"Plugin system",id:"plugin-system",level:2},{value:"Metadata",id:"metadata",level:2},{value:"MIME type",id:"mime-type",level:3},{value:"Other metadata",id:"other-metadata",level:3},{value:"Processing",id:"processing",level:2},{value:"Eager processing",id:"eager-processing",level:3},{value:"On-the-fly processing",id:"on-the-fly-processing",level:3},{value:"Validation",id:"validation",level:2},{value:"Location",id:"location",level:2},{value:"Direct uploads",id:"direct-uploads",level:2},{value:"Simple direct upload",id:"simple-direct-upload",level:3},{value:"Presigned direct upload",id:"presigned-direct-upload",level:3},{value:"Resumable direct upload",id:"resumable-direct-upload",level:3},{value:"Uppy S3 Multipart",id:"uppy-s3-multipart",level:4},{value:"Tus protocol",id:"tus-protocol",level:4},{value:"Backgrounding",id:"backgrounding",level:2},{value:"Clearing cache",id:"clearing-cache",level:2},{value:"Logging",id:"logging",level:2}],k={toc:N},F="wrapper";function y(a){var e=a.components,t=(0,p.Z)(a,o);return(0,s.kt)(F,(0,n.Z)({},k,t,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"quick-start"},"Quick start"),(0,s.kt)("p",null,"Add Shrine to the Gemfile and write an initializer which sets up the storage\nand loads integration for your persistence library:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 3.0"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine/storage/file_system"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"FileSystem"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"public"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"uploads/cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"), "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# temporary")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"FileSystem"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"public"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"uploads"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"),       "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# permanent")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":sequel"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# or :activerecord")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cached_attachment_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# for retaining the cached file across form redisplays")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":restore_cached_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# re-extract metadata when attaching a cached file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":rack_file"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# for non-Rails apps"))))),(0,s.kt)("p",null,"Next decide how you will name the attachment attribute on your model, and run a\nmigration that adds an ",(0,s.kt)("inlineCode",{parentName:"p"},"<attachment>_data")," text or JSON column, which Shrine\nwill use to store all information about the attachment:"),(0,s.kt)(r.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".migration "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  change "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    add_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":text"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# or :jsonb")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"AddImageDataToPhotos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Migration")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"change")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    add_column "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":text"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# or :jsonb")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"rails",label:"Rails",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"$ rails generate migration add_image_data_to_photos image_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"text "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# or image_data:jsonb"))))))),(0,s.kt)("p",null,"If using ",(0,s.kt)("inlineCode",{parentName:"p"},"jsonb")," consider adding a ",(0,s.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/datatype-json.html#JSON-INDEXING"},"gin index")," for fast key-value pair searchability within ",(0,s.kt)("inlineCode",{parentName:"p"},"image_data"),"."),(0,s.kt)("p",null,"Now you can create an uploader class for the type of files you want to upload,\nand add a virtual attribute for handling attachments using this uploader to\nyour model. If you do not care about adding plugins or additional processing,\nyou can use ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment"),"."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# plugins and uploading logic")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)(r.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds an `image` virtual attribute")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Base")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds an `image` virtual attribute")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,s.kt)("p",null,"Let's now add the form fields which will use this virtual attribute (NOT the\n",(0,s.kt)("inlineCode",{parentName:"p"},"<attachment>_data")," column attribute). We need (1) a file field for choosing\nfiles, and (2) a hidden field for retaining the uploaded file in case of\nvalidation errors and for potential ",(0,s.kt)("a",{parentName:"p",href:"#direct-uploads"},"direct uploads"),"."),(0,s.kt)(r.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"rails",label:"Rails form builder",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |f|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.hidden_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_image_data, id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.file_field "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.submit")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"simple_form",label:"Simple Form",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"simple_form_for "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |f|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", as"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":hidden"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", input_html"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_image_data }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", as"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.button "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":submit")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"form",label:"Forme",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", action"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", enctype"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"multipart/form-data"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |f|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":hidden"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".cached_image_data")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.button "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"Create"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"erb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"erb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"form"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"action"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"method"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"post"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"enctype"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"multipart/form-data"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},">")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  <"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"input"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"photo[image]"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"hidden"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<%="),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},".cached_image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," />")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  <"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"input"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"photo[image] "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"file"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," />")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  <"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"input"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"submit"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"value"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"Create"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," />")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"</"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"form"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},">"))))))),(0,s.kt)("p",null,"Note that the file field needs to go ",(0,s.kt)("em",{parentName:"p"},"after")," the hidden field, so that\nselecting a new file can always override the cached file in the hidden field.\nAlso notice the ",(0,s.kt)("inlineCode",{parentName:"p"},'enctype="multipart/form-data"')," HTML attribute, which is\nrequired for submitting files through the form (the Rails form builder\nwill automatically generate this for you)."),(0,s.kt)("p",null,"When the form is submitted, in your router/controller you can assign the file\nfrom request params to the attachment attribute on the model."),(0,s.kt)(r.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"rails",label:"Rails",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"PhotosController"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ApplicationController")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"create")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".create(photo_params)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"private")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"photo_params")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    params.require("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},").permit("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,s.kt)(l.Z,{value:"sinatra",label:"Sinatra",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"post "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/photos"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".create(params["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"])")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,s.kt)("p",null,"Once a file is uploaded and attached to the record, you can retrieve a URL to\nthe uploaded file with ",(0,s.kt)("inlineCode",{parentName:"p"},"#<attachment>_url")," and display it on the page:"),(0,s.kt)(r.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"rails",label:"Rails",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"erb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"erb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<%="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," image_tag "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".image_url "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%>")))))),(0,s.kt)(l.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"erb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"erb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"img"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884",fontStyle:"italic"}},"src"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<%="),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},".image_url "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," />"))))))),(0,s.kt)("h2",{id:"storage"},"Storage"),(0,s.kt)("p",null,'A "storage" in Shrine is an object that encapsulates communication with a\nspecific storage service, by implementing a common public interface. Storage\ninstances are registered under an identifier in ',(0,s.kt)("inlineCode",{parentName:"p"},"Shrine.storages"),", so that they\ncan later be used by ",(0,s.kt)("a",{parentName:"p",href:"#uploader"},"uploaders"),"."),(0,s.kt)("p",null,"Shrine ships with the following storages:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/storage/file-system"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::Storage::FileSystem"))," \u2013 stores files on disk"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/storage/s3"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::Storage::S3"))," \u2013 stores files on ",(0,s.kt)("a",{parentName:"li",href:"https://aws.amazon.com/s3/"},"AWS S3")," (or ",(0,s.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/products/spaces/"},"DigitalOcean Spaces"),", ",(0,s.kt)("a",{parentName:"li",href:"https://min.io/"},"MinIO"),", ...)"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/storage/memory"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::Storage::Memory"))," \u2013 stores file in memory (convenient for ",(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/testing"},"testing"),")")),(0,s.kt)("p",null,"Here is how we might configure Shrine with S3 storage:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"aws-sdk-s3"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 1.14"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# for AWS S3 storage"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine/storage/s3"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3_options "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  bucket"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"            "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR BUCKET>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# required")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  region"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"            "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR REGION>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# required")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  access_key_id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"     "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR ACCESS KEY ID>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  secret_access_key"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR SECRET ACCESS KEY>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"S3"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3_options), "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# temporary")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"S3"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3_options),                  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# permanent")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,s.kt)("p",null,"The above example sets up S3 for both temporary and permanent storage, which is\nsuitable for ",(0,s.kt)("a",{parentName:"p",href:"#presigned-direct-upload"},"direct uploads"),". The ",(0,s.kt)("inlineCode",{parentName:"p"},":cache")," and ",(0,s.kt)("inlineCode",{parentName:"p"},":store"),"\nnames are special only in terms that the ",(0,s.kt)("a",{parentName:"p",href:"#attacher"},"attacher")," will automatically pick\nthem up, you can also register more storage objects under different names."),(0,s.kt)("p",null,"See the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/storage/file-system"},"FileSystem"),"/",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/storage/s3"},"S3"),"/",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/storage/memory"},"Memory")," storage docs for more details. There are\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/external/extensions#storages"},"many more Shrine storages")," provided by external gems, and you can\nalso ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/creating-storages"},"create your own storage"),"."),(0,s.kt)("h2",{id:"uploader"},"Uploader"),(0,s.kt)("p",null,"Uploaders are subclasses of ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine"),", and they wrap the actual upload to the\nstorage. They perform common tasks around upload that aren't related to a\nparticular storage."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"MyUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# image attachment logic")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"It's common to create an uploader for each type of file that you want to handle\n(",(0,s.kt)("inlineCode",{parentName:"p"},"ImageUploader"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"VideoUploader"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"AudioUploader")," etc), but really you can\norganize them in any way you like."),(0,s.kt)("h3",{id:"uploading"},"Uploading"),(0,s.kt)("p",null,"The main method of the uploader is ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine.upload"),", which takes an ",(0,s.kt)("a",{parentName:"p",href:"#io-abstraction"},"IO-like\nobject")," and a storage identifier on the input, and returns a\nrepresentation of the ",(0,s.kt)("a",{parentName:"p",href:"#uploaded-file"},"uploaded file")," on the output."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MyUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload(file, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>"))))),(0,s.kt)("p",null,"Internally this instantiates the uploader with the storage and calls\n",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#upload"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MyUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload(file) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile>"))))),(0,s.kt)("p",null,"Some of the tasks performed by ",(0,s.kt)("inlineCode",{parentName:"p"},"#upload")," include:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"extracting ",(0,s.kt)("a",{parentName:"li",href:"#metadata"},"metadata")),(0,s.kt)("li",{parentName:"ul"},"generating ",(0,s.kt)("a",{parentName:"li",href:"#location"},"location")),(0,s.kt)("li",{parentName:"ul"},"uploading (this is where the ",(0,s.kt)("a",{parentName:"li",href:"#storage"},"storage")," is called)"),(0,s.kt)("li",{parentName:"ul"},"closing the uploaded file")),(0,s.kt)("p",null,'The second argument is a "context" hash which is forwarded to places like\nmetadata extraction and location generation, but it has a few special options:'),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload(io, metadata"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"foo"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," })           "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# add metadata")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload(io, location"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"path/to/file"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")               "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# specify custom location")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload(io, upload_options"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { acl"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"public-read"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," }) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# add options to Storage#upload"))))),(0,s.kt)("h3",{id:"io-abstraction"},"IO abstraction"),(0,s.kt)("p",null,"Shrine is able to upload any IO-like object that implement methods ",(0,s.kt)("a",{parentName:"p",href:"https://ruby-doc.org/core/IO.html#method-i-read"},(0,s.kt)("inlineCode",{parentName:"a"},"#read")),",\n",(0,s.kt)("a",{parentName:"p",href:"https://ruby-doc.org/core/IO.html#method-i-rewind"},(0,s.kt)("inlineCode",{parentName:"a"},"#rewind")),", ",(0,s.kt)("a",{parentName:"p",href:"https://ruby-doc.org/core/IO.html#method-i-eof"},(0,s.kt)("inlineCode",{parentName:"a"},"#eof?"))," and ",(0,s.kt)("a",{parentName:"p",href:"https://ruby-doc.org/core/IO.html#method-i-close"},(0,s.kt)("inlineCode",{parentName:"a"},"#close"))," whose behaviour matches the ",(0,s.kt)("a",{parentName:"p",href:"https://ruby-doc.org/core/IO.html"},(0,s.kt)("inlineCode",{parentName:"a"},"IO"))," class.\nThis includes but is not limited to the following objects:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://ruby-doc.org/core/File.html"},(0,s.kt)("inlineCode",{parentName:"a"},"File"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://ruby-doc.org/stdlib/libdoc/tempfile/rdoc/Tempfile.html"},(0,s.kt)("inlineCode",{parentName:"a"},"Tempfile"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://ruby-doc.org/stdlib/libdoc/stringio/rdoc/StringIO.html"},(0,s.kt)("inlineCode",{parentName:"a"},"StringIO"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://api.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html"},(0,s.kt)("inlineCode",{parentName:"a"},"ActionDispatch::Http::UploadedFile"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/plugins/rack_file"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::RackFile"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://shrinerb.com/docs/plugins/data_uri"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::DataFile"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#uploaded-file"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::UploadedFile"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/janko/down#streaming"},(0,s.kt)("inlineCode",{parentName:"a"},"Down::ChunkedIO"))),(0,s.kt)("li",{parentName:"ul"},"...")),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/path/to/file"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", binmode"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")   "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from disk")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"StringIO"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"file content"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")                "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from memory")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActionDispatch"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Http"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"UploadedFile"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(...) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from Rails controller")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".rack_file({ tempfile"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," tempfile })    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from Rack controller")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rack"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Test"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"UploadedFile"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(...)           "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from rack-test")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Down"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"https://example.org/file"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")       "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from internet")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"UploadedFile"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(...)               "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# upload from Shrine storage"))))),(0,s.kt)("h2",{id:"uploaded-file"},"Uploaded file"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile")," object represents the file that was uploaded to a\nstorage, and it's what's returned from ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#upload")," or when retrieving a\nrecord ",(0,s.kt)("a",{parentName:"p",href:"#attaching"},"attachment"),"."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploader.upload(file) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>  (uploader)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image           "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>  (attachment)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file         "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>  (attacher)"))))),(0,s.kt)("p",null,"An uploaded file object contains the following data:"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,s.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"id")),(0,s.kt)("td",{parentName:"tr",align:"left"},"location of the file on the storage")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"storage")),(0,s.kt)("td",{parentName:"tr",align:"left"},"identifier of the storage the file was uploaded to")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"metadata")),(0,s.kt)("td",{parentName:"tr",align:"left"},"file ",(0,s.kt)("a",{parentName:"td",href:"#metadata"},"metadata")," that was extracted before upload")))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="949sdjg834.jpg" storage=:store metadata={...}>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.id          "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "949sdjg834.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.storage     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::Storage::S3>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.metadata    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> {...}"))))),(0,s.kt)("p",null,"It comes with many convenient methods that delegate to the storage:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.url                     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "https://my-bucket.s3.amazonaws.com/949sdjg834.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { |io| ... }       "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# opens the uploaded file stream")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.download { |file| ... } "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# downloads the uploaded file to disk")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.stream(destination)     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# streams uploaded content into a writable destination")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.exists?                 "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> true")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.delete                  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# deletes the uploaded file from the storage"))))),(0,s.kt)("p",null,"It also implements the IO-like interface that conforms to Shrine's ",(0,s.kt)("a",{parentName:"p",href:"#io-abstraction"},"IO\nabstraction"),", which allows it to be uploaded again to other\nstorages."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.read   "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# returns content of the uploaded file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.eof?   "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# returns true if the whole IO was read")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.rewind "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# rewinds the IO")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.close  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# closes the IO"))))),(0,s.kt)("p",null,"For more details, see the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/retrieving-uploads"},"Retrieving Uploads")," guide and\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/rdoc/classes/Shrine/UploadedFile/InstanceMethods.html"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::UploadedFile"))," API docs."),(0,s.kt)("h2",{id:"attaching"},"Attaching"),(0,s.kt)("p",null,"To attach uploaded files to database records, Shrine offers an attachment\ninterface built on top of uploaders and uploaded files. There are integrations\nfor various persistence libraries (",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/activerecord"},"ActiveRecord"),",\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/sequel"},"Sequel"),", ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine-rom"},"ROM"),", ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/katafrakt/hanami-shrine"},"Hanami"),",\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine-mongoid"},"Mongoid"),"), but you can also attach files to plain structs\n(",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/model"},"mutable")," or ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/entity"},"immutable"),")."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":sequel"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# :activerecord"))))),(0,s.kt)("h3",{id:"attachment-module"},"Attachment module"),(0,s.kt)("p",null,"The easiest way to attach files is with the ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment")," module:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ActiveRecord::Base")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# use your preferred syntax")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"The included module will add attachment methods for the specified attribute:"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:"left"},"Method"),(0,s.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"#image=")),(0,s.kt)("td",{parentName:"tr",align:"left"},"uploads the file to temporary storage and serializes the result into ",(0,s.kt)("inlineCode",{parentName:"td"},"image_data"))),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"#image")),(0,s.kt)("td",{parentName:"tr",align:"left"},"returns ",(0,s.kt)("a",{parentName:"td",href:"#uploaded-file"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::UploadedFile"))," instantiated from ",(0,s.kt)("inlineCode",{parentName:"td"},"image_data"))),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"#image_url")),(0,s.kt)("td",{parentName:"tr",align:"left"},"calls ",(0,s.kt)("inlineCode",{parentName:"td"},"url")," on the attachment if it's present, otherwise returns nil")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"#image_attacher")),(0,s.kt)("td",{parentName:"tr",align:"left"},"returns instance of ",(0,s.kt)("a",{parentName:"td",href:"#attacher"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::Attacher"))," which handles the attaching")))),(0,s.kt)("p",null,"The persistence plugin we loaded will add callbacks that ensure cached files\nare automatically promoted to permanent storage on when record is saved, and\nthat attachments are deleted when the record is destroyed."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# no file is attached")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# the assigned file is cached to temporary storage and written to `image_data` column")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"waterfall.jpg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"rb"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_url  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "/uploads/cache/0sdfllasfi842.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"0sdfllasfi842.jpg","storage":"cache","metadata":{...}}\'')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# the cached file is promoted to permanent storage and saved to `image_data` column")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.save")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::UploadedFile ...>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_url  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "/uploads/store/l02kladf8jlda.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_data "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> \'{"id":"l02kladf8jlda.jpg","storage":"store","metadata":{...}}\'')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# the attached file is deleted with the record")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.destroy")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.exists? "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false"))))),(0,s.kt)("p",null,"If there is already a file attached and a new file is attached, the previous\nattachment will get deleted when the record gets saved."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.update(image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," new_file) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# changes the attachment and deletes previous")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.update(image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# removes the attachment and deletes previous"))))),(0,s.kt)("h3",{id:"attacher"},"Attacher"),(0,s.kt)("p",null,"The methods and callbacks added by the ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attachment")," module just\ndelegate the behaviour to an underlying ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Shrine::Attacher>"))))),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::Attacher")," object can be instantiated and used directly:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".from_model(photo, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.assign(file) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# equivalent to `photo.image = file`")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file         "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# equivalent to `photo.image`")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.url          "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# equivalent to `photo.image_url`"))))),(0,s.kt)("p",null,"The attacher is what drives attaching files to model instances; you can use it\nas a more explicit alternative to models' attachment interface, or when you\nneed something that's not available through the attachment methods."),(0,s.kt)("p",null,"See ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/attacher"},"Using Attacher")," guide for more details."),(0,s.kt)("h3",{id:"temporary-storage"},"Temporary storage"),(0,s.kt)("p",null,"Shrine uses temporary storage to support ",(0,s.kt)("a",{parentName:"p",href:"#validation"},"file validation")," and\n",(0,s.kt)("a",{parentName:"p",href:"#direct-uploads"},"direct uploads"),". If you don't need these features, you can tell Shrine to\nupload files directly to permanent storage:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":model"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"false"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"waterfall.jpg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"rb"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store"))))),(0,s.kt)("p",null,"If you're using the attacher directly, you can just use ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#attach"),"\ninstead of ",(0,s.kt)("inlineCode",{parentName:"p"},"Attacher#assign"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.attach "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"waterfall.jpg"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"rb"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"attacher.file.storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :store"))))),(0,s.kt)("h2",{id:"plugin-system"},"Plugin system"),(0,s.kt)("p",null,"By default, Shrine comes with a small core which provides only the essential\nfunctionality. All additional features are available via ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/plugins"},"plugins"),", which also\nship with Shrine. This way you can choose exactly what and how much Shrine does\nfor you, and you load the code only for features that you use."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds instrumentation"))))),(0,s.kt)("p",null,"Plugins add behaviour by extending Shrine core classes via module inclusion, and\nmany of them also accept configuration options. The plugin system respects\ninheritance, so you can choose to load a plugin globally or per uploader."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store_dimensions"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# extract image dimensions only for this uploader and its descendants")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"If you want to extend Shrine functionality with custom behaviour, you can also\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/creating-plugins"},"create your own plugin"),". There are also additional ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/external/extensions#plugins"},"external\nplugins")," created by others."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"NOTE: An uploader class will inherit a copy of current superclass' plugin\noptions at the time of subclassing. This means you should ",(0,s.kt)("em",{parentName:"p"},"not")," load\nadditional plugins on a superclass after the subclass has already been\ncreated, because new options will not get applied to the subclass, which\ncan result in errors.")),(0,s.kt)("h2",{id:"metadata"},"Metadata"),(0,s.kt)("p",null,"Shrine automatically extracts some basic file metadata and saves them to the\n",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine::UploadedFile"),". You can access them through the ",(0,s.kt)("inlineCode",{parentName:"p"},"#metadata")," hash or via\nmetadata methods:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.metadata "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=>")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "filename" => "matrix.mp4",')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "mime_type" => "video/mp4",')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   "size" => 345993,')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.original_filename "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "matrix.mp4"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.extension         "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "mp4"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.mime_type         "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "video/mp4"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.size              "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 345993"))))),(0,s.kt)("h3",{id:"mime-type"},"MIME type"),(0,s.kt)("p",null,"By default, ",(0,s.kt)("inlineCode",{parentName:"p"},"mime_type")," metadata will be set from the ",(0,s.kt)("inlineCode",{parentName:"p"},"#content_type")," attribute\nof the uploaded file (if it exists), which is generally not secure and will\ntrigger a warning. You can load the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/determine_mime_type"},(0,s.kt)("inlineCode",{parentName:"a"},"determine_mime_type"))," plugin to have MIME type extracted from file ",(0,s.kt)("em",{parentName:"p"},"content")," instead."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"marcel"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 0.3"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":determine_mime_type"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", analyzer"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":marcel"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"StringIO"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<?php ... ?>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"))")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.mime_type "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "application/x-php"'))))),(0,s.kt)("h3",{id:"other-metadata"},"Other metadata"),(0,s.kt)("p",null,"In addition to basic metadata, you can also extract ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/store_dimensions"},"image\ndimensions"),", calculate ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/signature"},"signatures"),",\nand in general extract any ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/add_metadata"},"custom metadata"),". Check out\nthe ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/metadata"},"Extracting Metadata")," guide for more details."),(0,s.kt)("h2",{id:"processing"},"Processing"),(0,s.kt)("p",null,'Shrine allows you to process attached files both "eagerly" and "on-the-fly".\nFor example, if your app is accepting image uploads, you can generate a\npredefined set of thumbnails when the image is attached to a record, or you\ncan have thumbnails generated dynamically as they\'re needed.'),(0,s.kt)("p",null,"For image processing, it's recommended to use the ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://github.com/janko/image_processing"},"ImageProcessing"))," gem,\nwhich is a high-level wrapper for processing with\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/image_processing/blob/master/doc/minimagick.md#readme"},"MiniMagick")," and ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/image_processing/blob/master/doc/vips.md#readme"},"libvips"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"$ brew install imagemagick vips\n")),(0,s.kt)("h3",{id:"eager-processing"},"Eager processing"),(0,s.kt)("p",null,"We can use the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivatives"},(0,s.kt)("inlineCode",{parentName:"a"},"derivatives"))," plugin to generate a\npre-defined set of processed files (e.g. image thumbnails). We do this by\nregistering a derivatives processor block and then explicitly triggering\ncreation:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 1.8"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":derivatives"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", create_on_promote"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing/mini_magick"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".derivatives "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |original|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    magick "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageProcessing"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MiniMagick"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".source(original)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  magick.resize_to_limit!("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"800"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"800"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      medium"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," magick.resize_to_limit!("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"500"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"500"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      small"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  magick.resize_to_limit!("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"300"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"300"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Photo"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(image"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.save "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# automatically creates derivatives on promotion"))))),(0,s.kt)("p",null,"You can then retrieve the URL of a processed derivative:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image_url("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "https://s3.amazonaws.com/path/to/large.jpg"'))))),(0,s.kt)("p",null,"The derivatives data is stored in the ",(0,s.kt)("inlineCode",{parentName:"p"},"<attachment>_data")," column, and you can\nretrieve them as ",(0,s.kt)("a",{parentName:"p",href:"#uploaded-file"},(0,s.kt)("inlineCode",{parentName:"a"},"Shrine::UploadedFile"))," objects:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")           "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Shrine::UploadedFile id="path/to/large.jpg" storage=:store metadata={...}>')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},").url       "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "https://s3.amazonaws.com/path/to/large.jpg"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},").size      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 5825949")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":large"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},").mime_type "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"'))))),(0,s.kt)("p",null,"For more details, see the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/processing"},"File Processing")," guide and the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivatives"},(0,s.kt)("inlineCode",{parentName:"a"},"derivatives"))," plugin documentation."),(0,s.kt)("h3",{id:"on-the-fly-processing"},"On-the-fly processing"),(0,s.kt)("p",null,"On-the-fly processing is provided by the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivation_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"derivation_endpoint"))," plugin. To set it up, we\nconfigure the plugin with a secret key and a path prefix, ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints"},"mount")," its Rack app in our routes on the configured path prefix, and define\nprocessing we want to perform:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 1.8"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/initializers/rails.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":derivation_endpoint"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", secret_key"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"<YOUR_SECRET_KEY>"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image_processing/mini_magick"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":derivation_endpoint"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"derivations/image"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# matches mount point")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  derivation "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumbnail"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |file, width, height|")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageProcessing"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"MiniMagick")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      .source(file)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      .resize_to_limit!(width.to_i, height.to_i)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".derivation_endpoint "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/derivations/image"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"Now we can generate URLs from attached files that will perform the desired\nprocessing:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image.derivation_url("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":thumbnail"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"600"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"400"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "/derivations/image/thumbnail/600/400/eyJpZCI6ImZvbyIsInN0b3JhZ2UiOiJzdG9yZSJ9?signature=..."'))))),(0,s.kt)("p",null,"The on-the-fly processing feature is highly customizable, see the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/derivation_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"derivation_endpoint"))," plugin documentation for\nmore details."),(0,s.kt)("h2",{id:"validation"},"Validation"),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/validation"},(0,s.kt)("inlineCode",{parentName:"a"},"validation"))," plugin allows performing validation for\nattached files. For common validations, the\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/validation_helpers"},(0,s.kt)("inlineCode",{parentName:"a"},"validation_helpers"))," plugin provides useful\nvalidators for built in metadata:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":validation_helpers"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"DocumentUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".validate "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_max_size "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"5"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", message"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"is too large (max is 5 MB)"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_mime_type "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[application"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"pdf]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"User"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.cv "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"cv.pdf"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"rb"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.valid? "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> false")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.errors.to_hash "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> {:cv=>["is too large (max is 5 MB)"]}'))))),(0,s.kt)("p",null,"For more details, see the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/validation"},"File Validation")," guide and\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/validation_helpers"},(0,s.kt)("inlineCode",{parentName:"a"},"validation_helpers"))," plugin docs."),(0,s.kt)("h2",{id:"location"},"Location"),(0,s.kt)("p",null,"Shrine automatically generates random locations before uploading files. By\ndefault, the hierarchy is flat, meaning all files are stored in the root\ndirectory of the storage."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"024d9fe83bf4fafb.jpg\n768a336bf54de219.jpg\nadfaa363629f7fc5.png\n...\n")),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/pretty_location"},(0,s.kt)("inlineCode",{parentName:"a"},"pretty_location"))," plugin provides a good default\nhierarchy:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":pretty_location"))))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"user/\n  564/\n    avatar/\n      aa3e0cd715.jpg\n      thumb-493g82jf23.jpg\nphoto/\n  123/\n    image/\n      13f8a7bc18.png\n      thumb-9be62da67e.png\n...\n")),(0,s.kt)("p",null,"But you can also override ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#generate_location")," with a custom\nimplementation, for example:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"generate_location"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"io"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"record"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"derivative"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"return"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"super"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"unless"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," record")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    table  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," record.class.table_name")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    id     "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," record.id")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    prefix "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," derivative "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"||"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"original"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"uploads/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"table"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"}"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"-"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"#{super}"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"uploads/\n  photos/\n    123/\n      original-afe929b8b4.jpg\n      small-ad61f25883.jpg\n      medium-41b75c42bb.jpg\n      large-73e67abe50.jpg\n...\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"There should always be a random component in the location, so that the ORM\ndirty tracking is detected properly.")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"Shrine#generate_location")," method contains a lot of useful context for the\nupcoming upload:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"generate_location"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"io"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"record"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"derivative"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"metadata"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {}, "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"options)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    storage_key "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :cache, :store, ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    io          "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<File>, #<Shrine::UploadedFile>, ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    record      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Photo>, #<User>, ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    name        "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :image, :avatar, ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    derivative  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :small, :medium, :large, ... (derivatives plugin)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    metadata    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> { "filename" => "nature.jpg", "mime_type" => "image/jpeg", "size" => 18573, ... }')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    options     "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> { ... other uploader options ... }")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h2",{id:"direct-uploads"},"Direct uploads"),(0,s.kt)("p",null,"To improve the user experience, it's recommended to upload files asynchronously\nas soon as the user selects them. The direct uploads would go to temporary\nstorage, just like in the synchronous flow. Then, instead of attaching a raw\nfile to your model, you assign the cached file JSON data."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# in the regular synchronous flow")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# in the direct upload flow")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photo.image "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"...","storage":"cache","metadata":{...}}'),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"))))),(0,s.kt)("p",null,"On the client side it's highly recommended to use ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://uppy.io"},"Uppy")),", a very flexible\nmodern JavaScript file upload library that happens to integrate nicely with\nShrine."),(0,s.kt)("h3",{id:"simple-direct-upload"},"Simple direct upload"),(0,s.kt)("p",null,"The simplest approach is to upload directly to an endpoint in your app, which\nforwards uploads to the specified storage. The\n",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/upload_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"upload_endpoint"))," Shrine plugin provides a\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints"},"mountable")," Rack app that implements this endpoint:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":upload_endpoint"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload_endpoint("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/upload"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# POST /upload")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"Then you can configure Uppy's ",(0,s.kt)("a",{parentName:"p",href:"https://uppy.io/docs/xhr-upload/"},"XHR Upload")," plugin to upload to\nthis endpoint. See ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Adding-Direct-App-Uploads"},"this walkthrough")," for adding\nsimple direct uploads from scratch, it includes a complete JavaScript example\n(there is also the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/tree/master/demo"},"Roda")," / ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/erikdahlstrand/shrine-rails-example"},"Rails")," demo app)."),(0,s.kt)("h3",{id:"presigned-direct-upload"},"Presigned direct upload"),(0,s.kt)("p",null,"For better performance, you can also upload files directly to your cloud\nstorage service (AWS S3, Google Cloud Storage etc). For this, your temporary\nstorage needs to be your cloud service:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine/storage/s3"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"S3"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"(prefix"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3_options),")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"S3"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3_options)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,s.kt)("p",null,"In this flow, the client needs to first fetch upload parameters from the\nserver, and then use these parameters for the upload to the cloud service.\nThe ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/presign_endpoint"},(0,s.kt)("inlineCode",{parentName:"a"},"presign_endpoint"))," Shrine plugin provides a\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints"},"mountable")," Rack app that generates upload parameters:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":presign_endpoint"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".presign_endpoint("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/s3/params"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# GET /s3/params")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"Then you can configure Uppy's ",(0,s.kt)("a",{parentName:"p",href:"https://uppy.io/docs/aws-s3/"},"AWS S3")," plugin to fetch params from\nyour endpoint before uploading to S3. See ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Adding-Direct-S3-Uploads"},"this walkthrough")," for adding direct uploads to S3 from scratch, it includes a complete\nJavaScript example (there is also the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/tree/master/demo"},"Roda")," / ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/erikdahlstrand/shrine-rails-example"},"Rails"),"\ndemo). See also the ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/direct-s3"},"Direct Uploads to S3")," guide for more details."),(0,s.kt)("h3",{id:"resumable-direct-upload"},"Resumable direct upload"),(0,s.kt)("p",null,"If your app is accepting large uploads, you can improve resilience by making\nthe uploads ",(0,s.kt)("strong",{parentName:"p"},"resumable"),". This can significantly improve experience for users\non slow and flaky internet connections."),(0,s.kt)("h4",{id:"uppy-s3-multipart"},"Uppy S3 Multipart"),(0,s.kt)("p",null,"You can achieve resumable uploads directly to S3 with the ",(0,s.kt)("a",{parentName:"p",href:"https://uppy.io/docs/aws-s3-multipart/"},"AWS S3\nMultipart")," Uppy plugin, accompanied with\n",(0,s.kt)("inlineCode",{parentName:"p"},"uppy_s3_multipart")," Shrine plugin provided by the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/uppy-s3_multipart"},"uppy-s3_multipart")," gem."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"uppy-s3_multipart"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 0.3"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":uppy_s3_multipart"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".uppy_s3_multipart("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/s3/multipart"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"See the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/uppy-s3_multipart"},"uppy-s3_multipart")," docs for more details."),(0,s.kt)("h4",{id:"tus-protocol"},"Tus protocol"),(0,s.kt)("p",null,"If you want a more generic approach, you can build your resumable uploads on\n",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://tus.io"},"tus"))," \u2013 an open resumable upload protocol. On the server side you can use\nthe ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/tus-ruby-server"},"tus-ruby-server")," gem, on the client side Uppy's ",(0,s.kt)("a",{parentName:"p",href:"https://uppy.io/docs/tus/"},"Tus")," plugin,\nand the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine-tus"},"shrine-tus")," gem for the glue."),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"tus-server"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 2.0"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine-tus"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"~> 2.1"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"shrine/storage/tus"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," {")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Storage"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Tus"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# tus server acts as temporary storage")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," ...,                      "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# your permanent storage")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# config/routes.rb (Rails)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".application.routes.draw "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  mount "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Tus"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Server"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,s.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/files"),(0,s.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("p",null,"See ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Adding-Resumable-Uploads"},"this walkthrough")," for adding tus-powered\nresumable uploads from scratch, it includes a complete JavaScript example\n(there is also a ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine-tus-demo"},"demo app"),"). See also ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine-tus"},"shrine-tus")," and\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/janko/tus-ruby-server"},"tus-ruby-server")," docs for more details."),(0,s.kt)("h2",{id:"backgrounding"},"Backgrounding"),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/backgrounding"},(0,s.kt)("inlineCode",{parentName:"a"},"backgrounding"))," plugin allows you to move file promotion\nand deletion into a background job, using the backgrounding library ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Backgrounding-Libraries"},"of your\nchoice"),":"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":backgrounding")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".promote_block "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"PromoteJob"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".perform_async("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"self"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".class.name, record.class.name, record.id, name, file_data)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".destroy_block "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"DestroyJob"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".perform_async("),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"self"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".class.name, data)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"PromoteJob")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sidekiq"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Worker")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"perform"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"attacher_class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"record_class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"record_id"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"file_data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher_class "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Object"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".const_get(attacher_class)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    record         "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Object"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".const_get(record_class).find(record_id) "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# if using Active Record")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," attacher_class.retrieve(model"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," record, name"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," name, file"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file_data)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher.atomic_promote")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"rescue"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"AttachmentChanged"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"RecordNotFound")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# attachment has changed or the record has been deleted, nothing to do")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"DestroyJob")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sidekiq"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Worker")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#62E884"}},"perform"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"attacher_class"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,s.kt)("span",{parentName:"span",style:{color:"#FFB86C",fontStyle:"italic"}},"data"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher_class "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Object"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".const_get(attacher_class)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," attacher_class.from_data(data)")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    attacher.destroy")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,s.kt)("h2",{id:"clearing-cache"},"Clearing cache"),(0,s.kt)("p",null,"Shrine doesn't automatically delete files uploaded to temporary storage, instead\nyou should set up a separate recurring task that will automatically delete old\ncached files."),(0,s.kt)("p",null,"Most Shrine storage classes come with a ",(0,s.kt)("inlineCode",{parentName:"p"},"#clear!")," method, which you can call in\na recurring script. For FileSystem and S3 storage it would look like this:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# FileSystem storage")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"file_system "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"file_system.clear! { |path| path.mtime "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Time"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".now "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"-"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"7"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"24"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"60"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"60"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," } "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# delete files older than 1 week"))))),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# S3 storage")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3 "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".storages["),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":cache"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3.clear! { |object| object.last_modified "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Time"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".now "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"-"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"7"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"24"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"60"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"60"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," } "),(0,s.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# delete files older than 1 week"))))),(0,s.kt)("p",null,"For S3, it may be easier and cheaper to use ",(0,s.kt)("a",{parentName:"p",href:"http://docs.aws.amazon.com/AmazonS3/latest/UG/lifecycle-configuration-bucket-no-versioning.html"},"S3 bucket lifecycle expiration rules"),"  instead."),(0,s.kt)("h2",{id:"logging"},"Logging"),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/instrumentation"},(0,s.kt)("inlineCode",{parentName:"a"},"instrumentation"))," plugin sends and logs events for\nimportant operations:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", notifications"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveSupport"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Notifications")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"}),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload(io, "),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.exists?")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.download")),"\n",(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.delete"))))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'Metadata (32ms) \u2013 {:storage=>:store, :io=>StringIO, :uploader=>Shrine}\nUpload (1523ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :io=>StringIO, :upload_options=>{}, :uploader=>Shrine}\nExists (755ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :uploader=>Shrine}\nDownload (1002ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :download_options=>{}, :uploader=>Shrine}\nDelete (700ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :uploader=>Shrine}\n')),(0,s.kt)("p",null,"Some plugins add their own instrumentation as well when they detect that the\n",(0,s.kt)("inlineCode",{parentName:"p"},"instrumentation")," plugin has been loaded. For that to work, the\n",(0,s.kt)("inlineCode",{parentName:"p"},"instrumentation")," plugin needs to be loaded ",(0,s.kt)("em",{parentName:"p"},"before")," any of these plugins."),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:"left"},"Plugin"),(0,s.kt)("th",{parentName:"tr",align:"left"},"Instrumentation"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"derivation_endpoint")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments file processing")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"derivatives")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments file processing")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"determine_mime_type")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments analyzing MIME type")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"store_dimensions")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments extracting image dimensions")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"signature")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments calculating signature")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"infer_extension")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments inferring extension")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"remote_url")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments remote URL downloading")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"data_uri")),(0,s.kt)("td",{parentName:"tr",align:"left"},"instruments data URI parsing")))),(0,s.kt)("p",null,"For instrumentation, warnings, and other logging, Shrine uses its internal\nlogger. You can tell Shrine to use a different logger. For example, if you're\nusing Rails, you might want to tell it to use the Rails logger:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger"))))),(0,s.kt)("p",null,"In tests you might want to tell Shrine to log only warnings:"),(0,s.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,s.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,s.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,s.kt)("span",{parentName:"code",className:"line"},(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger.level "),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,s.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,s.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Logger"),(0,s.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,s.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"WARN"))))))}y.isMDXComponent=!0}}]);