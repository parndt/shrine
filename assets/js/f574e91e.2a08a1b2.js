"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5739],{3905:(e,a,t)=>{t.d(a,{Zo:()=>m,kt:()=>k});var n=t(7294);function p(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){p(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,p=function(e,a){if(null==e)return{};var t,n,p={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(p[t]=e[t]);return p}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(p[t]=e[t])}return p}var o=n.createContext({}),i=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},m=function(e){var a=i(e.components);return n.createElement(o.Provider,{value:a},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},N=n.forwardRef((function(e,a){var t=e.components,p=e.mdxType,r=e.originalType,o=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=i(t),N=p,k=c["".concat(o,".").concat(N)]||c[N]||d[N]||r;return t?n.createElement(k,l(l({ref:a},m),{},{components:t})):n.createElement(k,l({ref:a},m))}));function k(e,a){var t=arguments,p=a&&a.mdxType;if("string"==typeof e||p){var r=t.length,l=new Array(r);l[0]=N;var s={};for(var o in a)hasOwnProperty.call(a,o)&&(s[o]=a[o]);s.originalType=e,s[c]="string"==typeof e?e:p,l[1]=s;for(var i=2;i<r;i++)l[i]=t[i];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}N.displayName="MDXCreateElement"},4527:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>m,contentTitle:()=>o,default:()=>k,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=t(7462),p=t(3366),r=(t(7294),t(3905)),l=["components"],s={title:"Shrine 2.6.0"},o=void 0,i={unversionedId:"release_notes/2.6.0",id:"release_notes/2.6.0",title:"Shrine 2.6.0",description:"New plugins",source:"@site/../doc/release_notes/2.6.0.md",sourceDirName:"release_notes",slug:"/release_notes/2.6.0",permalink:"/docs/release_notes/2.6.0",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/release_notes/2.6.0.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1571049580,formattedLastUpdatedAt:"Oct 14, 2019",frontMatter:{title:"Shrine 2.6.0"},sidebar:"release_notes",previous:{title:"Shrine 2.6.1",permalink:"/docs/release_notes/2.6.1"},next:{title:"Shrine 2.5.0",permalink:"/docs/release_notes/2.5.0"}},m={},c=[{value:"New plugins",id:"new-plugins",level:2},{value:"New features",id:"new-features",level:2},{value:"Performance improvements",id:"performance-improvements",level:2},{value:"Other improvements",id:"other-improvements",level:2},{value:"Backwards compatibility",id:"backwards-compatibility",level:2}],d={toc:c},N="wrapper";function k(e){var a=e.components,t=(0,p.Z)(e,l);return(0,r.kt)(N,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"new-plugins"},"New plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"signature")," plugin which allows you to calculate a\nSHA{1,256,384,512}/MD5/CRC32 hash of a file, in raw, hex or base64 encoding.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":signature")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".calculate_signature(io, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":md5"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "8c7dd922ad47494fc02c388e12c00eac"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".calculate_signature(io, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":md5"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", format"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":base64"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "jH3ZIq1HSU/ALDiOEsAOrA==\\n"'))))),(0,r.kt)("p",null,"  You can then easily create a new metadata field with the calculated hash:"),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":signature")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":add_metadata")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"MyUploader"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".add_metadata "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":md5"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |io, context|")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  calculate_signature(io, "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":md5"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"metadata_attibutes")," plugin which allows you to sync attachment\nmetadata to additional record attributes.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":metadata_attributes")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Syncs `size` metadata to `#<attachment>_size` record attribute, and")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# `mime_type` metadata to `#<attachment>_type` record attribute.")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".metadata_attributes "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"size "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":size"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"mime_type "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":type")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," image")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar.metadata["),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"size"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]      "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 95724")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_size                  "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 95724")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar.metadata["),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"mime_type"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_type                  "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_size "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"user.avatar_type "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> nil"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_metadata")," plugin (extracted from the ",(0,r.kt)("inlineCode",{parentName:"li"},"restore_cached_data"),"\nplugin) which allows you to re-extract metadata from an uploaded file.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":refresh_metadata")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.refresh_metadata!")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.metadata "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# re-extracted metadata"))))),(0,r.kt)("h2",{id:"new-features"},"New features"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.determine_mime_type")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.mime_type_analyzers")," methods\nto ",(0,r.kt)("inlineCode",{parentName:"li"},"determine_mime_type")," plugin for extracting MIME type from a file.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":determine_mime_type")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".determine_mime_type(io) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# calls the defined analyzer")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".mime_type_analyzers["),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":file"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"].call(io) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# calls a built-in analyzer")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/jpeg"'))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.extract_dimensions")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.dimensions_analyzers")," methods\nto ",(0,r.kt)("inlineCode",{parentName:"li"},"store_dimensions")," plugin for extracting dimensions from a file.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store_dimensions")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".extract_dimensions(io) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# calls the defined analyzer")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> [300, 400]")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".dimensions_analyzers["),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":fastimage"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"].call(io) "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# calls a built-in analyzer")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> [300, 400]"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.data_uri")," method to ",(0,r.kt)("inlineCode",{parentName:"li"},"data_uri")," plugin for converting a data URI\ninto an IO object.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":data_uri")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".data_uri("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"data:image/png;base64,9kfg07a80ihtiort87t85"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io.content_type "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/png"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io.size         "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 482"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"Shrine.rack_file")," method to ",(0,r.kt)("inlineCode",{parentName:"li"},"rack_file")," plugin for converting the Rack\nuploaded file hash into an IO object.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":rack_file")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"file_hash "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=>")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# {")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :name => "file",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :filename => "cats.png",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :type => "image/png",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#   :tempfile => #<Tempfile:/var/folders/3n/3asd/-Tmp-/RackMultipart201-1476-nfw2-0>,")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#   :head => "Content-Disposition: form-data; ...",')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# }")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,r.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".rack_file(file_hash)")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io.original_filename "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "cats.png"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io.content_type      "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "image/png"')),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"io.size              "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 58342"))))),(0,r.kt)("h2",{id:"performance-improvements"},"Performance improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Improved performance of parsing data URIs up to 10x by switching from regex\nmatching to ",(0,r.kt)("inlineCode",{parentName:"p"},"StringScanner"),", and the intermediary base64-encoded content\nstring is now deallocated after it's decoded.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"UploadedFile#base64")," now deallocates the intermediary binary content string\nafter converting it to base64 format in ",(0,r.kt)("inlineCode",{parentName:"p"},"data_uri")," plugin.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The default multipart copy threshold for ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3")," has been\nbumped from 15MB to 100MB, which is about the size where parallelized\nmultipart copy starts being faster.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Uploading files from ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem")," storage to ",(0,r.kt)("inlineCode",{parentName:"p"},"S3")," storage will now utilize\naws-sdk's parallelized multipart upload on files with 15MB or above, which is\nthe scenario when your temporary storage is ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem")," and permanent\nstorage is ",(0,r.kt)("inlineCode",{parentName:"p"},"S3"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3#download")," now uses only one file descriptor.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"logging")," plugin doesn't require the ",(0,r.kt)("inlineCode",{parentName:"p"},"benchmark")," standard library anymore,\nwhich reduces the memory footprint."))),(0,r.kt)("h2",{id:"other-improvements"},"Other improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Fixed wrong implementation of ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem#clear!(older_than:\nexpiration_date)"),", where in common scenarios it wouldn't delete old files, or\nit would incorrectly delete files which still didn't pass the expiration\ndate.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"delete_raw")," plugin now deletes any uploaded IO objects that respond to\n",(0,r.kt)("inlineCode",{parentName:"p"},"#path"),", not just ",(0,r.kt)("inlineCode",{parentName:"p"},"Tempfile")," objects (this includes ",(0,r.kt)("inlineCode",{parentName:"p"},"File"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"ActionDispatch::Http::UploadedFile"),", and\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Plugins::RackFile::UploadedFile")," objects).")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"rack_file")," plugin now works with Grape.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"data_uri")," plugin now accepts URI-encoded raw data URIs.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"data_uri")," plugin now accepts data URIs with additional media type params.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3")," now accepts separate multipart thresholds for uploading\nand for copying.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3#object")," is now public, which returns an ",(0,r.kt)("inlineCode",{parentName:"p"},"Aws::S3::Object"),"\nrepresenting the file."))),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"s3.object("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image.jpg"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> #<Aws::S3::Object bucket_name="your-bucket" key="image.jpg">'))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Added ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3#client")," method for quicker access to the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Aws::S3::Client")," instance.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'The "S3" component of the ',(0,r.kt)("inlineCode",{parentName:"p"},"aws-sdk")," gem is now eagerly loaded in\n",(0,r.kt)("inlineCode",{parentName:"p"},"lib/shrine/storage/s3.rb"),", to remove possibility of autoloading causing\nerrors in multi-threaded systems.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::FileSystem#path")," is now public, which returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"Pathname"),"\nto the file."))),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"filesystem.path("),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image.jpg"),(0,r.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> #<Pathname:public/image.jpg>"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Shrine now checks whether ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine#generate_location")," happened to return nil,\nand raises ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Error"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#finalize")," can now be called even when the attachment hasn't changed.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Added ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#changed?")," alias to ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#attached?"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The logic for rejecting attachments that are already the current attachment\nhas been moved from ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#assign")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Attacher#set"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"remove_invalid")," plugin will now only remove new invalid attachments.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"tempfile")," standard library is now correctly required in ",(0,r.kt)("inlineCode",{parentName:"p"},"lib/shrine.rb"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Improved default validation error messages in ",(0,r.kt)("inlineCode",{parentName:"p"},"validation_helpers")," plugin.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Blacklisted MIME types and extensions are now excluded from the default error\nmessage for security reasons.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"add_metadata")," plugin now also accepts hashes with symbol keys.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The loaded plugin module is now returned when calling ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine.plugin"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Improved visibility of Shrine deprecation warnings."))),(0,r.kt)("h2",{id:"backwards-compatibility"},"Backwards compatibility"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Passing regexes to ",(0,r.kt)("inlineCode",{parentName:"li"},"validate_(mime_type|extension)_(inclusion|exclusion)")," has\nbeen deprecated due to lack of usefulness and for security reasons, from now\non you should always pass plain strings.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# deprecated")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"validate_mime_type_inclusion ["),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"\\/"),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"validate_extension_inclusion ["),(0,r.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/jpe?g/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"}),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# use strings instead")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"validate_mime_type_inclusion "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gif ...]")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"validate_extension_inclusion "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[jpg jpeg png gif ...]"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Previously the ",(0,r.kt)("inlineCode",{parentName:"li"},"validate_(max|min)_(width|height)")," validations would ignore\n",(0,r.kt)("inlineCode",{parentName:"li"},"width")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"height")," being nil, but this is now deprecated and in Shrine 3\nthis will return an error. You should make sure that the file is of the right\ntype before validating dimensions.")),(0,r.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,r.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,r.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"if"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," validate_mime_type_inclusion "),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png image"),(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gif]")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  validate_max_width "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1000")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  validate_max_height "),(0,r.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1000")),"\n",(0,r.kt)("span",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Passing a Rack uploaded file hash to ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine#upload")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine#store")," is\nnow deprecated in ",(0,r.kt)("inlineCode",{parentName:"p"},"rack_file")," plugin, use ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine.rack_file")," to first convert\nthe Rack hash into an IO object.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Deprecated passing ",(0,r.kt)("inlineCode",{parentName:"p"},":multipart_threshold")," option as an integer in\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3"),", use a hash with ",(0,r.kt)("inlineCode",{parentName:"p"},":upload")," and ",(0,r.kt)("inlineCode",{parentName:"p"},":copy")," keys.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Deprecated ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3#s3")," in favour of\n",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Storage::S3#client"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Shrine::Plugins::DataUri::DataFile")," isn't a subclass of ",(0,r.kt)("inlineCode",{parentName:"p"},"StringIO"),"\nanymore, instead it uses composition to delegate only a subset of IO methods\nto the underlying ",(0,r.kt)("inlineCode",{parentName:"p"},"StringIO")," object. This shouldn't cause any backwards\ncompatibility unless the user was relying on it to be a subclass of\n",(0,r.kt)("inlineCode",{parentName:"p"},"StringIO"),"."))))}k.isMDXComponent=!0}}]);