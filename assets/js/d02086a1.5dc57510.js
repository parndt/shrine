"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2429],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>N});var n=t(7294);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){s(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},p=Object.keys(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var o=n.createContext({}),m=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},c=function(e){var a=m(e.components);return n.createElement(o.Provider,{value:a},e.children)},i="mdxType",F={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,s=e.mdxType,p=e.originalType,o=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),i=m(t),d=s,N=i["".concat(o,".").concat(d)]||i[d]||F[d]||p;return t?n.createElement(N,l(l({ref:a},c),{},{components:t})):n.createElement(N,l({ref:a},c))}));function N(e,a){var t=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var p=t.length,l=new Array(p);l[0]=d;var r={};for(var o in a)hasOwnProperty.call(a,o)&&(r[o]=a[o]);r.originalType=e,r[i]="string"==typeof e?e:s,l[1]=r;for(var m=2;m<p;m++)l[m]=t[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5162:(e,a,t)=>{t.d(a,{Z:()=>l});var n=t(7294),s=t(6010);const p={tabItem:"tabItem_Ymn6"};function l(e){var a=e.children,t=e.hidden,l=e.className;return n.createElement("div",{role:"tabpanel",className:(0,s.Z)(p.tabItem,l),hidden:t},a)}},4866:(e,a,t)=>{t.d(a,{Z:()=>b});var n=t(7462),s=t(7294),p=t(6010),l=t(2466),r=t(6550),o=t(1980),m=t(7392),c=t(12);function i(e){return function(e){var a,t;return null!=(a=null==(t=s.Children.map(e,(function(e){if(!e||(0,s.isValidElement)(e)&&(a=e.props)&&"object"==typeof a&&"value"in a)return e;var a;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?a:[]}(e).map((function(e){var a=e.props;return{value:a.value,label:a.label,attributes:a.attributes,default:a.default}}))}function F(e){var a=e.values,t=e.children;return(0,s.useMemo)((function(){var e=null!=a?a:i(t);return function(e){var a=(0,m.l)(e,(function(e,a){return e.value===a.value}));if(a.length>0)throw new Error('Docusaurus error: Duplicate values "'+a.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[a,t])}function d(e){var a=e.value;return e.tabValues.some((function(e){return e.value===a}))}function N(e){var a=e.queryString,t=void 0!==a&&a,n=e.groupId,p=(0,r.k6)(),l=function(e){var a=e.queryString,t=void 0!==a&&a,n=e.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,o._X)(l),(0,s.useCallback)((function(e){if(l){var a=new URLSearchParams(p.location.search);a.set(l,e),p.replace(Object.assign({},p.location,{search:a.toString()}))}}),[l,p])]}function k(e){var a,t,n,p,l=e.defaultValue,r=e.queryString,o=void 0!==r&&r,m=e.groupId,i=F(e),k=(0,s.useState)((function(){return function(e){var a,t=e.defaultValue,n=e.tabValues;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+n.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var s=null!=(a=n.find((function(e){return e.default})))?a:n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:l,tabValues:i})})),y=k[0],u=k[1],h=N({queryString:o,groupId:m}),E=h[0],f=h[1],b=(a=function(e){return e?"docusaurus.tab."+e:null}({groupId:m}.groupId),t=(0,c.Nk)(a),n=t[0],p=t[1],[n,(0,s.useCallback)((function(e){a&&p.set(e)}),[a,p])]),g=b[0],v=b[1],C=function(){var e=null!=E?E:g;return d({value:e,tabValues:i})?e:null}();return(0,s.useLayoutEffect)((function(){C&&u(C)}),[C]),{selectedValue:y,selectValue:(0,s.useCallback)((function(e){if(!d({value:e,tabValues:i}))throw new Error("Can't select invalid tab value="+e);u(e),f(e),v(e)}),[f,v,i]),tabValues:i}}var y=t(2389);const u={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function h(e){var a=e.className,t=e.block,r=e.selectedValue,o=e.selectValue,m=e.tabValues,c=[],i=(0,l.o5)().blockElementScrollPositionUntilNextRender,F=function(e){var a=e.currentTarget,t=c.indexOf(a),n=m[t].value;n!==r&&(i(a),o(n))},d=function(e){var a,t=null;switch(e.key){case"Enter":F(e);break;case"ArrowRight":var n,s=c.indexOf(e.currentTarget)+1;t=null!=(n=c[s])?n:c[0];break;case"ArrowLeft":var p,l=c.indexOf(e.currentTarget)-1;t=null!=(p=c[l])?p:c[c.length-1]}null==(a=t)||a.focus()};return s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,p.Z)("tabs",{"tabs--block":t},a)},m.map((function(e){var a=e.value,t=e.label,l=e.attributes;return s.createElement("li",(0,n.Z)({role:"tab",tabIndex:r===a?0:-1,"aria-selected":r===a,key:a,ref:function(e){return c.push(e)},onKeyDown:d,onClick:F},l,{className:(0,p.Z)("tabs__item",u.tabItem,null==l?void 0:l.className,{"tabs__item--active":r===a})}),null!=t?t:a)})))}function E(e){var a=e.lazy,t=e.children,n=e.selectedValue,p=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){var l=p.find((function(e){return e.props.value===n}));return l?(0,s.cloneElement)(l,{className:"margin-top--md"}):null}return s.createElement("div",{className:"margin-top--md"},p.map((function(e,a){return(0,s.cloneElement)(e,{key:a,hidden:e.props.value!==n})})))}function f(e){var a=k(e);return s.createElement("div",{className:(0,p.Z)("tabs-container",u.tabList)},s.createElement(h,(0,n.Z)({},e,a)),s.createElement(E,(0,n.Z)({},e,a)))}function b(e){var a=(0,y.Z)();return s.createElement(f,(0,n.Z)({key:String(a)},e))}},1388:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>F,contentTitle:()=>c,default:()=>y,frontMatter:()=>m,metadata:()=>i,toc:()=>d});var n=t(7462),s=t(3366),p=(t(7294),t(3905)),l=t(4866),r=t(5162),o=["components"],m={id:"multiple-files",title:"Multiple Files"},c=void 0,i={unversionedId:"multiple-files",id:"multiple-files",title:"Multiple Files",description:"There are times when you want to allow users to attach multiple files to a",source:"@site/../doc/multiple_files.md",sourceDirName:".",slug:"/multiple-files",permalink:"/docs/multiple-files",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/multiple_files.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1685660850,formattedLastUpdatedAt:"Jun 1, 2023",frontMatter:{id:"multiple-files",title:"Multiple Files"},sidebar:"guides",previous:{title:"File Validation",permalink:"/docs/validation"},next:{title:"Securing Uploads",permalink:"/docs/securing-uploads"}},F={},d=[{value:"How to Implement",id:"how-to-implement",level:2},{value:"1. Create the main resource and attachment table",id:"1-create-the-main-resource-and-attachment-table",level:3},{value:"2. Declare nested attributes",id:"2-declare-nested-attributes",level:3},{value:"3. Create the View",id:"3-create-the-view",level:3},{value:"4a. Form upload",id:"4a-form-upload",level:3},{value:"4b. Direct upload",id:"4b-direct-upload",level:3},{value:"5. Adding Validations",id:"5-adding-validations",level:3},{value:"Conclusion",id:"conclusion",level:3}],N={toc:d},k="wrapper";function y(e){var a=e.components,t=(0,s.Z)(e,o);return(0,p.kt)(k,(0,n.Z)({},N,t,{components:a,mdxType:"MDXLayout"}),(0,p.kt)("p",null,"There are times when you want to allow users to attach multiple files to a\nsingle resource, like an album having many photos or a playlist having many\nsongs. Some file attachment libraries provide a special interface for multiple\nattachments, but Shrine doesn't have one, because it's more flexible to use\nthe \"nested attributes\" feature of your ORM directly to implement this."),(0,p.kt)("p",null,"The basic idea is to create a separate table that will have a many-to-one\nrelationship with the main table, and files will be attached on the records in\nthe new table. That way each record from the main table can implicitly have\nmultiple attachments through the associated records."),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"album1\n  photo1\n    - attachment1\n  photo2\n    - attachment2\n  photo3\n    - attachment3\n\nalbum2\n  photo4\n    - attachment4\n  photo5\n    - attachment5\n\n...\n")),(0,p.kt)("p",null,"To illustrate, this code will create an album with three photos using nested\nattributes:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".create(")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  title"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"My Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  photos_attributes"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," [")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    { image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image1.jpg"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", binmode"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") },")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    { image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image2.jpg"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", binmode"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") },")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    { image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"File"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"open"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"image3.jpg"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", binmode"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") },")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  ]")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")"))))),(0,p.kt)("p",null,"This design gives you the greatest flexibility, allowing you to support:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"adding new attachments"),(0,p.kt)("li",{parentName:"ul"},"updating existing attachments"),(0,p.kt)("li",{parentName:"ul"},"removing existing attachments"),(0,p.kt)("li",{parentName:"ul"},"sorting attachments (via a separate position column)"),(0,p.kt)("li",{parentName:"ul"},"having additional fields on attachments (e.g. captions, votes, number of downloads etc.)"),(0,p.kt)("li",{parentName:"ul"},'expanding this to be "many-to-many" relation (e.g. create different playlists from a list of songs, etc)'),(0,p.kt)("li",{parentName:"ul"},"...")),(0,p.kt)("h2",{id:"how-to-implement"},"How to Implement"),(0,p.kt)("p",null,'For the rest of this guide, we will use the example where we have "albums" that\ncan have multiple "photos" in it. The main table is the albums table and the\nfiles (or attachments) table will be the photos table.'),(0,p.kt)("h3",{id:"1-create-the-main-resource-and-attachment-table"},"1. Create the main resource and attachment table"),(0,p.kt)("p",null,"Let's create a table for the main resource and attachments, and add a foreign\nkey in the attachment table for the main table:"),(0,p.kt)(l.Z,{mdxType:"Tabs"},(0,p.kt)(r.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".migration "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  change "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    create_table "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":albums"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      primary_key "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":id")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"String"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":title")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    create_table "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      primary_key "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":id")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      foreign_key "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":album_id"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":albums")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"String"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"CreateAlbumsAndPhotos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Migration")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"def"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#62E884"}},"change")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    create_table "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":albums"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |t|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      t.string     "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":title")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      t.timestamps")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    create_table "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |t|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      t.references "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", foreign_key"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      t.text       "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image_data")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"      t.timestamps")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,p.kt)("p",null,"In the Photo model, create a Shrine attachment attribute named ",(0,p.kt)("inlineCode",{parentName:"p"},"image"),"\n(",(0,p.kt)("inlineCode",{parentName:"p"},":image")," matches the ",(0,p.kt)("inlineCode",{parentName:"p"},"_data")," column prefix above):"),(0,p.kt)(l.Z,{mdxType:"Tabs"},(0,p.kt)(r.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Photo"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Base")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ImageUploader"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Attachment"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,p.kt)("h3",{id:"2-declare-nested-attributes"},"2. Declare nested attributes"),(0,p.kt)("p",null,'Using nested attributes is the easiest way to implement any dynamic\n"one-to-many" association. In the Album model we\'ll declare a one-to-many\nrelationship to the photos table, and allow it to directly accept attributes\nfor the associated photo records by enabling nested attributes:'),(0,p.kt)(l.Z,{mdxType:"Tabs"},(0,p.kt)(r.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  one_to_many "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":association_dependencies"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":destroy"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# destroy photos when album is destroyed")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":nested_attributes")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  nested_attributes "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", destroy"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Base")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  has_many "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", dependent"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":destroy")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  accepts_nested_attributes_for "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", allow_destroy"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"mongoid",label:"Mongoid",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Album")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"include"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Mongoid"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"Document")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  embeds_many "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  accepts_nested_attributes_for "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,p.kt)("p",null,"Documentation on nested attributes:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/NestedAttributes.html"},(0,p.kt)("inlineCode",{parentName:"a"},"Sequel::Model.nested_attributes"))),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"http://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html"},(0,p.kt)("inlineCode",{parentName:"a"},"ActiveRecord::Base.accepts_nested_attributes_for"))),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/mongoid/master/tutorials/mongoid-nested-attributes/"},(0,p.kt)("inlineCode",{parentName:"a"},"Mongoid::Document.accepts_nested_attributes_for")))),(0,p.kt)("h3",{id:"3-create-the-view"},"3. Create the View"),(0,p.kt)("p",null,"Create a form like you normally do to create the album. To this form we'll add\na file field for selecting photos, which will have ",(0,p.kt)("inlineCode",{parentName:"p"},"multiple")," attribute to\nallow the user to select multiple files. We'll also display nested fields for\nalready created photos, so that the same form can be used for updating the\nalbum/photos as well (they will be submitted under the\n",(0,p.kt)("inlineCode",{parentName:"p"},"album[photos_attributes]")," parameter)."),(0,p.kt)(l.Z,{mdxType:"Tabs"},(0,p.kt)(r.Z,{value:"rails",label:"Rails form builder",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form_for "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", html"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { enctype"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"multipart/form-data"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," } "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |f|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.text_field "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":title")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.fields_for "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |"),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"| "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds new `album[photos_attributes]` parameter")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".hidden_field "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".object.cached_image_data, id"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".file_field   "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".check_box    "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":_destroy"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"unless"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"p"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".object.new_record?")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  file_field_tag "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"files[]"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", multiple"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.submit "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"Create"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"forme",label:"Forme",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"form "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE",fontStyle:"italic"}},"@album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", action"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"/photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", enctype"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"multipart/form-data"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |f|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":title")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.subform "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# adds new `album[photos_attributes]` parameter")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    f.input "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",   type"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":hidden"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", value"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," f.obj.cached_image_data")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    f.input "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",   type"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":file")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    f.input "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":_delete"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", type"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":checkbox"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"unless"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," f.obj.new?")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.input "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"files[]"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", type"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":file"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", attr"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { multiple"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"true"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," }, obj"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  f.button "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"Create"),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,p.kt)("p",null,"In your controller you should still be able to assign all the attributes to the\nalbum, just remember to whitelist the new parameter for the nested attributes,\nin this case ",(0,p.kt)("inlineCode",{parentName:"p"},"album[photos_attributes]"),"."),(0,p.kt)("h3",{id:"4a-form-upload"},"4a. Form upload"),(0,p.kt)("p",null,"If you would like to avoid writing JavaScript, you can have selected files\nuploaded via the form, and then in your controller you can assign them in the\nformat of nested attributes. You'll want to merge these newly uploaded photos\nwith the existing photos params that will come from the nested form fields.\nThis could look something like this:"),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# In your controller:")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# transform the list of uploaded files into a photos attributes hash")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"new_photos_attributes "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," params["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":files"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"].inject({}) "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |hash, file|")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  hash.merge!("),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"SecureRandom"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".hex "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"=>"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," { image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," file })")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# merge new photos attributes with existing (`album_params` is whitelisted `params[:album]`)")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"photos_attributes "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," album_params["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos_attributes"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"].to_h.merge(new_photos_attributes)")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"album_attributes  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," album_params.merge(photos_attributes"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," photos_attributes)")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# create the album with photos")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".create(album_attributes)"))))),(0,p.kt)("p",null,"In this case you need to make sure your form tag has\n",(0,p.kt)("inlineCode",{parentName:"p"},'enctype="multipart/form-data"')," attributes specified, otherwise form upload\nwon't succeed."),(0,p.kt)("h3",{id:"4b-direct-upload"},"4b. Direct upload"),(0,p.kt)("p",null,"Alternatively, you can have selected files immediately uploaded to a direct\nupload endpoint, as soon as they're selected. It's recommended to use ",(0,p.kt)("a",{parentName:"p",href:"https://uppy.io"},"Uppy"),"\nfor handling client side file uploads. There are two methods of implementing\ndirect uploads: to your app using the ",(0,p.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/upload_endpoint"},(0,p.kt)("inlineCode",{parentName:"a"},"upload_endpoint"))," plugin, or directly\nto a storage like S3 using the ",(0,p.kt)("a",{parentName:"p",href:"https://shrinerb.com/docs/plugins/presign_endpoint"},(0,p.kt)("inlineCode",{parentName:"a"},"presign_endpoint"))," plugin. See the\nwalkthroughs for setting up simple ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Adding-Direct-App-Uploads"},"direct app uploads")," and ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/wiki/Adding-Direct-S3-Uploads"},"direct S3\nuploads"),", as well as the ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/tree/master/demo"},"Roda")," or ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/erikdahlstrand/shrine-rails-example"},"Rails")," demo app\nwhich implement multiple file uploads."),(0,p.kt)("p",null,"Once files are uploaded asynchronously, you can dynamically insert photo\nattachment fields for the ",(0,p.kt)("inlineCode",{parentName:"p"},"image")," attachment attribute into the form, where the\nhidden field is filled with uploaded file data in JSON format, just like when\ndoing single direct uploads. The attachment field names should be namespaced\naccording to the convention that the nested attributes feature expects. In this\ncase it should be ",(0,p.kt)("inlineCode",{parentName:"p"},"album[photos_attributes][<uid>]"),", where ",(0,p.kt)("inlineCode",{parentName:"p"},"<uid>")," is any\nunique string."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# naming format in which photos fields should be generated and submitted")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"album[photos_attributes]["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"11111"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"][image] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"38k25.jpg","storage":"cache","metadata":{...}}'),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"album[photos_attributes]["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"29323"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"][image] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"sg0fg.jpg","storage":"cache","metadata":{...}}'),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"album[photos_attributes]["),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"34820"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"][image] "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"),(0,p.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},'{"id":"041jd.jpg","storage":"cache","metadata":{...}}'),(0,p.kt)("span",{parentName:"span",style:{color:"#DEE492"}},"'"))))),(0,p.kt)("p",null,"In your controller you don't need to make any changes to handle the nested\nphotos attributes (other than allowing them), your ORM will take care of\ncreating, updating, or removing the associated photos."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".create(album_params) "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# or `params[:album]`"))))),(0,p.kt)("h3",{id:"5-adding-validations"},"5. Adding Validations"),(0,p.kt)("p",null,"You can add file validations to the ",(0,p.kt)("inlineCode",{parentName:"p"},"Photo")," model using the\n",(0,p.kt)("inlineCode",{parentName:"p"},"validation_helpers")," plugin. You just need to make sure that your ORM is\nconfigured to automatically validate associated records."),(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"ImageUploader"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":validation_helpers")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  plugin "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":determine_mime_type")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"}),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Attacher"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".validate "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_max_size "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"10"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"*"),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"1024")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"    validate_mime_type "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"%"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"w[image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"jpeg image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"png image"),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"/"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"webp]")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,p.kt)(l.Z,{mdxType:"Tabs"},(0,p.kt)(r.Z,{value:"sequel",label:"Sequel",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Sequel::Model")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ... (nested_attributes already enables validating associated photos) ...")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end")))))),(0,p.kt)(r.Z,{value:"activerecord",label:"Active Record",mdxType:"TabItem"},(0,p.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,p.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,p.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"class"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"Album"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"<"),(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,p.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"ActiveRecord::Base")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,p.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# ...")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  validates_associated "),(0,p.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":photos")),"\n",(0,p.kt)("span",{parentName:"code",className:"line"},(0,p.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))),(0,p.kt)("p",null,"Note that by default only metadata set on the client side will be available for\nvalidations. Shrine will not automatically run metadata extraction for directly\nuploaded files, as this would require (at least partially) downloading each\nfile from storage, which could be an unwanted performance penalty. If you want\nmetadata to be extracted on the server side, you can load the\n",(0,p.kt)("inlineCode",{parentName:"p"},"restore_cached_data")," plugin which will make metadata extraction run on\nassignment, or you can extract the metadata manually (e.g. in a background job)\nusing the ",(0,p.kt)("inlineCode",{parentName:"p"},"refresh_metadata")," plugin."),(0,p.kt)("h3",{id:"conclusion"},"Conclusion"),(0,p.kt)("p",null,"Now we have a simple interface for accepting multiple attachments, which\ninternally uses the nested attributes feature of your ORM to create multiple\nassociated records, each with a single attachment. After creation you can also\nadd new attachments, or update and delete existing ones, which the nested\nattributes feature gives you for free."))}y.isMDXComponent=!0}}]);