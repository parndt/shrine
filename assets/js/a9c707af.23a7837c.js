"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6667],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>N});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),i=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):p(p({},t),e)),a},d=function(e){var t=i(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=i(a),c=r,N=m["".concat(s,".").concat(c)]||m[c]||k[c]||l;return a?n.createElement(N,p(p({ref:t},d),{},{components:a})):n.createElement(N,p({ref:t},d))}));function N(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,p=new Array(l);p[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,p[1]=o;for(var i=2;i<l;i++)p[i]=a[i];return n.createElement.apply(null,p)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},635:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>N,frontMatter:()=>o,metadata:()=>i,toc:()=>m});var n=a(7462),r=a(3366),l=(a(7294),a(3905)),p=["components"],o={title:"Instrumentation"},s=void 0,i={unversionedId:"plugins/instrumentation",id:"plugins/instrumentation",title:"Instrumentation",description:"The instrumentation plugin publishes events for various",source:"@site/../doc/plugins/instrumentation.md",sourceDirName:"plugins",slug:"/plugins/instrumentation",permalink:"/docs/plugins/instrumentation",draft:!1,editUrl:"https://github.com/shrinerb/shrine/edit/master/doc/../doc/plugins/instrumentation.md",tags:[],version:"current",lastUpdatedBy:"Janko Marohni\u0107",lastUpdatedAt:1609073005,formattedLastUpdatedAt:"Dec 27, 2020",frontMatter:{title:"Instrumentation"},sidebar:"plugins",previous:{title:"Included",permalink:"/docs/plugins/included"},next:{title:"Keep Files",permalink:"/docs/plugins/keep_files"}},d={},m=[{value:"Logging",id:"logging",level:2},{value:"Events",id:"events",level:2},{value:"upload.shrine",id:"uploadshrine",level:3},{value:"download.shrine",id:"downloadshrine",level:3},{value:"open.shrine",id:"openshrine",level:3},{value:"exists.shrine",id:"existsshrine",level:3},{value:"delete.shrine",id:"deleteshrine",level:3},{value:"metadata.shrine",id:"metadatashrine",level:3},{value:"API",id:"api",level:2}],k={toc:m},c="wrapper";function N(e){var t=e.components,a=(0,r.Z)(e,p);return(0,l.kt)(c,(0,n.Z)({},k,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"The ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/shrinerb/shrine/blob/master/lib/shrine/plugins/instrumentation.rb"},(0,l.kt)("inlineCode",{parentName:"a"},"instrumentation"))," plugin publishes events for various\noperations to a centralized notification component. In addition to that, it\nprovides default logging for these events."),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"))))),(0,l.kt)("p",null,"By default, the notification component is assumed to be\n",(0,l.kt)("a",{parentName:"p",href:"https://api.rubyonrails.org/classes/ActiveSupport/Notifications.html"},"ActiveSupport::Notifications"),", but ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/dry-rb/dry-monitor"},"dry-monitor")," is supported as well:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# Gemfile")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"gem "),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"dry-monitor"),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'))))),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"require"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"dry-monitor"),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"')),"\n",(0,l.kt)("span",{parentName:"code",className:"line"}),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", notifications"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Dry"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Monitor"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"::"),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Notifications"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":test"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")"))))),(0,l.kt)("h2",{id:"logging"},"Logging"),(0,l.kt)("p",null,"By default, the ",(0,l.kt)("inlineCode",{parentName:"p"},"instrumentation")," plugin adds logging to the instrumented\nevents:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file "),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".upload("),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"StringIO"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"."),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"new"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"("),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"file"),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"), "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":store"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},")")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.exists?")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.download")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"uploaded_file.delete"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'Metadata (32ms) \u2013 {:storage=>:store, :io=>StringIO, :uploader=>Shrine}\nUpload (1523ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :io=>StringIO, :upload_options=>{}, :uploader=>Shrine}\nExists (755ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :uploader=>Shrine}\nDownload (1002ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :download_options=>{}, :uploader=>Shrine}\nDelete (700ms) \u2013 {:storage=>:store, :location=>"ed0e30ddec8b97813f2c1f4cfd1700b4", :uploader=>Shrine}\n')),(0,l.kt)("p",null,"It uses ",(0,l.kt)("inlineCode",{parentName:"p"},"Shrine.logger")," for logging, which allows you to change where and how\nare the logs going to be written:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger "),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"="),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Rails"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# in Rails apps"))))),(0,l.kt)("p",null,"You can choose to log only certain events, e.g. we can exclude metadata\nextraction:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", log_events"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," [")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":upload"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":exists"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":download"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":delete"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},",")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"]"))))),(0,l.kt)("p",null,"You can also use your own log subscriber:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", log_subscriber"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1"}},"->"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," (event) {")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".logger.info "),(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"JSON"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".generate(name"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," event.name, duration"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," event.duration, "),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"**"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"event.payload)")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"}"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{"name":"metadata","duration":0,"storage":"store","io":"#<StringIO:0x00007fd1d4a1b9d8>","options":{},"uploader":"Shrine"}\n{"name":"upload","duration":0,"storage":"store","location":"dbeb3c3ed664059eb41a608e54a29f54","io":"#<StringIO:0x00007fd1d4a1b9d8>","upload_options":{},"options":{"location":"dbeb3c3ed664059eb41a608e54a29f54","metadata":{"filename":null,"size":4,"mime_type":null}},"uploader":"Shrine"}\n{"name":"exists","duration":0,"storage":"store","location":"dbeb3c3ed664059eb41a608e54a29f54","uploader":"Shrine"}\n{"name":"download","duration":0,"storage":"store","location":"dbeb3c3ed664059eb41a608e54a29f54","download_options":{},"uploader":"Shrine"}\n{"name":"delete","duration":0,"storage":"store","location":"dbeb3c3ed664059eb41a608e54a29f54","uploader":"Shrine"}\n')),(0,l.kt)("p",null,"Or disable logging altogether:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".plugin "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":instrumentation"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", log_subscriber"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},"nil"))))),(0,l.kt)("h2",{id:"events"},"Events"),(0,l.kt)("p",null,"The following events are instrumented by the ",(0,l.kt)("inlineCode",{parentName:"p"},"instrumentation")," plugin:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#uploadshrine"},(0,l.kt)("inlineCode",{parentName:"a"},"upload.shrine"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#downloadshrine"},(0,l.kt)("inlineCode",{parentName:"a"},"download.shrine"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#openshrine"},(0,l.kt)("inlineCode",{parentName:"a"},"open.shrine"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#existsshrine"},(0,l.kt)("inlineCode",{parentName:"a"},"exists.shrine"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#deleteshrine"},(0,l.kt)("inlineCode",{parentName:"a"},"delete.shrine"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#metadatashrine"},(0,l.kt)("inlineCode",{parentName:"a"},"metadata.shrine")))),(0,l.kt)("h3",{id:"uploadshrine"},"upload.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"upload.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"Shrine#upload"),", and contains the\nfollowing payload:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":location")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The location of the uploaded file")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":io")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploaded IO object")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":upload_options")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Any upload options that were specified")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":metadata")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Metadata extracted during upload")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":options")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Any additional uploader options")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h3",{id:"downloadshrine"},"download.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"download.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"UploadedFile#stream")," (which includes\n",(0,l.kt)("inlineCode",{parentName:"p"},"UploadedFile#download"),"), and contains the following payload:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":location")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The location of the uploaded file")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":download_options")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Any download options that were specified")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h3",{id:"openshrine"},"open.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"download.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"UploadedFile#open")," or when uploaded\nfile is implicitly opened on calling an IO method."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":location")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The location of the uploaded file")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":download_options")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Any download options that were specified")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h3",{id:"existsshrine"},"exists.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"exists.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"UploadedFile#exists?"),", and contains the\nfollowing payload:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":location")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The location of the uploaded file")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h3",{id:"deleteshrine"},"delete.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"delete.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"UploadedFile#delete"),", and contains the\nfollowing payload:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":location")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The location of the uploaded file")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h3",{id:"metadatashrine"},"metadata.shrine"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"metadata.shrine")," event is logged on ",(0,l.kt)("inlineCode",{parentName:"p"},"Shrine#upload"),", and contains the\nfollowing payload:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Key"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":storage")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The storage identifier")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":io")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploaded IO object")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":options")),(0,l.kt)("td",{parentName:"tr",align:"left"},"Any options sent to the uploader")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},(0,l.kt)("inlineCode",{parentName:"td"},":uploader")),(0,l.kt)("td",{parentName:"tr",align:"left"},"The uploader class that sent the event")))),(0,l.kt)("h2",{id:"api"},"API"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"instrumentation")," plugin adds ",(0,l.kt)("inlineCode",{parentName:"p"},"Shrine.instrument")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"Shrine.subscribe"),"\nmethods:"),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# sends a `my_event.shrine` event to the notifications component")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".instrument("),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":my_event"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},", { foo"),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},":"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," "),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#E7EE98"}},"bar"),(0,l.kt)("span",{parentName:"span",style:{color:"#DEE492"}},'"'),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," }) "),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# do work")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))),(0,l.kt)("div",{"data-rehype-pretty-code-fragment":""},(0,l.kt)("pre",{parentName:"div","data-language":"rb","data-theme":"default"},(0,l.kt)("code",{parentName:"pre","data-language":"rb","data-theme":"default"},(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"# subscribes to `my_event.shrine` events on the notifications component")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#97E1F1",fontStyle:"italic"}},"Shrine"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},".subscribe("),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":my_event"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},") "),(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"do"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}}," |event|")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  event.name "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> :my_event")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  event.payload "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> { foo: "bar", uploader: Shrine }')),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  event["),(0,l.kt)("span",{parentName:"span",style:{color:"#BF9EEE"}},":foo"),(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"] "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},'#=> "bar"')),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F6F6F4"}},"  event.duration "),(0,l.kt)("span",{parentName:"span",style:{color:"#7B7F8B"}},"#=> 15 (in milliseconds)")),"\n",(0,l.kt)("span",{parentName:"code",className:"line"},(0,l.kt)("span",{parentName:"span",style:{color:"#F286C4"}},"end"))))))}N.isMDXComponent=!0}}]);