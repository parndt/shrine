<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metadata">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Extracting Metadata | Shrine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://shrinerb.com/docs/metadata"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Extracting Metadata | Shrine"><meta data-rh="true" name="description" content="Before a file is uploaded, Shrine automatically extracts metadata from it, and"><meta data-rh="true" property="og:description" content="Before a file is uploaded, Shrine automatically extracts metadata from it, and"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shrinerb.com/docs/metadata"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/metadata" hreflang="en"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/metadata" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBFWBJ5DPX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Shrine" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.efb93a3c.css">
<link rel="preload" href="/assets/js/runtime~main.3b0f70eb.js" as="script">
<link rel="preload" href="/assets/js/main.c75c1b94.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shrine</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Guides</a><a class="navbar__item navbar__link" href="/docs/plugins/activerecord">Plugins</a><a class="navbar__item navbar__link" href="/docs/external/extensions">External</a><a class="navbar__item navbar__link" href="/docs/release_notes/3.5.0">Release Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shrinerb/shrine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/advantages">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advantages">Advantages of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/design">Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design">The Design of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/attacher">Using Attacher</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/storage/file-system">Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/file-system">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/s3">AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/memory">Memory</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/direct-s3">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/metadata">Extracting Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/processing">File Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">File Validation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/multiple-files">Extras</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/multiple-files">Multiple Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/securing-uploads">Securing Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing">Testing with Shrine</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/changing-derivatives">Migrating</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-location">Migrating File Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-storage">Migrating File Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/creating-plugins">Extending</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-storages">Writing a Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/upgrading-to-3">Upgrading</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/carrierwave">Upgrading from CarrierWave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/paperclip">Upgrading from Paperclip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/refile">Upgrading from Refile</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Extracting Metadata</h1></header><p>Before a file is uploaded, Shrine automatically extracts metadata from it, and
stores them in the <code>Shrine::UploadedFile</code> object.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(file)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;size&quot; =&gt; 345993,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;filename&quot; =&gt; &quot;matrix.mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;mime_type&quot; =&gt; &quot;video/mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><p>Under the hood, <code>Shrine#upload</code> calls <code>Shrine#extract_metadata</code>, which you can
also use directly to extract metadata from any IO object:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader.extract_metadata(io) </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;size&quot; =&gt; 345993,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;filename&quot; =&gt; &quot;matrix.mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;mime_type&quot; =&gt; &quot;video/mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><p>The following metadata is extracted by default:</p><table><thead><tr><th align="left">Key</th><th align="left">Default source</th></tr></thead><tbody><tr><td align="left"><code>filename</code></td><td align="left">extracted from <code>io.original_filename</code> or <code>io.path</code></td></tr><tr><td align="left"><code>mime_type</code></td><td align="left">extracted from <code>io.content_type</code></td></tr><tr><td align="left"><code>size</code></td><td align="left">extracted from <code>io.size</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-metadata">Accessing metadata<a href="#accessing-metadata" class="hash-link" aria-label="Direct link to Accessing metadata" title="Direct link to Accessing metadata">​</a></h2><p>You can access the stored metadata in three ways:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># via methods (if they&#x27;re defined)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.size</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.original_filename</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.mime_type</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># via the metadata hash</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">size</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">filename</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">mime_type</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># via the #[] operator</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">size</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">filename</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">mime_type</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="controlling-extraction">Controlling extraction<a href="#controlling-extraction" class="hash-link" aria-label="Direct link to Controlling extraction" title="Direct link to Controlling extraction">​</a></h2><p><code>Shrine#upload</code> accepts a <code>:metadata</code> option which accepts the following values:</p><ul><li><p><code>Hash</code> – adds/overrides extracted metadata with the given hash</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(file, metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">filename</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">Matrix[1999].mp4</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">foo</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">bar</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> })</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.original_filename </span><span style="color:#7B7F8B">#=&gt; &quot;Matrix[1999].mp4&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">foo</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]   </span><span style="color:#7B7F8B">#=&gt; &quot;bar&quot;</span></span></code></pre></div></li><li><p><code>false</code> – skips metadata extraction (useful in tests)</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(file, metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">false</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B">#=&gt; {}</span></span></code></pre></div></li><li><p><code>true</code> – forces metadata extraction when a <code>Shrine::UploadedFile</code> is being
uploaded (by default metadata is simply copied over)</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(uploaded_file, metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B"># re-extracted metadata</span></span></code></pre></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mime-type">MIME type<a href="#mime-type" class="hash-link" aria-label="Direct link to MIME type" title="Direct link to MIME type">​</a></h2><p>By default, the <code>mime_type</code> metadata will be copied over from the
<code>#content_type</code> attribute of the input file (if present). However, since
<code>#content_type</code> value comes from the <code>Content-Type</code> header of the upload
request, it&#x27;s <em>not guaranteed</em> to hold the actual MIME type of the file (browser
determines this header based on file extension).</p><p>Moreover, only <code>ActionDispatch::Http::UploadedFile</code>, <code>Shrine::RackFile</code>, and
<code>Shrine::DataFile</code> objects have <code>#content_type</code> defined, so when uploading
objects such as <code>File</code>, the <code>mime_type</code> value will be nil by default.</p><p>To remedy that, Shrine comes with a
<a href="https://shrinerb.com/docs/plugins/determine_mime_type" target="_blank" rel="noopener noreferrer"><code>determine_mime_type</code></a> plugin which is able to extract
the MIME type from IO <em>content</em>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">marcel</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 0.3</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:determine_mime_type</span><span style="color:#F6F6F4">, analyzer</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:marcel</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload </span><span style="color:#97E1F1;font-style:italic">StringIO</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;?php ... ?&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.mime_type </span><span style="color:#7B7F8B">#=&gt; &quot;application/x-php&quot;</span></span></code></pre></div><p>You can choose different analyzers, and even mix-and-match them. See the
<a href="https://shrinerb.com/docs/plugins/determine_mime_type" target="_blank" rel="noopener noreferrer"><code>determine_mime_type</code></a> plugin docs for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-dimensions">Image Dimensions<a href="#image-dimensions" class="hash-link" aria-label="Direct link to Image Dimensions" title="Direct link to Image Dimensions">​</a></h2><p>Shrine comes with a <a href="https://shrinerb.com/docs/plugins/store_dimensions" target="_blank" rel="noopener noreferrer"><code>store_dimensions</code></a> plugin for
extracting image dimensions. It adds <code>width</code> and <code>height</code> metadata values, and
also adds <code>#width</code>, <code>#height</code>, and <code>#dimensions</code> methods to the
<code>Shrine::UploadedFile</code> object.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">fastimage</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># default analyzer</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:store_dimensions</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(image)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">width</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]  </span><span style="color:#7B7F8B">#=&gt; 1600</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">height</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">] </span><span style="color:#7B7F8B">#=&gt; 900</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># convenience methods</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.width      </span><span style="color:#7B7F8B">#=&gt; 1600</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.height     </span><span style="color:#7B7F8B">#=&gt; 900</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.dimensions </span><span style="color:#7B7F8B">#=&gt; [1600, 900]</span></span></code></pre></div><p>By default, the plugin uses <a href="https://github.com/sdsykes/fastimage" target="_blank" rel="noopener noreferrer">FastImage</a> to analyze dimensions, but you can also
have it use <a href="https://github.com/minimagick/minimagick" target="_blank" rel="noopener noreferrer">MiniMagick</a> or <a href="https://github.com/libvips/ruby-vips" target="_blank" rel="noopener noreferrer">ruby-vips</a>. See the
<a href="https://shrinerb.com/docs/plugins/store_dimensions" target="_blank" rel="noopener noreferrer"><code>store_dimensions</code></a> plugin docs for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-metadata">Custom metadata<a href="#custom-metadata" class="hash-link" aria-label="Direct link to Custom metadata" title="Direct link to Custom metadata">​</a></h2><p>In addition to the built-in metadata, Shrine allows you to extract and store
any custom metadata, using the <a href="https://shrinerb.com/docs/plugins/add_metadata" target="_blank" rel="noopener noreferrer"><code>add_metadata</code></a> plugin (which
internally extends <code>Shrine#extract_metadata</code>).</p><p>For example, you might want to extract EXIF data from images:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">exiftool</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">exiftool</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:add_metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  add_metadata </span><span style="color:#BF9EEE">:exif</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, context|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.with_file(io) </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |file|</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#97E1F1;font-style:italic">Exiftool</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(file.path).to_hash</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(image)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata[</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">exif</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">] </span><span style="color:#7B7F8B">#=&gt; {...}</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.exif             </span><span style="color:#7B7F8B">#=&gt; {...}</span></span></code></pre></div><p>Or, if you&#x27;re uploading videos, you might want to extract some video-specific
metadata:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">streamio-ffmpeg</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">streamio-ffmpeg</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">VideoUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:add_metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  add_metadata </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, context|</span></span>
<span class="line"><span style="color:#F6F6F4">    movie </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.with_file(io) { |file| </span><span style="color:#97E1F1;font-style:italic">FFMPEG</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Movie</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(file.path) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    { </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">duration</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">   </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.duration,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">bitrate</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">    </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.bitrate,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">resolution</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.resolution,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">frame_rate</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.frame_rate }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(video)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   ...</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;duration&quot; =&gt; 7.5,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;bitrate&quot; =&gt; 481,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;resolution&quot; =&gt; &quot;640x480&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;frame_rate&quot; =&gt; 16.72</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><p>The yielded <code>io</code> object will not always be an object that responds to <code>#path</code>.
For example, with the <code>data_uri</code> plugin the <code>io</code> can be a <code>StringIO</code> wrapper,
while with <code>restore_cached_data</code> or <code>refresh_metadata</code> plugins the <code>io</code> might
be a <code>Shrine::UploadedFile</code> object. So, we&#x27;re using <code>Shrine.with_file</code> to
ensure we have a file object.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-metadata">Adding metadata<a href="#adding-metadata" class="hash-link" aria-label="Direct link to Adding metadata" title="Direct link to Adding metadata">​</a></h3><p>If you wish to add metadata to an already attached file, you can do it as
follows:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image_attacher.add_metadata(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">foo</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">bar</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.metadata </span><span style="color:#7B7F8B">#=&gt; { ..., &quot;foo&quot; =&gt; &quot;bar&quot; }</span></span>
<span class="line"><span style="color:#F6F6F4">photo.save </span><span style="color:#7B7F8B"># persist changes</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-columns">Metadata columns<a href="#metadata-columns" class="hash-link" aria-label="Direct link to Metadata columns" title="Direct link to Metadata columns">​</a></h2><p>If you want to write any of the metadata values into a separate database column
on the record, you can use the <code>metadata_attributes</code> plugin.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:metadata_attributes</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">mime_type </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:type</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_type </span><span style="color:#7B7F8B">#=&gt; &quot;image/jpeg&quot;</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="direct-uploads">Direct uploads<a href="#direct-uploads" class="hash-link" aria-label="Direct link to Direct uploads" title="Direct link to Direct uploads">​</a></h2><p>When attaching files that were uploaded directly to the cloud or a <a href="https://github.com/janko/tus-ruby-server" target="_blank" rel="noopener noreferrer">tus
server</a>, Shrine won&#x27;t automatically extract metadata from them, instead it will
copy any existing metadata that was set on the client side. The reason why this
is the default behaviour is because metadata extraction requires (at least
partially) retrieving file content from the storage, which could potentially be
expensive depending on the storage and the type of metadata being extracted.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># no additional metadata will be extracted in this assignment by default</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&#x27;</span><span style="color:#E7EE98">{&quot;id&quot;:&quot;9e6581a4ea1.jpg&quot;,&quot;storage&quot;:&quot;cache&quot;,&quot;metadata&quot;:{...}}</span><span style="color:#DEE492">&#x27;</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extracting-on-attachment">Extracting on attachment<a href="#extracting-on-attachment" class="hash-link" aria-label="Direct link to Extracting on attachment" title="Direct link to Extracting on attachment">​</a></h3><p>If you want metadata to be automatically extracted on assignment (which is
useful if you want to validate the extracted metadata or have it immediately
available for any other reason), you can load the <code>restore_cached_data</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:restore_cached_data</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># automatically extract metadata from cached files on assignment</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&#x27;</span><span style="color:#E7EE98">{&quot;id&quot;:&quot;ks9elsd.jpg&quot;,&quot;storage&quot;:&quot;cache&quot;,&quot;metadata&quot;:{}}</span><span style="color:#DEE492">&#x27;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># metadata is extracted</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.metadata </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;size&quot; =&gt; 4593484,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;filename&quot; =&gt; &quot;nature.jpg&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;mime_type&quot; =&gt; &quot;image/jpeg&quot;</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extracting-in-the-background">Extracting in the background<a href="#extracting-in-the-background" class="hash-link" aria-label="Direct link to Extracting in the background" title="Direct link to Extracting in the background">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-extracting-with-promotion">A) Extracting with promotion<a href="#a-extracting-with-promotion" class="hash-link" aria-label="Direct link to A) Extracting with promotion" title="Direct link to A) Extracting with promotion">​</a></h4><p>If you&#x27;re using <a href="https://shrinerb.com/docs/plugins/backgrounding" target="_blank" rel="noopener noreferrer">backgrounding</a>, you can extract metadata during background
promotion using the <code>refresh_metadata</code> plugin (which the <code>restore_cached_data</code>
plugin uses internally):</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:refresh_metadata</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># allow re-extracting metadata</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:backgrounding</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.promote_block </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">PromoteJob</span><span style="color:#F6F6F4">.perform_async(</span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">.class.name, record.class.name, record.id, name, file_data)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PromoteJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.refresh_metadata! </span><span style="color:#7B7F8B"># extract metadata</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_promote</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="b-extracting-separately-from-promotion">B) Extracting separately from promotion<a href="#b-extracting-separately-from-promotion" class="hash-link" aria-label="Direct link to B) Extracting separately from promotion" title="Direct link to B) Extracting separately from promotion">​</a></h4><p>You can also extract metadata in the background separately from promotion:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">MetadataJob</span><span style="color:#F6F6F4">.perform_async(</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.class.name,</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.record.class.name,</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.record.id,</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.name,</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.file_data,</span></span>
<span class="line"><span style="color:#F6F6F4">)</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">MetadataJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.refresh_metadata!</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_persist</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="combining-foreground-and-background">Combining foreground and background<a href="#combining-foreground-and-background" class="hash-link" aria-label="Direct link to Combining foreground and background" title="Direct link to Combining foreground and background">​</a></h3><p>If you have some metadata that you want to extract in the foreground and some
that you want to extract in the background, you can use the uploader context:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">VideoUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:add_metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  add_metadata </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">next</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">unless</span><span style="color:#F6F6F4"> options[</span><span style="color:#BF9EEE">:background</span><span style="color:#F6F6F4">] </span><span style="color:#7B7F8B"># proceed only when `background: true` was specified</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># example of metadata extraction</span></span>
<span class="line"><span style="color:#F6F6F4">    movie </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.with_file(io) { |file| </span><span style="color:#97E1F1;font-style:italic">FFMPEG</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Movie</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(file.path) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    { </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">duration</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">   </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.duration,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">bitrate</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">    </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.bitrate,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">resolution</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.resolution,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">frame_rate</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> movie.frame_rate }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PromoteJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.refresh_metadata!(background</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># specify the flag</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_promote</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>Now triggering metadata extraction in the controller on attachment (using
<code>restore_cached_data</code> or <code>refresh_metadata</code> plugin) will skip the video
metadata block, which will be triggered later in the background job.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimizations">Optimizations<a href="#optimizations" class="hash-link" aria-label="Direct link to Optimizations" title="Direct link to Optimizations">​</a></h3><p>If you want to do both metadata extraction and file processing during
promotion, you can wrap both in an <code>UploadedFile#open</code> block to make
sure the file content is retrieved from the storage only once.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PromoteJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher.file.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">      attacher.refresh_metadata!</span></span>
<span class="line"><span style="color:#F6F6F4">      attacher.create_derivatives</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_promote</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>If you&#x27;re dealing with large files and have metadata extractors that use
<code>Shrine.with_file</code>, you might want to use the <code>tempfile</code> plugin to make sure
the same copy of the uploaded file is reused for both metadata extraction and
file processing.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:tempfile</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># load it globally so that it overrides `Shrine.with_file`</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">attacher.file.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.refresh_metadata!</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.create_derivatives(attacher.file.tempfile)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#7B7F8B"># ...</span></span></code></pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shrinerb/shrine/edit/master/doc/../doc/metadata.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-05-27T10:56:32.000Z">May 27, 2021</time></b> by <b>NILID</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/direct-s3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Direct Uploads to S3</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/processing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">File Processing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#accessing-metadata" class="table-of-contents__link toc-highlight">Accessing metadata</a></li><li><a href="#controlling-extraction" class="table-of-contents__link toc-highlight">Controlling extraction</a></li><li><a href="#mime-type" class="table-of-contents__link toc-highlight">MIME type</a></li><li><a href="#image-dimensions" class="table-of-contents__link toc-highlight">Image Dimensions</a></li><li><a href="#custom-metadata" class="table-of-contents__link toc-highlight">Custom metadata</a><ul><li><a href="#adding-metadata" class="table-of-contents__link toc-highlight">Adding metadata</a></li></ul></li><li><a href="#metadata-columns" class="table-of-contents__link toc-highlight">Metadata columns</a></li><li><a href="#direct-uploads" class="table-of-contents__link toc-highlight">Direct uploads</a><ul><li><a href="#extracting-on-attachment" class="table-of-contents__link toc-highlight">Extracting on attachment</a></li><li><a href="#extracting-in-the-background" class="table-of-contents__link toc-highlight">Extracting in the background</a></li><li><a href="#combining-foreground-and-background" class="table-of-contents__link toc-highlight">Combining foreground and background</a></li><li><a href="#optimizations" class="table-of-contents__link toc-highlight">Optimizations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Janko Marohnić</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b0f70eb.js"></script>
<script src="/assets/js/main.c75c1b94.js"></script>
</body>
</html>