<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-carrierwave">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Upgrading from CarrierWave | Shrine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://shrinerb.com/docs/carrierwave"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgrading from CarrierWave | Shrine"><meta data-rh="true" name="description" content="This guide is aimed at helping CarrierWave users transition to Shrine, and it"><meta data-rh="true" property="og:description" content="This guide is aimed at helping CarrierWave users transition to Shrine, and it"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shrinerb.com/docs/carrierwave"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/carrierwave" hreflang="en"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/carrierwave" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBFWBJ5DPX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Shrine" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.efb93a3c.css">
<link rel="preload" href="/assets/js/runtime~main.3b0f70eb.js" as="script">
<link rel="preload" href="/assets/js/main.ea4eabff.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shrine</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Guides</a><a class="navbar__item navbar__link" href="/docs/plugins/activerecord">Plugins</a><a class="navbar__item navbar__link" href="/docs/external/extensions">External</a><a class="navbar__item navbar__link" href="/docs/release_notes/3.5.0">Release Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shrinerb/shrine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/advantages">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advantages">Advantages of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/design">Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design">The Design of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/attacher">Using Attacher</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/storage/file-system">Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/file-system">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/s3">AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/memory">Memory</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/direct-s3">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata">Extracting Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/processing">File Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">File Validation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/multiple-files">Extras</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/multiple-files">Multiple Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/securing-uploads">Securing Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing">Testing with Shrine</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/changing-derivatives">Migrating</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-location">Migrating File Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-storage">Migrating File Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/creating-plugins">Extending</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-storages">Writing a Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/upgrading-to-3">Upgrading</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/carrierwave">Upgrading from CarrierWave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/paperclip">Upgrading from Paperclip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/refile">Upgrading from Refile</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrading from CarrierWave</h1></header><p>This guide is aimed at helping CarrierWave users transition to Shrine, and it
consists of three parts:</p><ol><li>Explanation of the key differences in design between CarrierWave and Shrine</li><li>Instructions how to migrate an existing app that uses CarrierWave to Shrine</li><li>Extensive reference of CarrierWave&#x27;s interface with Shrine equivalents</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uploader">Uploader<a href="#uploader" class="hash-link" aria-label="Direct link to Uploader" title="Direct link to Uploader">​</a></h3><p>Shrine shares CarrierWave&#x27;s concept of <strong>uploaders</strong>, classes which encapsulate
file attachment logic for different file types:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># attachment logic</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>However, while CarrierWave uploaders are responsible for most of the
attachment logic (uploading to temporary/permanent storage, retrieving the
uploaded file, file validation, processing versions), Shrine distributes
these responsibilities across several core classes:</p><table><thead><tr><th align="left">Class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>Shrine</code></td><td align="left">handles uploads, metadata extraction, location generation</td></tr><tr><td align="left"><code>Shrine::UploadedFile</code></td><td align="left">exposes metadata, implements downloading, URL generation, deletion</td></tr><tr><td align="left"><code>Shrine::Attacher</code></td><td align="left">handles caching &amp; storing, dirty tracking, persistence, versions</td></tr></tbody></table><p>Shrine uploaders themselves are functional: they receive a file on the input
and return the uploaded file on the output. There are no state changes.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader      </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.upload(file, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file          </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.url      </span><span style="color:#7B7F8B">#=&gt; &quot;https://my-bucket.s3.amazonaws.com/store/kfds0lg9rer.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.download </span><span style="color:#7B7F8B">#=&gt; #&lt;File:/tmp/path/to/file&gt;</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">​</a></h3><p>In CarrierWave, you configure storage in global configuration:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">CarrierWave</span><span style="color:#F6F6F4">.configure </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |config|</span></span>
<span class="line"><span style="color:#F6F6F4">  config.fog_provider </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">fog/aws</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">  config.fog_credentials </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">    provider</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">              </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">AWS</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">    aws_access_key_id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">     </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">abc</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">    aws_secret_access_key</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">xyz</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">    region</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">                </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">eu-west-1</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  }</span></span>
<span class="line"><span style="color:#F6F6F4">  config.fog_directory </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">my-bucket</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>In Shrine, the configuration options are passed directly to the storage class:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages[</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">] </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span></span>
<span class="line"><span style="color:#F6F6F4">  bucket</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">my-bucket</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  access_key_id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">     </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">abc</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  secret_access_key</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">xyz</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  region</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">eu-west-1</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">)</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="temporary-storage">Temporary storage<a href="#temporary-storage" class="hash-link" aria-label="Direct link to Temporary storage" title="Direct link to Temporary storage">​</a></h4><p>Where CarrierWave&#x27;s temporary storage is hardcoded to disk, Shrine can use any
storage for temporary storage. So, if you have multiple servers or want to do
<a href="https://shrinerb.com/docs/getting-started#direct-uploads" target="_blank" rel="noopener noreferrer">direct uploads</a>, you can use AWS S3 as temporary storage:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">cache</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options),</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options),</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="persistence">Persistence<a href="#persistence" class="hash-link" aria-label="Direct link to Persistence" title="Direct link to Persistence">​</a></h3><p>While CarrierWave persists only the filename of the original uploaded file,
Shrine persists storage and metadata information as well:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">{</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">id</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">path/to/image.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">storage</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">store</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">metadata</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: {</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">filename</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">nature.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">size</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: </span><span style="color:#BF9EEE">4739472</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">mime_type</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">: </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image/jpeg</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">  }</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span></code></pre></div><p>This way we have all information about uploaded files, without having to
retrieve the file from the storage.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image.id          </span><span style="color:#7B7F8B">#=&gt; &quot;path/to/image.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.storage_key </span><span style="color:#7B7F8B">#=&gt; :store</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.metadata    </span><span style="color:#7B7F8B">#=&gt; { &quot;filename&quot; =&gt; &quot;...&quot;, &quot;size&quot; =&gt; ..., &quot;mime_type&quot; =&gt; &quot;...&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">photo.image.original_filename </span><span style="color:#7B7F8B">#=&gt; &quot;nature.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.size              </span><span style="color:#7B7F8B">#=&gt; 4739472</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.mime_type         </span><span style="color:#7B7F8B">#=&gt; &quot;image/jpeg&quot;</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="location">Location<a href="#location" class="hash-link" aria-label="Direct link to Location" title="Direct link to Location">​</a></h4><p>CarrierWave persists only the filename of the uploaded file, and recalculates
the full location dynamically based on location configuration. This can be
dangerous, because if some component of the location happens to change, all
existing links might become invalid.</p><p>To avoid this, Shrine persists the full location on attachment, and uses it
when generating file URL. So, even if you change how file locations are
generated, existing files that are on old locations will still remain
accessible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="processing">Processing<a href="#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h3><p>CarrierWave uses a class-level DSL for generating versions, which internally
uses uploader subclassing and does in-place processing.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">CarrierWave::Uploader::Base</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">CarrierWave</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">MiniMagick</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  version </span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    process resize_to_limit</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> [</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  version </span><span style="color:#BF9EEE">:medium</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    process resize_to_limit</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> [</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  version </span><span style="color:#BF9EEE">:small</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    process resize_to_limit</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> [</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>In contrast, in Shrine you perform processing on the instance level as a
functional transformation, which is a lot simpler and more flexible:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/mini_magick</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:derivatives</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.derivatives </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    magick </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(original)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    {</span></span>
<span class="line"><span style="color:#F6F6F4">      large</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      medium</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> magick.resize_to_limit!(</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      small</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-versions">Retrieving versions<a href="#retrieving-versions" class="hash-link" aria-label="Direct link to Retrieving versions" title="Direct link to Retrieving versions">​</a></h4><p>When retrieving versions, CarrierWave returns a list of declared versions which
may or may not have been generated. In contrast, Shrine persists data of
uploaded processed files into the database (including any extracted metadata),
which then becomes the source of truth on which versions have been generated.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image              </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;original.jpg&quot; ...&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_derivatives  </span><span style="color:#7B7F8B">#=&gt; {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">photo.image_derivatives! </span><span style="color:#7B7F8B"># triggers processing</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_derivatives  </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   large:  #&lt;Shrine::UploadedFile id=&quot;large.jpg&quot;  metadata={&quot;size&quot;=&gt;873232, ...} ...&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   medium: #&lt;Shrine::UploadedFile id=&quot;medium.jpg&quot; metadata={&quot;size&quot;=&gt;94823,  ...} ...&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   small:  #&lt;Shrine::UploadedFile id=&quot;small.jpg&quot;  metadata={&quot;size&quot;=&gt;37322,  ...} ...&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="reprocessing-versions">Reprocessing versions<a href="#reprocessing-versions" class="hash-link" aria-label="Direct link to Reprocessing versions" title="Direct link to Reprocessing versions">​</a></h4><p>Shrine doesn&#x27;t have a built-in way of regenerating versions, because that has
to be written and optimized differently depending on what versions have changed
which persistence library you&#x27;re using, how many records there are in the table
etc.</p><p>However, there is an extensive guide for <a href="https://shrinerb.com/docs/changing-derivatives" target="_blank" rel="noopener noreferrer">Managing Derivatives</a>, which provides
instructions on how to make these changes safely and with zero downtime.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">​</a></h3><p>File validation in Shrine is also instance-level, which allows using
conditionals:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">CarrierWave::Uploader::Base</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">extension_whitelist</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[jpg jpeg png webp]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">content_type_whitelist</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#E7EE98">/image</span><span style="color:#F286C4">\/</span><span style="color:#E7EE98">/</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">size_range</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#BF9EEE">0</span><span style="color:#F6F6F4">..(</span><span style="color:#BF9EEE">10</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_max_size </span><span style="color:#BF9EEE">10</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_extension </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[jpg jpeg png webp]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> validate_mime_type </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">jpeg image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">png image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">webp]</span></span>
<span class="line"><span style="color:#F6F6F4">      validate_max_dimensions [</span><span style="color:#BF9EEE">5000</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">5000</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="custom-metadata">Custom metadata<a href="#custom-metadata" class="hash-link" aria-label="Direct link to Custom metadata" title="Direct link to Custom metadata">​</a></h4><p>With Shrine you can also extract and validate any custom metadata:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">VideoUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:add_metadata</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  add_metadata </span><span style="color:#BF9EEE">:duration</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">FFMPEG</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Movie</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(io.path).duration</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> file.duration </span><span style="color:#F286C4">&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">5</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span></span>
<span class="line"><span style="color:#F6F6F4">      errors </span><span style="color:#F286C4">&lt;&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">must not be longer than 5 hours</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-uploads">Multiple uploads<a href="#multiple-uploads" class="hash-link" aria-label="Direct link to Multiple uploads" title="Direct link to Multiple uploads">​</a></h3><p>Shrine doesn&#x27;t have support for multiple uploads out-of-the-box like
CarrierWave does. Instead, you can implement them using a separate table with a
one-to-many relationship to which the files will be attached. The <a href="https://shrinerb.com/docs/multiple-files" target="_blank" rel="noopener noreferrer">Multiple
Files</a> guide explains this setup in more detail.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-carrierwave">Migrating from CarrierWave<a href="#migrating-from-carrierwave" class="hash-link" aria-label="Direct link to Migrating from CarrierWave" title="Direct link to Migrating from CarrierWave">​</a></h2><p>You have an existing app using CarrierWave and you want to transfer it to
Shrine. Let&#x27;s assume we have a <code>Photo</code> model with the &quot;image&quot; attachment.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-add-shrine-column">1. Add Shrine column<a href="#1-add-shrine-column" class="hash-link" aria-label="Direct link to 1. Add Shrine column" title="Direct link to 1. Add Shrine column">​</a></h3><p>First we need to create the <code>image_data</code> column for Shrine:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">add_column </span><span style="color:#BF9EEE">:photos</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:image_data</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:text</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># or :json or :jsonb if supported</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-dual-write">2. Dual write<a href="#2-dual-write" class="hash-link" aria-label="Direct link to 2. Dual write" title="Direct link to 2. Dual write">​</a></h3><p>Next, we need to make new CarrierWave attachments write to the
<code>image_data</code> column. This can be done by including the below module to all
models that have CarrierWave attachments:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/initializers/shrine.rb (Rails)</span></span>
<span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> ...,</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> ...,</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:model</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:derivatives</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">module</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">CarrierwaveShrineSynchronization</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">self.included</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">model</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    model.before_save </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">.class.uploaders.each_key </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |name|</span></span>
<span class="line"><span style="color:#F6F6F4">        write_shrine_data(name) </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> changes.key?(name)</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">write_shrine_data</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    uploader </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> send(name)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.from_model(</span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">, name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> read_attribute(name).present?</span></span>
<span class="line"><span style="color:#F6F6F4">      attacher.set shrine_file(uploader)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">      uploader.versions.each </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |version_name, version|</span></span>
<span class="line"><span style="color:#F6F6F4">        attacher.merge_derivatives(version_name </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> shrine_file(version))</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">else</span></span>
<span class="line"><span style="color:#F6F6F4">      attacher.set </span><span style="color:#BF9EEE">nil</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">private</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">shrine_file</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">uploader</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    name     </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.mounted_as</span></span>
<span class="line"><span style="color:#F6F6F4">    filename </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> read_attribute(name)</span></span>
<span class="line"><span style="color:#F6F6F4">    location </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploader.store_path(filename)</span></span>
<span class="line"><span style="color:#F6F6F4">    location </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> location.</span><span style="color:#97E1F1">sub</span><span style="color:#F6F6F4">(</span><span style="color:#EE6666">%r{</span><span style="color:#E7EE98">^</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">storage.prefix</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">/</span><span style="color:#EE6666">}</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;&quot;</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> storage.prefix</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.uploaded_file(</span></span>
<span class="line"><span style="color:#F6F6F4">      storage</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">      id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">       location,</span></span>
<span class="line"><span style="color:#F6F6F4">      metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">filename</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> filename },</span></span>
<span class="line"><span style="color:#F6F6F4">    )</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">storage</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages[</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">Photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ActiveRecord::Base</span></span>
<span class="line"><span style="color:#F6F6F4">  mount_uploader </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">ImageUploader</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">CarrierwaveShrineSynchronization</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># needs to be after `mount_uploader`</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>After you deploy this code, the <code>image_data</code> column should now be successfully
synchronized with new attachments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-data-migration">3. Data migration<a href="#3-data-migration" class="hash-link" aria-label="Direct link to 3. Data migration" title="Direct link to 3. Data migration">​</a></h3><p>Next step is to run a script which writes all existing CarrierWave attachments
to <code>image_data</code>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.find_each </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |photo|</span></span>
<span class="line"><span style="color:#F6F6F4">  photo.write_shrine_data(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  photo.save!</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-rewrite-code">4. Rewrite code<a href="#4-rewrite-code" class="hash-link" aria-label="Direct link to 4. Rewrite code" title="Direct link to 4. Rewrite code">​</a></h3><p>Now you should be able to rewrite your application so that it uses Shrine
instead of CarrierWave (you can consult the reference in the next section). You
can remove the <code>CarrierwaveShrineSynchronization</code> module as well.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-backfill-metadata">5. Backfill metadata<a href="#5-backfill-metadata" class="hash-link" aria-label="Direct link to 5. Backfill metadata" title="Direct link to 5. Backfill metadata">​</a></h3><p>You&#x27;ll notice that Shrine metadata will be absent from the migrated files&#x27;
data. You can run a script that will fill in any missing metadata defined in
your Shrine uploader:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:refresh_metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.find_each </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |photo|</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> photo.image_attacher</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.refresh_metadata!</span></span>
<span class="line"><span style="color:#F6F6F4">  attacher.atomic_persist</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-remove-carrierwave-column">6. Remove CarrierWave column<a href="#6-remove-carrierwave-column" class="hash-link" aria-label="Direct link to 6. Remove CarrierWave column" title="Direct link to 6. Remove CarrierWave column">​</a></h3><p>If everything is looking good, we can remove the CarrierWave column:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">remove_column </span><span style="color:#BF9EEE">:photos</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:image</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="carrierwave-to-shrine-direct-mapping">CarrierWave to Shrine direct mapping<a href="#carrierwave-to-shrine-direct-mapping" class="hash-link" aria-label="Direct link to CarrierWave to Shrine direct mapping" title="Direct link to CarrierWave to Shrine direct mapping">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="carrierwaveuploaderbase"><code>CarrierWave::Uploader::Base</code><a href="#carrierwaveuploaderbase" class="hash-link" aria-label="Direct link to carrierwaveuploaderbase" title="Direct link to carrierwaveuploaderbase">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-1"><code>.storage</code><a href="#storage-1" class="hash-link" aria-label="Direct link to storage-1" title="Direct link to storage-1">​</a></h4><p>When using models, by default all storages use <code>:cache</code> for cache, and <code>:store</code>
for store. If you want to change that, you can use the <code>default_storage</code>
plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages[</span><span style="color:#BF9EEE">:foo</span><span style="color:#F6F6F4">] </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Foo</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#F286C4">*</span><span style="color:#F6F6F4">args)</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:default_storage</span><span style="color:#F6F6F4">, store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:foo</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="process-version"><code>.process</code>, <code>.version</code><a href="#process-version" class="hash-link" aria-label="Direct link to process-version" title="Direct link to process-version">​</a></h4><p>Processing is defined by using the <code>derivatives</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:derivatives</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.derivatives </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    magick </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(image)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    {</span></span>
<span class="line"><span style="color:#F6F6F4">      large</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      medium</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> magick.resize_to_limit!(</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      small</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="before-after"><code>.before</code>, <code>.after</code><a href="#before-after" class="hash-link" aria-label="Direct link to before-after" title="Direct link to before-after">​</a></h4><p>There is no Shrine equivalent for CarrierWave&#x27;s callbacks.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="store-cache"><code>#store!</code>, <code>#cache!</code><a href="#store-cache" class="hash-link" aria-label="Direct link to store-cache" title="Direct link to store-cache">​</a></h4><p>In Shrine you store and cache files by passing the corresponding storage to
<code>Shrine.upload</code>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.upload(file, </span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.upload(file, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span></code></pre></div><p>Note that in Shrine you cannot pass in a path to the file, you always have to
pass an IO-like object, which is required to respond to: <code>#read(*args)</code>,
<code>#size</code>, <code>#eof?</code>, <code>#rewind</code> and <code>#close</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="retrieve_from_store-and-retrieve_from_cache"><code>#retrieve_from_store!</code> and <code>#retrieve_from_cache!</code><a href="#retrieve_from_store-and-retrieve_from_cache" class="hash-link" aria-label="Direct link to retrieve_from_store-and-retrieve_from_cache" title="Direct link to retrieve_from_store-and-retrieve_from_cache">​</a></h4><p>In Shrine you simply call <code>#download</code> on the uploaded file:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.upload(file, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.download </span><span style="color:#7B7F8B">#=&gt; #&lt;Tempfile:/path/to/file&gt;</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="url"><code>#url</code><a href="#url" class="hash-link" aria-label="Direct link to url" title="Direct link to url">​</a></h4><p>In Shrine you call <code>#url</code> on uploaded files:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image     </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.url </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/398454ujedfggf.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_url </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/398454ujedfggf.jpg&quot; (shorthand)</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="identifier"><code>#identifier</code><a href="#identifier" class="hash-link" aria-label="Direct link to identifier" title="Direct link to identifier">​</a></h4><p>This method corresponds to <code>#original_filename</code> on the uploaded file:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image                   </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.original_filename </span><span style="color:#7B7F8B">#=&gt; &quot;avatar.jpg&quot;</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="store_dir-cache_dir"><code>#store_dir</code>, <code>#cache_dir</code><a href="#store_dir-cache_dir" class="hash-link" aria-label="Direct link to store_dir-cache_dir" title="Direct link to store_dir-cache_dir">​</a></h4><p>Shrine here provides a single <code>#generate_location</code> method that&#x27;s triggered for
all storages:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">generate_location</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">io</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">record</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    [ storage_key,</span></span>
<span class="line"><span style="color:#F6F6F4">      record </span><span style="color:#F286C4">&amp;&amp;</span><span style="color:#F6F6F4"> record.class.name.underscore,</span></span>
<span class="line"><span style="color:#F6F6F4">      record </span><span style="color:#F286C4">&amp;&amp;</span><span style="color:#F6F6F4"> record.id,</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#F286C4">super</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">      io.original_filename ].compact.join(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cache/user/123/2feff8c724e7ce17/nature.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">store/user/456/7f99669fde1e01fc/kitten.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You might also want to use the <code>pretty_location</code> plugin for automatically
generating an organized folder structure.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="default_url"><code>#default_url</code><a href="#default_url" class="hash-link" aria-label="Direct link to default_url" title="Direct link to default_url">​</a></h4><p>For default URLs you can use the <code>default_url</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:default_url</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.default_url </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |derivative</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/fallbacks/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">derivative </span><span style="color:#F286C4">||</span><span style="color:#E7EE98"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">original</span><span style="color:#DEE492">&quot;</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">.jpg</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="extension_white_list-extension_black_list"><code>#extension_white_list</code>, <code>#extension_black_list</code><a href="#extension_white_list-extension_black_list" class="hash-link" aria-label="Direct link to extension_white_list-extension_black_list" title="Direct link to extension_white_list-extension_black_list">​</a></h4><p>In Shrine, extension whitelisting/blacklisting is a part of validations, and is
provided by the <code>validation_helpers</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_extension_inclusion </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[jpg jpeg png] </span><span style="color:#7B7F8B"># whitelist</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_extension_exclusion </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[php]          </span><span style="color:#7B7F8B"># blacklist</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="content_type_whitelist-content_type_blacklist"><code>#content_type_whitelist</code>, <code>#content_type_blacklist</code><a href="#content_type_whitelist-content_type_blacklist" class="hash-link" aria-label="Direct link to content_type_whitelist-content_type_blacklist" title="Direct link to content_type_whitelist-content_type_blacklist">​</a></h4><p>In Shrine, MIME type whitelisting/blacklisting is part of validations, and is
provided by the <code>validation_helpers</code> plugin, though it doesn&#x27;t support regexes:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_mime_type_inclusion </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">jpeg image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">png] </span><span style="color:#7B7F8B"># whitelist</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_mime_type_exclusion </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[text</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">x</span><span style="color:#F286C4">-</span><span style="color:#F6F6F4">php]           </span><span style="color:#7B7F8B"># blacklist</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>Make sure to also load the <code>determine_mime_type</code> plugin to detect MIME type
from file content.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">mimemagic</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:determine_mime_type</span><span style="color:#F6F6F4">, analyzer</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:mimemagic</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="size_range"><code>#size_range</code><a href="#size_range" class="hash-link" aria-label="Direct link to size_range" title="Direct link to size_range">​</a></h4><p>In Shrine file size validations are typically done using the
<code>validation_helpers</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_size </span><span style="color:#BF9EEE">0</span><span style="color:#F6F6F4">..</span><span style="color:#BF9EEE">5</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># 5 MB</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="recreate_versions"><code>#recreate_versions!</code><a href="#recreate_versions" class="hash-link" aria-label="Direct link to recreate_versions" title="Direct link to recreate_versions">​</a></h4><p>Shrine doesn&#x27;t have a built-in way of regenerating versions, because that&#x27;s
very individual and depends on what versions you want regenerated, what ORM are
you using, how many records there are in your database etc. The <a href="https://shrinerb.com/docs/changing-derivatives" target="_blank" rel="noopener noreferrer">Managing
Derivatives</a> guide provides some useful tips on this task.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="models">Models<a href="#models" class="hash-link" aria-label="Direct link to Models" title="Direct link to Models">​</a></h3><p>The only thing that Shrine requires from your models is a <code>&lt;attachment&gt;_data</code>
column (e.g. if your attachment is &quot;image&quot;, you need the <code>image_data</code> column).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mount_uploader"><code>.mount_uploader</code><a href="#mount_uploader" class="hash-link" aria-label="Direct link to mount_uploader" title="Direct link to mount_uploader">​</a></h4><p>In Shrine you make include attachment modules directly:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:sequel</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">User</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sequel::Model</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Attachment</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:avatar</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="attachment"><code>#&lt;attachment&gt;=</code><a href="#attachment" class="hash-link" aria-label="Direct link to attachment" title="Direct link to attachment">​</a></h4><p>The attachment module adds an attachment setter:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">avatar.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span></code></pre></div><p>Note that unlike CarrierWave, you cannot pass in file paths, the input needs to
be an IO-like object.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="attachment-1"><code>#&lt;attachment&gt;</code><a href="#attachment-1" class="hash-link" aria-label="Direct link to attachment-1" title="Direct link to attachment-1">​</a></h4><p>CarrierWave returns the uploader, but Shrine returns a <code>Shrine::UploadedFile</code>,
a representation of the file uploaded to the storage:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.methods </span><span style="color:#7B7F8B">#=&gt; [:url, :download, :read, :exists?, :delete, ...]</span></span></code></pre></div><p>If attachment is missing, nil is returned.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="attachment_url"><code>#&lt;attachment&gt;_url</code><a href="#attachment_url" class="hash-link" aria-label="Direct link to attachment_url" title="Direct link to attachment_url">​</a></h4><p>This method is simply a shorthand for &quot;if attachment is present, call <code>#url</code>
on it, otherwise return nil&quot;:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image_url </span><span style="color:#7B7F8B">#=&gt; nil</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">avatar.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_url </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/ksdf934rt.jpg&quot;</span></span></code></pre></div><p>The <code>derivatives</code> plugin extends this method to also accept a version name as
the argument (<code>photo.image_url(:thumb)</code>).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="attachment_cache"><code>#&lt;attachment&gt;_cache</code><a href="#attachment_cache" class="hash-link" aria-label="Direct link to attachment_cache" title="Direct link to attachment_cache">​</a></h4><p>Shrine has the <code>cached_attachment_data</code> plugin, which gives model a reader method
that you can use for retaining the cached file:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:cached_attachment_data</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">form_for </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |f|</span></span>
<span class="line"><span style="color:#F6F6F4">  f.hidden_field </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, value</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">.cached_image_data, id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span></span>
<span class="line"><span style="color:#F6F6F4">  f.file_field </span><span style="color:#BF9EEE">:image</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remote_attachment_url"><code>#remote_&lt;attachment&gt;_url</code><a href="#remote_attachment_url" class="hash-link" aria-label="Direct link to remote_attachment_url" title="Direct link to remote_attachment_url">​</a></h4><p>In Shrine this method is provided by the <code>remote_url</code> plugin.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remove_attachment"><code>#remove_&lt;attachment&gt;</code><a href="#remove_attachment" class="hash-link" aria-label="Direct link to remove_attachment" title="Direct link to remove_attachment">​</a></h4><p>In Shrine this method is provided by the <code>remove_attachment</code> plugin.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3><p>This section walks through various configuration options in CarrierWave, and
shows what are Shrine&#x27;s equivalents.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="root-base_path-permissions-directory_permissions"><code>root</code>, <code>base_path</code>, <code>permissions</code>, <code>directory_permissions</code><a href="#root-base_path-permissions-directory_permissions" class="hash-link" aria-label="Direct link to root-base_path-permissions-directory_permissions" title="Direct link to root-base_path-permissions-directory_permissions">​</a></h4><p>In Shrine these are configured on the <code>FileSystem</code> storage directly.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-storage_engines"><code>storage</code>, <code>storage_engines</code><a href="#storage-storage_engines" class="hash-link" aria-label="Direct link to storage-storage_engines" title="Direct link to storage-storage_engines">​</a></h4><p>As mentioned before, in Shrine you register storages through <code>Shrine.storages</code>,
and the attachment storages will automatically be <code>:cache</code> and <code>:store</code>, but
you can change this with the <code>default_storage</code> plugin.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="delete_tmp_file_after_storage-remove_previously_stored_file_after_update"><code>delete_tmp_file_after_storage</code>, <code>remove_previously_stored_file_after_update</code><a href="#delete_tmp_file_after_storage-remove_previously_stored_file_after_update" class="hash-link" aria-label="Direct link to delete_tmp_file_after_storage-remove_previously_stored_file_after_update" title="Direct link to delete_tmp_file_after_storage-remove_previously_stored_file_after_update">​</a></h4><p>By default Shrine deletes cached and replaced files, but you can choose to keep
those files by loading the <code>keep_files</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:keep_files</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="move_to_cache-move_to_store"><code>move_to_cache</code>, <code>move_to_store</code><a href="#move_to_cache-move_to_store" class="hash-link" aria-label="Direct link to move_to_cache-move_to_store" title="Direct link to move_to_cache-move_to_store">​</a></h4><p>You can tell the <code>FileSystem</code> storage that it should move files by specifying
the <code>:move</code> upload option:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:upload_options</span><span style="color:#F6F6F4">, cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { move</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4"> }, store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { move</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4"> }</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate_integrity-ignore_integrity_errors"><code>validate_integrity</code>, <code>ignore_integrity_errors</code><a href="#validate_integrity-ignore_integrity_errors" class="hash-link" aria-label="Direct link to validate_integrity-ignore_integrity_errors" title="Direct link to validate_integrity-ignore_integrity_errors">​</a></h4><p>Shrine does this with validation, which are best done with the
<code>validation_helpers</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># Evaluated inside an instance of Shrine::Attacher.</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> record.guest?</span></span>
<span class="line"><span style="color:#F6F6F4">      validate_max_size </span><span style="color:#BF9EEE">2</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F6F6F4">, message</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">must not be larger than 2 MB</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">      validate_mime_type </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">jpg image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">png image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">webp]</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate_download-ignore_download_errors"><code>validate_download</code>, <code>ignore_download_errors</code><a href="#validate_download-ignore_download_errors" class="hash-link" aria-label="Direct link to validate_download-ignore_download_errors" title="Direct link to validate_download-ignore_download_errors">​</a></h4><p>Shrine&#x27;s <code>remote_url</code> plugin always rescues download errors and transforms
them to validation errors.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate_processing-ignore_processing_errors"><code>validate_processing</code>, <code>ignore_processing_errors</code><a href="#validate_processing-ignore_processing_errors" class="hash-link" aria-label="Direct link to validate_processing-ignore_processing_errors" title="Direct link to validate_processing-ignore_processing_errors">​</a></h4><p>In Shrine processing is performed <em>after</em> validations, and typically
asynchronously in a background job, so it is expected that you validate files
before processing.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable_processing"><code>enable_processing</code><a href="#enable_processing" class="hash-link" aria-label="Direct link to enable_processing" title="Direct link to enable_processing">​</a></h4><p>You can just add conditionals in processing code.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ensure_multipart_form"><code>ensure_multipart_form</code><a href="#ensure_multipart_form" class="hash-link" aria-label="Direct link to ensure_multipart_form" title="Direct link to ensure_multipart_form">​</a></h4><p>No equivalent, it depends on your application whether you need the form to be
multipart or not.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="carrierwavestoragefog"><code>CarrierWave::Storage::Fog</code><a href="#carrierwavestoragefog" class="hash-link" aria-label="Direct link to carrierwavestoragefog" title="Direct link to carrierwavestoragefog">​</a></h3><p>You can use <a href="https://shrinerb.com/docs/storage/s3" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::S3</code></a> (built-in),
<a href="https://github.com/renchap/shrine-google_cloud_storage" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::GoogleCloudStorage</code></a>, or generic
<a href="https://github.com/shrinerb/shrine-fog" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::Fog</code></a> storage. The reference will assume you&#x27;re
using S3 storage.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fog_credentials-fog_directory"><code>:fog_credentials</code>, <code>:fog_directory</code><a href="#fog_credentials-fog_directory" class="hash-link" aria-label="Direct link to fog_credentials-fog_directory" title="Direct link to fog_credentials-fog_directory">​</a></h4><p>The S3 Shrine storage accepts <code>:access_key_id</code>, <code>:secret_access_key</code>, <code>:region</code>,
and <code>:bucket</code> options in the initializer:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span></span>
<span class="line"><span style="color:#F6F6F4">  access_key_id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">     </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">...</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  secret_access_key</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">...</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  region</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">...</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  bucket</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">...</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">)</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fog_attributes"><code>:fog_attributes</code><a href="#fog_attributes" class="hash-link" aria-label="Direct link to fog_attributes" title="Direct link to fog_attributes">​</a></h4><p>The object data can be configured via the <code>:upload_options</code> hash:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(upload_options</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { content_disposition</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">attachment</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> }, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options)</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fog_public"><code>:fog_public</code><a href="#fog_public" class="hash-link" aria-label="Direct link to fog_public" title="Direct link to fog_public">​</a></h4><p>The object permissions can be configured with the <code>:acl</code> upload option:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(upload_options</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { acl</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">private</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> }, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options)</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fog_authenticated_url_expiration"><code>:fog_authenticated_url_expiration</code><a href="#fog_authenticated_url_expiration" class="hash-link" aria-label="Direct link to fog_authenticated_url_expiration" title="Direct link to fog_authenticated_url_expiration">​</a></h4><p>The <code>#url</code> method accepts the <code>:expires_in</code> option, you can set the default
expiration with the <code>url_options</code> plugin:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">plugin </span><span style="color:#BF9EEE">:url_options</span><span style="color:#F6F6F4">, store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { expires_in</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">600</span><span style="color:#F6F6F4"> }</span></span></code></pre></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fog_use_ssl_for_aws-fog_aws_accelerate"><code>:fog_use_ssl_for_aws</code>, <code>:fog_aws_accelerate</code><a href="#fog_use_ssl_for_aws-fog_aws_accelerate" class="hash-link" aria-label="Direct link to fog_use_ssl_for_aws-fog_aws_accelerate" title="Direct link to fog_use_ssl_for_aws-fog_aws_accelerate">​</a></h4><p>Shrine allows you to override the S3 endpoint:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(use_accelerate_endpoint</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options)</span></span></code></pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shrinerb/shrine/edit/master/doc/../doc/carrierwave.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-02-19T16:57:27.000Z">Feb 19, 2022</time></b> by <b>Janko Marohnić</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/upgrading-to-3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Upgrading to Shrine 3.x</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/paperclip"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading from Paperclip</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#uploader" class="table-of-contents__link toc-highlight">Uploader</a></li><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#persistence" class="table-of-contents__link toc-highlight">Persistence</a></li><li><a href="#processing" class="table-of-contents__link toc-highlight">Processing</a></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#multiple-uploads" class="table-of-contents__link toc-highlight">Multiple uploads</a></li></ul></li><li><a href="#migrating-from-carrierwave" class="table-of-contents__link toc-highlight">Migrating from CarrierWave</a><ul><li><a href="#1-add-shrine-column" class="table-of-contents__link toc-highlight">1. Add Shrine column</a></li><li><a href="#2-dual-write" class="table-of-contents__link toc-highlight">2. Dual write</a></li><li><a href="#3-data-migration" class="table-of-contents__link toc-highlight">3. Data migration</a></li><li><a href="#4-rewrite-code" class="table-of-contents__link toc-highlight">4. Rewrite code</a></li><li><a href="#5-backfill-metadata" class="table-of-contents__link toc-highlight">5. Backfill metadata</a></li><li><a href="#6-remove-carrierwave-column" class="table-of-contents__link toc-highlight">6. Remove CarrierWave column</a></li></ul></li><li><a href="#carrierwave-to-shrine-direct-mapping" class="table-of-contents__link toc-highlight">CarrierWave to Shrine direct mapping</a><ul><li><a href="#carrierwaveuploaderbase" class="table-of-contents__link toc-highlight"><code>CarrierWave::Uploader::Base</code></a></li><li><a href="#models" class="table-of-contents__link toc-highlight">Models</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#carrierwavestoragefog" class="table-of-contents__link toc-highlight"><code>CarrierWave::Storage::Fog</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Janko Marohnić</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b0f70eb.js"></script>
<script src="/assets/js/main.ea4eabff.js"></script>
</body>
</html>