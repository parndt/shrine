<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advantages">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Advantages of Shrine | Shrine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://shrinerb.com/docs/advantages"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advantages of Shrine | Shrine"><meta data-rh="true" name="description" content="There are many existing file upload solutions for Ruby out there. This guide"><meta data-rh="true" property="og:description" content="There are many existing file upload solutions for Ruby out there. This guide"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shrinerb.com/docs/advantages"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/advantages" hreflang="en"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/advantages" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBFWBJ5DPX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Shrine" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.efb93a3c.css">
<link rel="preload" href="/assets/js/runtime~main.3b0f70eb.js" as="script">
<link rel="preload" href="/assets/js/main.3b0d02ea.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shrine</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Guides</a><a class="navbar__item navbar__link" href="/docs/plugins/activerecord">Plugins</a><a class="navbar__item navbar__link" href="/docs/external/extensions">External</a><a class="navbar__item navbar__link" href="/docs/release_notes/3.5.0">Release Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shrinerb/shrine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/advantages">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advantages">Advantages of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/design">Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design">The Design of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/attacher">Using Attacher</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/storage/file-system">Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/file-system">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/s3">AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/memory">Memory</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/direct-s3">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata">Extracting Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/processing">File Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">File Validation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/multiple-files">Extras</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/multiple-files">Multiple Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/securing-uploads">Securing Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing">Testing with Shrine</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/changing-derivatives">Migrating</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-location">Migrating File Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-storage">Migrating File Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/creating-plugins">Extending</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-storages">Writing a Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/upgrading-to-3">Upgrading</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/carrierwave">Upgrading from CarrierWave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/paperclip">Upgrading from Paperclip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/refile">Upgrading from Refile</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Advantages of Shrine</h1></header><p>There are many existing file upload solutions for Ruby out there. This guide
will attempt to cover some of the main advantages that Shrine offers compared
to these alternatives.</p><p>For a more direct comparison with specific file attachment libraries, there are
more specialized guides for <a href="https://shrinerb.com/docs/carrierwave" target="_blank" rel="noopener noreferrer">CarrierWave</a>, <a href="https://shrinerb.com/docs/paperclip" target="_blank" rel="noopener noreferrer">Paperclip</a>, and <a href="https://shrinerb.com/docs/refile" target="_blank" rel="noopener noreferrer">Refile</a> users.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generality">Generality<a href="#generality" class="hash-link" aria-label="Direct link to Generality" title="Direct link to Generality">​</a></h2><p>Many alternative file upload solutions are coupled to either Rails (Active
Storage) or Active Record itself (Paperclip, Dragonfly). This is not ideal, as
Rails-specific solutions fragment the Ruby community between developers that
use Rails and developers that don&#x27;t. There are many great web frameworks
(<a href="http://sinatrarb.com" target="_blank" rel="noopener noreferrer">Sinatra</a>, <a href="http://roda.jeremyevans.net" target="_blank" rel="noopener noreferrer">Roda</a>, <a href="http://cuba.is" target="_blank" rel="noopener noreferrer">Cuba</a>, <a href="http://hanamirb.org" target="_blank" rel="noopener noreferrer">Hanami</a>, <a href="https://github.com/ruby-grape/grape" target="_blank" rel="noopener noreferrer">Grape</a>) and persistence libraries
(<a href="http://sequel.jeremyevans.net" target="_blank" rel="noopener noreferrer">Sequel</a>, <a href="http://rom-rb.org" target="_blank" rel="noopener noreferrer">ROM</a>, <a href="https://github.com/hanami/model" target="_blank" rel="noopener noreferrer">Hanami::Model</a>) out there that people use instead of Rails
and Active Record.</p><p>Shrine, on the other hand, doesn&#x27;t make any assumptions about which web
framework or persistence library you&#x27;re using. Any web-specific functionality
is implemented on top of <a href="https://rack.github.io" target="_blank" rel="noopener noreferrer">Rack</a>, the Ruby web server interface that powers all
the popular Ruby web frameworks (including Rails). The integrations for
specific ORMs are provided as plugins.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Rack-based plugins</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:upload_endpoint</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:presign_endpoint</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:download_endpoint</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:derivation_endpoint</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:rack_response</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:rack_file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># ORM plugins</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:activerecord</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:sequel</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:mongoid</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># https://github.com/shrinerb/shrine-mongoid</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:rom</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># https://github.com/shrinerb/shrine-rom</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:hanami</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># https://github.com/katafrakt/hanami-shrine</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="simplicity">Simplicity<a href="#simplicity" class="hash-link" aria-label="Direct link to Simplicity" title="Direct link to Simplicity">​</a></h2><p>Where some popular file attachment libraries have <a href="https://en.wikipedia.org/wiki/God_object" target="_blank" rel="noopener noreferrer">god objects</a>
(<code>CarrierWave::Uploader::Base</code> and <code>Paperclip::Attachment</code>), Shrine distributes
responsibilities across multiple core classes:</p><table><thead><tr><th align="left">Class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>Shrine::Storage::*</code></td><td align="left">Encapsulate file operations for the underlying service</td></tr><tr><td align="left"><code>Shrine</code></td><td align="left">Wraps uploads and handles loading plugins</td></tr><tr><td align="left"><code>Shrine::UploadedFile</code></td><td align="left">Represents a file that was uploaded to a storage</td></tr><tr><td align="left"><code>Shrine::Attacher</code></td><td align="left">Handles attaching files to records</td></tr><tr><td align="left"><code>Shrine::Attachment</code></td><td align="left">Adds convenience attachment methods to model instances</td></tr></tbody></table><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image           </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.storage   </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::Storage::S3&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.uploader  </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_attacher  </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::Attacher&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.class.ancestors </span><span style="color:#7B7F8B">#=&gt; [..., #&lt;Shrine::Attachment(:image)&gt;, ...]</span></span></code></pre></div><p>The attachment functionality is decoupled from persistence and storage, which
makes it much easier to reason about. Also, special care was taken to make
integrating new storages and persistence libraries as easy as possible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modularity">Modularity<a href="#modularity" class="hash-link" aria-label="Direct link to Modularity" title="Direct link to Modularity">​</a></h2><p>Shrine uses a <a href="https://twin.github.io/the-plugin-system-of-sequel-and-roda/" target="_blank" rel="noopener noreferrer">plugin system</a> that allows you to pick and choose the features
that you want. Moreover, you&#x27;ll only be loading code for the features you&#x27;ve
selected, which means that Shrine will generally load much faster than the
alternatives.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:instrumentation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># which translates to</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine/plugins/instrumentation</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Plugins</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Instrumentation</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.method(</span><span style="color:#BF9EEE">:instrument</span><span style="color:#F6F6F4">).owner </span><span style="color:#7B7F8B">#=&gt; Shrine::Plugins::Instrumentation::ClassMethods</span></span></code></pre></div><p>Shrine recommends a certain type of attachment flow, but it still offers good
low-level abstractions that give you the flexibility to build your own flow.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.upload(image, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># metadata extraction, upload location generation</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.id       </span><span style="color:#7B7F8B">#=&gt; &quot;44ccafc10ce6a4ff22829e8f579ee6b9.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B">#=&gt; { ... extracted metadata ... }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">data </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> uploaded_file.to_json </span><span style="color:#7B7F8B"># serialization</span></span>
<span class="line"><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.uploaded_file(data) </span><span style="color:#7B7F8B"># deserialization</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.url </span><span style="color:#7B7F8B">#=&gt; &quot;https://...&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.download { |tempfile| ... } </span><span style="color:#7B7F8B"># streaming download</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.delete</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a href="#dependencies" class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies">​</a></h3><p>Shrine is very diligent when it comes to dependencies. It has two mandatory
dependencies – <a href="https://github.com/janko/down" target="_blank" rel="noopener noreferrer">Down</a> and <a href="https://github.com/shrinerb/content_disposition" target="_blank" rel="noopener noreferrer">ContentDisposition</a> – which are loaded only by
components that need them. Some Shrine plugins also require additional
dependencies, but you only need to load them if you&#x27;re using those plugins.</p><p>Moreover, Shrine often gives you the ability choose between multiple
alternative dependencies for doing the same task. For example, the
<code>determine_mime_type</code> plugin allows you to choose between the <a href="http://linux.die.net/man/1/file" target="_blank" rel="noopener noreferrer"><code>file</code></a> command,
<a href="https://github.com/blackwinter/ruby-filemagic" target="_blank" rel="noopener noreferrer">FileMagic</a>, <a href="https://github.com/sdsykes/fastimage" target="_blank" rel="noopener noreferrer">FastImage</a>, <a href="https://github.com/minad/mimemagic" target="_blank" rel="noopener noreferrer">MimeMagic</a>, or <a href="https://github.com/basecamp/marcel" target="_blank" rel="noopener noreferrer">Marcel</a> gem for determining the MIME
type, while the <code>store_dimensions</code> plugin can extract dimensions using
<a href="https://github.com/sdsykes/fastimage" target="_blank" rel="noopener noreferrer">FastImage</a>, <a href="https://github.com/minimagick/minimagick" target="_blank" rel="noopener noreferrer">MiniMagick</a>, or <a href="https://github.com/libvips/ruby-vips" target="_blank" rel="noopener noreferrer">ruby-vips</a> gem.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:determine_mime_type</span><span style="color:#F6F6F4">, analyzer</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:marcel</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:store_dimensions</span><span style="color:#F6F6F4">,    analyzer</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:mini_magick</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inheritance">Inheritance<a href="#inheritance" class="hash-link" aria-label="Direct link to Inheritance" title="Direct link to Inheritance">​</a></h2><p>Shrine is designed to handle any types of files. If you&#x27;re accepting uploads of
multiple types of files, such as videos and images, chances are that the logic
for handling them will differ:</p><ul><li>small images can be processed on-the-fly, but large files should be processed in a background job</li><li>you might want to store different files to different storage services (images, documents, audios, videos)</li><li>extracting metadata might require different tools depending on the filetype</li></ul><p>With Shrine you can create isolated uploaders for each type of file. For
features you want all uploaders to share, their plugins can be loaded globally,
while other plugins you can load only for selected uploaders.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># loaded for all plugins</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:activerecord</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:instrumentation</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># loaded only for ImageUploader</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:store_dimensions</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">VideoUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># loaded only for VideoUploader</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:default_storage</span><span style="color:#F6F6F4">, store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:vimeo</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing">Processing<a href="#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h2><p>Most file attachment libraries allow you to process files either &quot;eagerly&quot;
(Paperclip, CarrierWave) or &quot;on-the-fly&quot; (Dragonfly, Refile, Active Storage).
However, each approach is suitable for different requirements. For instance,
while on-the-fly processing is suitable for fast processing (image thumbnails,
document previews), longer running processing (video transcoding, raw images)
should be moved into a background job.</p><p>That&#x27;s why Shrine supports both <a href="https://shrinerb.com/docs/plugins/derivatives" target="_blank" rel="noopener noreferrer">eager</a> and
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint" target="_blank" rel="noopener noreferrer">on-the-fly</a> processing. For example, if you&#x27;re handling
image uploads, you can choose to either generate a set of pre-defined
thumbnails during attachment:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.derivatives </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    magick </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(original)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    {</span></span>
<span class="line"><span style="color:#F6F6F4">      large</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      medium</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> magick.resize_to_limit!(</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      small</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image_derivatives! </span><span style="color:#7B7F8B"># creates thumbnails</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_url(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">)  </span><span style="color:#7B7F8B">#=&gt; &quot;https://s3.amazonaws.com/path/to/large.jpg&quot;</span></span></code></pre></div><p>or generate thumbnails on-demand:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  derivation </span><span style="color:#BF9EEE">:thumbnail</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |file, width, height|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">MiniMagick</span></span>
<span class="line"><span style="color:#F6F6F4">      .source(file)</span></span>
<span class="line"><span style="color:#F6F6F4">      .resize_to_limit!(width.to_i, height.to_i)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image.derivation_url(</span><span style="color:#BF9EEE">:thumbnail</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">600</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#7B7F8B">#=&gt; &quot;.../thumbnail/600/400/eyJpZCI6ImZvbyIsInN0b3JhZ2UiOiJzdG9yZSJ9?signature=...&quot;</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagemagick">ImageMagick<a href="#imagemagick" class="hash-link" aria-label="Direct link to ImageMagick" title="Direct link to ImageMagick">​</a></h3><p>Many file attachment libraries, such as CarrierWave, Paperclip, Dragonfly and
Refile, implement their own image processing macros. Rather than building yet
another in-house implementation, a general purpose <strong><a href="https://github.com/janko/image_processing" target="_blank" rel="noopener noreferrer">ImageProcessing</a></strong> gem
was created instead, which works great with Shrine.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/mini_magick</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">thumbnail </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">MiniMagick</span></span>
<span class="line"><span style="color:#F6F6F4">  .source(image)</span></span>
<span class="line"><span style="color:#F6F6F4">  .resize_to_limit(</span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  .call </span><span style="color:#7B7F8B"># convert input.jpg -auto-orient -resize 400x400&gt; -sharpen 0x1 output.jpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">thumbnail </span><span style="color:#7B7F8B">#=&gt; #&lt;Tempfile:/var/folders/.../image_processing20180316-18446-1j247h6.jpg&gt;</span></span></code></pre></div><p>It takes care of many details for you, such as <a href="https://www.imagemagick.org/script/command-line-options.php#auto-orient" target="_blank" rel="noopener noreferrer">auto orienting</a> the input image
and applying <a href="https://photography.tutsplus.com/tutorials/what-is-image-sharpening--cms-26627" target="_blank" rel="noopener noreferrer">sharpening</a> to resized images. It also has support for
<a href="#libvips">libvips</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="libvips">libvips<a href="#libvips" class="hash-link" aria-label="Direct link to libvips" title="Direct link to libvips">​</a></h3><p><strong><a href="http://libvips.github.io/libvips/" target="_blank" rel="noopener noreferrer">libvips</a></strong> is a full-featured image processing library like ImageMagick,
with <a href="https://github.com/libvips/libvips/wiki/Speed-and-memory-use#results" target="_blank" rel="noopener noreferrer">great performance characteristics</a>. It&#x27;s often
<strong>multiple times faster</strong> than ImageMagick, and also has lower memory usage.
For more details, see <a href="https://github.com/libvips/libvips/wiki/Why-is-libvips-quick" target="_blank" rel="noopener noreferrer">Why is libvips quick</a>.</p><p>The ImageProcessing gem provides libvips support as an alternative
<code>ImageProcessing::Vips</code> backend, sharing the same API as the
<code>ImageProcessing::MiniMagick</code> backend.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/vips</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># this now generates the thumbnail using libvips</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Vips</span></span>
<span class="line"><span style="color:#F6F6F4">  .source(image)</span></span>
<span class="line"><span style="color:#F6F6F4">  .resize_to_limit!(</span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">)</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-processors">Other processors<a href="#other-processors" class="hash-link" aria-label="Direct link to Other processors" title="Direct link to Other processors">​</a></h3><p>In contrast to most file attachment libraries, file processing in Shrine is
just a functional transformation, where you receive the source file on the
input and return processed files on the output. This makes it easier to use
custom processing tools and encourages building generic processors that can be
reused outside of Shrine.</p><p>Here is an example of transcoding videos using the <a href="https://github.com/streamio/streamio-ffmpeg" target="_blank" rel="noopener noreferrer">streamio-ffmpeg</a> gem:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">streamio-ffmpeg</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">VideoUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.derivatives </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    transcoded </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Tempfile</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4"> [</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">transcoded</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">.mp4</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">    screenshot </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Tempfile</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4"> [</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">screenshot</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    movie </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">FFMPEG</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Movie</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(original.path)</span></span>
<span class="line"><span style="color:#F6F6F4">    movie.transcode(transcoded.path)</span></span>
<span class="line"><span style="color:#F6F6F4">    movie.screenshot(screenshot.path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    { transcoded</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> transcoded, screenshot</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> screenshot }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">movie.video_derivatives! </span><span style="color:#7B7F8B"># create derivatives</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">movie.video              </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;5a5cd0.mov&quot; ...&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">movie.video(</span><span style="color:#BF9EEE">:transcoded</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;7481d6.mp4&quot; ...&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">movie.video(</span><span style="color:#BF9EEE">:screenshot</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;8f3136.jpg&quot; ...&gt;</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a href="#metadata" class="hash-link" aria-label="Direct link to Metadata" title="Direct link to Metadata">​</a></h2><p>Shrine automatically <a href="https://shrinerb.com/docs/metadata" target="_blank" rel="noopener noreferrer">extracts metadata</a> from each uploaded file,
including derivatives like image thumbnails, and saves them into the database
column. In addition to filename, filesize, and MIME type that are extracted by
default, you can also extract <a href="https://shrinerb.com/docs/plugins/store_dimensions" target="_blank" rel="noopener noreferrer">image dimensions</a>, or your own
<a href="https://shrinerb.com/docs/plugins/add_metadata" target="_blank" rel="noopener noreferrer">custom metadata</a>.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:determine_mime_type</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># mime_type</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:store_dimensions</span><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># width &amp; height</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  add_metadata </span><span style="color:#BF9EEE">:resolution</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io|</span></span>
<span class="line"><span style="color:#F6F6F4">    image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Image</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(io.path)</span></span>
<span class="line"><span style="color:#F6F6F4">    image.resolution</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image.metadata </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;size&quot; =&gt; 42487494,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;filename&quot; =&gt; &quot;nature.jpg&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;mime_type&quot; =&gt; &quot;image/jpeg&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;width&quot; =&gt; 600,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;height&quot; =&gt; 400,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;resolution&quot; =&gt; [72, 72],</span></span>
<span class="line"><span style="color:#7B7F8B">#   ...</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">​</a></h2><p>For file validations there are <a href="https://shrinerb.com/docs/plugins/validation_helpers" target="_blank" rel="noopener noreferrer">built-in validators</a>, but
you can also just use plain Ruby code:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_max_size </span><span style="color:#BF9EEE">10</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_extension </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[jpg jpeg png webp]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">if</span><span style="color:#F6F6F4"> validate_mime_type </span><span style="color:#F286C4">%</span><span style="color:#97E1F1;font-style:italic">W</span><span style="color:#F6F6F4">[image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">jpeg image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">png image</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">webp]</span></span>
<span class="line"><span style="color:#F6F6F4">      validate_max_dimensions [</span><span style="color:#BF9EEE">5000</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">5000</span><span style="color:#F6F6F4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#F286C4">unless</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.valid_image?(file.download.path)</span></span>
<span class="line"><span style="color:#F6F6F4">        error </span><span style="color:#F286C4">&lt;&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">seems to be corrupted</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">      </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backgrounding">Backgrounding<a href="#backgrounding" class="hash-link" aria-label="Direct link to Backgrounding" title="Direct link to Backgrounding">​</a></h2><p>In most file upload solutions, support for background processing was an
afterthought, which resulted in complex and unreliable implementations. Shrine
was designed with backgrounding feature in mind from day one. It is supported
via the <a href="https://shrinerb.com/docs/plugins/backgrounding" target="_blank" rel="noopener noreferrer"><code>backgrounding</code></a> plugin and can be used with <a href="https://github.com/shrinerb/shrine/wiki/Backgrounding-Libraries" target="_blank" rel="noopener noreferrer">any
backgrounding library</a>.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:backgrounding</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.promote_block </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">PromoteJob</span><span style="color:#F6F6F4">.perform_async(</span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">.class.name, record.class.name, record.id, name, file_data)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PromoteJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.create_derivatives </span><span style="color:#7B7F8B"># perform processing</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_promote</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">rescue</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">AttachmentChanged</span><span style="color:#F6F6F4">, </span><span style="color:#97E1F1;font-style:italic">ActiveRecord</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">RecordNotFound</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># attachment changes are detected for concurrency safety</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>With Shrine, there is no need for a separate boolean column that indicates the
processing status. Processed file data is stored into the attachment database
column, which allows you to easily check whether a file has been processed.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.create(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file) </span><span style="color:#7B7F8B"># background job is kicked off</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; nil (thumbnails are still being processed)</span></span>
<span class="line"><span style="color:#7B7F8B"># ... sometime later ...</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt; (processing has finished)</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="direct-uploads">Direct Uploads<a href="#direct-uploads" class="hash-link" aria-label="Direct link to Direct Uploads" title="Direct link to Direct Uploads">​</a></h2><p>For client side uploads, Shrine adopts <strong><a href="https://uppy.io" target="_blank" rel="noopener noreferrer">Uppy</a></strong>, a modern JavaScript file
upload library. This gives the developer a lot more power in customizing the
user experience compared to a custom JavaScript solution implemented by Refile
and Active Storage.</p><p>Uppy supports direct uploads to <a href="https://uppy.io/docs/aws-s3/" target="_blank" rel="noopener noreferrer">AWS S3</a> or to a <a href="https://uppy.io/docs/xhr-upload/" target="_blank" rel="noopener noreferrer">custom
endpoint</a>. It also supports <strong>resumable</strong> uploads, either
<a href="https://uppy.io/docs/aws-s3-multipart/" target="_blank" rel="noopener noreferrer">directly to S3</a> or via the <a href="https://tus.io" target="_blank" rel="noopener noreferrer">tus protocol</a>. For the
UI you can choose from various components, ranging from a simple <a href="https://uppy.io/examples/statusbar/" target="_blank" rel="noopener noreferrer">status
bar</a> to a full-featured <a href="https://uppy.io/examples/dashboard/" target="_blank" rel="noopener noreferrer">dashboard</a>.</p><p>Shrine provides server side components for each type of upload. They are built
on top of Rack, so that they can be used with any Ruby web framework.</p><table><thead><tr><th align="left">Uppy</th><th align="left">Shrine</th></tr></thead><tbody><tr><td align="left"><a href="https://uppy.io/docs/xhr-upload/" target="_blank" rel="noopener noreferrer">XHRUpload</a></td><td align="left"><a href="https://shrinerb.com/docs/plugins/upload_endpoint" target="_blank" rel="noopener noreferrer"><code>upload_endpoint</code></a></td></tr><tr><td align="left"><a href="https://uppy.io/docs/aws-s3/" target="_blank" rel="noopener noreferrer">AwsS3</a></td><td align="left"><a href="https://shrinerb.com/docs/plugins/presign_endpoint" target="_blank" rel="noopener noreferrer"><code>presign_endpoint</code></a></td></tr><tr><td align="left"><a href="https://uppy.io/docs/aws-s3-multipart/" target="_blank" rel="noopener noreferrer">AwsS3Multipart</a></td><td align="left"><a href="https://github.com/janko/uppy-s3_multipart" target="_blank" rel="noopener noreferrer"><code>uppy-s3_multipart</code></a></td></tr><tr><td align="left"><a href="https://uppy.io/docs/tus/" target="_blank" rel="noopener noreferrer">Tus</a></td><td align="left"><a href="https://github.com/janko/tus-ruby-server" target="_blank" rel="noopener noreferrer"><code>tus-ruby-server</code></a></td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shrinerb/shrine/edit/master/doc/../doc/advantages.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2020-02-06T08:08:02.000Z">Feb 6, 2020</time></b> by <b>Tatsuya Hoshino</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--next" href="/docs/getting-started"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generality" class="table-of-contents__link toc-highlight">Generality</a></li><li><a href="#simplicity" class="table-of-contents__link toc-highlight">Simplicity</a></li><li><a href="#modularity" class="table-of-contents__link toc-highlight">Modularity</a><ul><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li></ul></li><li><a href="#inheritance" class="table-of-contents__link toc-highlight">Inheritance</a></li><li><a href="#processing" class="table-of-contents__link toc-highlight">Processing</a><ul><li><a href="#imagemagick" class="table-of-contents__link toc-highlight">ImageMagick</a></li><li><a href="#libvips" class="table-of-contents__link toc-highlight">libvips</a></li><li><a href="#other-processors" class="table-of-contents__link toc-highlight">Other processors</a></li></ul></li><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#backgrounding" class="table-of-contents__link toc-highlight">Backgrounding</a></li><li><a href="#direct-uploads" class="table-of-contents__link toc-highlight">Direct Uploads</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Janko Marohnić</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b0f70eb.js"></script>
<script src="/assets/js/main.3b0d02ea.js"></script>
</body>
</html>