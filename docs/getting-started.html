<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Getting Started | Shrine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://shrinerb.com/docs/getting-started"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Getting Started | Shrine"><meta data-rh="true" name="description" content="Quick start"><meta data-rh="true" property="og:description" content="Quick start"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shrinerb.com/docs/getting-started"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/getting-started" hreflang="en"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/getting-started" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBFWBJ5DPX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Shrine" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.efb93a3c.css">
<link rel="preload" href="/assets/js/runtime~main.3b0f70eb.js" as="script">
<link rel="preload" href="/assets/js/main.d7cd1c0d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shrine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started">Guides</a><a class="navbar__item navbar__link" href="/docs/plugins/activerecord">Plugins</a><a class="navbar__item navbar__link" href="/docs/external/extensions">External</a><a class="navbar__item navbar__link" href="/docs/release_notes/3.5.0">Release Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shrinerb/shrine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/advantages">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advantages">Advantages of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started">Getting Started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/design">Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design">The Design of Shrine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/attacher">Using Attacher</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/storage/file-system">Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/file-system">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/s3">AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/storage/memory">Memory</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/direct-s3">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata">Extracting Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/processing">File Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">File Validation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/multiple-files">Extras</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/multiple-files">Multiple Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/securing-uploads">Securing Uploads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing">Testing with Shrine</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/changing-derivatives">Migrating</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-location">Migrating File Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/changing-storage">Migrating File Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/creating-plugins">Extending</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/creating-storages">Writing a Storage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/upgrading-to-3">Upgrading</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/carrierwave">Upgrading from CarrierWave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/paperclip">Upgrading from Paperclip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/refile">Upgrading from Refile</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting Started</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick start<a href="#quick-start" class="hash-link" aria-label="Direct link to Quick start" title="Direct link to Quick start">​</a></h2><p>Add Shrine to the Gemfile and write an initializer which sets up the storage
and loads integration for your persistence library:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 3.0</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine/storage/file_system</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">FileSystem</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">public</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">uploads/cache</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">), </span><span style="color:#7B7F8B"># temporary</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">FileSystem</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">public</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">uploads</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">),       </span><span style="color:#7B7F8B"># permanent</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:sequel</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># or :activerecord</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:cached_attachment_data</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># for retaining the cached file across form redisplays</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:restore_cached_data</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># re-extract metadata when attaching a cached file</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:rack_file</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># for non-Rails apps</span></span></code></pre></div><p>Next decide how you will name the attachment attribute on your model, and run a
migration that adds an <code>&lt;attachment&gt;_data</code> text or JSON column, which Shrine
will use to store all information about the attachment:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Sequel</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Active Record</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Rails</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Sequel</span><span style="color:#F6F6F4">.migration </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  change </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    add_column </span><span style="color:#BF9EEE">:photos</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:image_data</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:text</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># or :jsonb</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">AddImageDataToPhotos</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ActiveRecord::Migration</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">change</span></span>
<span class="line"><span style="color:#F6F6F4">    add_column </span><span style="color:#BF9EEE">:photos</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:image_data</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">:text</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># or :jsonb</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">$ rails generate migration add_image_data_to_photos image_data</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">text </span><span style="color:#7B7F8B"># or image_data:jsonb</span></span></code></pre></div></div></div></div><p>If using <code>jsonb</code> consider adding a <a href="https://www.postgresql.org/docs/current/datatype-json.html#JSON-INDEXING" target="_blank" rel="noopener noreferrer">gin index</a> for fast key-value pair searchability within <code>image_data</code>.</p><p>Now you can create an uploader class for the type of files you want to upload,
and add a virtual attribute for handling attachments using this uploader to
your model. If you do not care about adding plugins or additional processing,
you can use <code>Shrine::Attachment</code>.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># plugins and uploading logic</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Sequel</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Active Record</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">Photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sequel::Model</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Attachment</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># adds an `image` virtual attribute</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">Photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ActiveRecord::Base</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Attachment</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># adds an `image` virtual attribute</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div></div></div><p>Let&#x27;s now add the form fields which will use this virtual attribute (NOT the
<code>&lt;attachment&gt;_data</code> column attribute). We need (1) a file field for choosing
files, and (2) a hidden field for retaining the uploaded file in case of
validation errors and for potential <a href="#direct-uploads">direct uploads</a>.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Rails form builder</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Simple Form</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Forme</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">HTML</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">form_for </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |f|</span></span>
<span class="line"><span style="color:#F6F6F4">  f.hidden_field </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, value</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">.cached_image_data, id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span></span>
<span class="line"><span style="color:#F6F6F4">  f.file_field </span><span style="color:#BF9EEE">:image</span></span>
<span class="line"><span style="color:#F6F6F4">  f.submit</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">simple_form_for </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |f|</span></span>
<span class="line"><span style="color:#F6F6F4">  f.input </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, as</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:hidden</span><span style="color:#F6F6F4">, input_html</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { value</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">.cached_image_data }</span></span>
<span class="line"><span style="color:#F6F6F4">  f.input </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, as</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:file</span></span>
<span class="line"><span style="color:#F6F6F4">  f.button </span><span style="color:#BF9EEE">:submit</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">form </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">, action</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/photos</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, enctype</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">multipart/form-data</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |f|</span></span>
<span class="line"><span style="color:#F6F6F4">  f.input </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, type</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:hidden</span><span style="color:#F6F6F4">, value</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">.cached_image_data</span></span>
<span class="line"><span style="color:#F6F6F4">  f.input </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">, type</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:file</span></span>
<span class="line"><span style="color:#F6F6F4">  f.button </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">Create</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">&lt;</span><span style="color:#F286C4">form</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">action</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/photos</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">method</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">post</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">enctype</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">multipart/form-data</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">  &lt;</span><span style="color:#F286C4">input</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">name</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">photo[image]</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">type</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">hidden</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">value</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#F286C4">&lt;%=</span><span style="color:#E7EE98"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#E7EE98">.cached_image_data </span><span style="color:#F286C4">%&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> /&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">  &lt;</span><span style="color:#F286C4">input</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">name</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">photo[image] </span><span style="color:#DEE492">&quot;</span><span style="color:#62E884;font-style:italic">type</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">file</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> /&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">  &lt;</span><span style="color:#F286C4">input</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">type</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">submit</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">value</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">Create</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> /&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">&lt;/</span><span style="color:#F286C4">form</span><span style="color:#F6F6F4">&gt;</span></span></code></pre></div></div></div></div><p>Note that the file field needs to go <em>after</em> the hidden field, so that
selecting a new file can always override the cached file in the hidden field.
Also notice the <code>enctype=&quot;multipart/form-data&quot;</code> HTML attribute, which is
required for submitting files through the form (the Rails form builder
will automatically generate this for you).</p><p>When the form is submitted, in your router/controller you can assign the file
from request params to the attachment attribute on the model.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Rails</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Sinatra</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PhotosController</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ApplicationController</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">create</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.create(photo_params)</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">private</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">photo_params</span></span>
<span class="line"><span style="color:#F6F6F4">    params.require(</span><span style="color:#BF9EEE">:photo</span><span style="color:#F6F6F4">).permit(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">post </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/photos</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.create(params[</span><span style="color:#BF9EEE">:photo</span><span style="color:#F6F6F4">])</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div></div></div><p>Once a file is uploaded and attached to the record, you can retrieve a URL to
the uploaded file with <code>#&lt;attachment&gt;_url</code> and display it on the page:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Rails</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">HTML</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">&lt;%=</span><span style="color:#F6F6F4"> image_tag </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#F6F6F4">.image_url </span><span style="color:#F286C4">%&gt;</span></span></code></pre></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">&lt;</span><span style="color:#F286C4">img</span><span style="color:#F6F6F4"> </span><span style="color:#62E884;font-style:italic">src</span><span style="color:#F286C4">=</span><span style="color:#DEE492">&quot;</span><span style="color:#F286C4">&lt;%=</span><span style="color:#E7EE98"> </span><span style="color:#BF9EEE;font-style:italic">@photo</span><span style="color:#E7EE98">.image_url </span><span style="color:#F286C4">%&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> /&gt;</span></span></code></pre></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">​</a></h2><p>A &quot;storage&quot; in Shrine is an object that encapsulates communication with a
specific storage service, by implementing a common public interface. Storage
instances are registered under an identifier in <code>Shrine.storages</code>, so that they
can later be used by <a href="#uploader">uploaders</a>.</p><p>Shrine ships with the following storages:</p><ul><li><a href="https://shrinerb.com/docs/storage/file-system" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::FileSystem</code></a> – stores files on disk</li><li><a href="https://shrinerb.com/docs/storage/s3" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::S3</code></a> – stores files on <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">AWS S3</a> (or <a href="https://www.digitalocean.com/products/spaces/" target="_blank" rel="noopener noreferrer">DigitalOcean Spaces</a>, <a href="https://min.io/" target="_blank" rel="noopener noreferrer">MinIO</a>, ...)</li><li><a href="https://shrinerb.com/docs/storage/memory" target="_blank" rel="noopener noreferrer"><code>Shrine::Storage::Memory</code></a> – stores file in memory (convenient for <a href="https://shrinerb.com/docs/testing" target="_blank" rel="noopener noreferrer">testing</a>)</li></ul><p>Here is how we might configure Shrine with S3 storage:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">aws-sdk-s3</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 1.14</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># for AWS S3 storage</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine/storage/s3</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">s3_options </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  bucket</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;YOUR BUCKET&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#7B7F8B"># required</span></span>
<span class="line"><span style="color:#F6F6F4">  region</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">            </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;YOUR REGION&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#7B7F8B"># required</span></span>
<span class="line"><span style="color:#F6F6F4">  access_key_id</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">     </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;YOUR ACCESS KEY ID&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  secret_access_key</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;YOUR SECRET ACCESS KEY&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">cache</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options), </span><span style="color:#7B7F8B"># temporary</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options),                  </span><span style="color:#7B7F8B"># permanent</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span></code></pre></div><p>The above example sets up S3 for both temporary and permanent storage, which is
suitable for <a href="#presigned-direct-upload">direct uploads</a>. The <code>:cache</code> and <code>:store</code>
names are special only in terms that the <a href="#attacher">attacher</a> will automatically pick
them up, you can also register more storage objects under different names.</p><p>See the <a href="https://shrinerb.com/docs/storage/file-system" target="_blank" rel="noopener noreferrer">FileSystem</a>/<a href="https://shrinerb.com/docs/storage/s3" target="_blank" rel="noopener noreferrer">S3</a>/<a href="https://shrinerb.com/docs/storage/memory" target="_blank" rel="noopener noreferrer">Memory</a> storage docs for more details. There are
<a href="https://shrinerb.com/docs/external/extensions#storages" target="_blank" rel="noopener noreferrer">many more Shrine storages</a> provided by external gems, and you can
also <a href="https://shrinerb.com/docs/creating-storages" target="_blank" rel="noopener noreferrer">create your own storage</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uploader">Uploader<a href="#uploader" class="hash-link" aria-label="Direct link to Uploader" title="Direct link to Uploader">​</a></h2><p>Uploaders are subclasses of <code>Shrine</code>, and they wrap the actual upload to the
storage. They perform common tasks around upload that aren&#x27;t related to a
particular storage.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">MyUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># image attachment logic</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>It&#x27;s common to create an uploader for each type of file that you want to handle
(<code>ImageUploader</code>, <code>VideoUploader</code>, <code>AudioUploader</code> etc), but really you can
organize them in any way you like.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uploading">Uploading<a href="#uploading" class="hash-link" aria-label="Direct link to Uploading" title="Direct link to Uploading">​</a></h3><p>The main method of the uploader is <code>Shrine.upload</code>, which takes an <a href="#io-abstraction">IO-like
object</a> and a storage identifier on the input, and returns a
representation of the <a href="#uploaded-file">uploaded file</a> on the output.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">MyUploader</span><span style="color:#F6F6F4">.upload(file, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span></code></pre></div><p>Internally this instantiates the uploader with the storage and calls
<code>Shrine#upload</code>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">MyUploader</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload(file) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span></code></pre></div><p>Some of the tasks performed by <code>#upload</code> include:</p><ul><li>extracting <a href="#metadata">metadata</a></li><li>generating <a href="#location">location</a></li><li>uploading (this is where the <a href="#storage">storage</a> is called)</li><li>closing the uploaded file</li></ul><p>The second argument is a &quot;context&quot; hash which is forwarded to places like
metadata extraction and location generation, but it has a few special options:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader.upload(io, metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">foo</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">bar</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> })           </span><span style="color:#7B7F8B"># add metadata</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload(io, location</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">path/to/file</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)               </span><span style="color:#7B7F8B"># specify custom location</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload(io, upload_options</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> { acl</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">public-read</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> }) </span><span style="color:#7B7F8B"># add options to Storage#upload</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="io-abstraction">IO abstraction<a href="#io-abstraction" class="hash-link" aria-label="Direct link to IO abstraction" title="Direct link to IO abstraction">​</a></h3><p>Shrine is able to upload any IO-like object that implement methods <a href="https://ruby-doc.org/core/IO.html#method-i-read" target="_blank" rel="noopener noreferrer"><code>#read</code></a>,
<a href="https://ruby-doc.org/core/IO.html#method-i-rewind" target="_blank" rel="noopener noreferrer"><code>#rewind</code></a>, <a href="https://ruby-doc.org/core/IO.html#method-i-eof" target="_blank" rel="noopener noreferrer"><code>#eof?</code></a> and <a href="https://ruby-doc.org/core/IO.html#method-i-close" target="_blank" rel="noopener noreferrer"><code>#close</code></a> whose behaviour matches the <a href="https://ruby-doc.org/core/IO.html" target="_blank" rel="noopener noreferrer"><code>IO</code></a> class.
This includes but is not limited to the following objects:</p><ul><li><a href="https://ruby-doc.org/core/File.html" target="_blank" rel="noopener noreferrer"><code>File</code></a></li><li><a href="https://ruby-doc.org/stdlib/libdoc/tempfile/rdoc/Tempfile.html" target="_blank" rel="noopener noreferrer"><code>Tempfile</code></a></li><li><a href="https://ruby-doc.org/stdlib/libdoc/stringio/rdoc/StringIO.html" target="_blank" rel="noopener noreferrer"><code>StringIO</code></a></li><li><a href="https://api.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html" target="_blank" rel="noopener noreferrer"><code>ActionDispatch::Http::UploadedFile</code></a></li><li><a href="https://shrinerb.com/docs/plugins/rack_file" target="_blank" rel="noopener noreferrer"><code>Shrine::RackFile</code></a></li><li><a href="https://shrinerb.com/docs/plugins/data_uri" target="_blank" rel="noopener noreferrer"><code>Shrine::DataFile</code></a></li><li><a href="#uploaded-file"><code>Shrine::UploadedFile</code></a></li><li><a href="https://github.com/janko/down#streaming" target="_blank" rel="noopener noreferrer"><code>Down::ChunkedIO</code></a></li><li>...</li></ul><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/path/to/file</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, binmode</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4">)   </span><span style="color:#7B7F8B"># upload from disk</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">StringIO</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">file content</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)                </span><span style="color:#7B7F8B"># upload from memory</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">ActionDispatch</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Http</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">UploadedFile</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(...) </span><span style="color:#7B7F8B"># upload from Rails controller</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.rack_file({ tempfile</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> tempfile })    </span><span style="color:#7B7F8B"># upload from Rack controller</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">Rack</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Test</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">UploadedFile</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(...)           </span><span style="color:#7B7F8B"># upload from rack-test</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">Down</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">https://example.org/file</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)       </span><span style="color:#7B7F8B"># upload from internet</span></span>
<span class="line"><span style="color:#F6F6F4">uploader.upload </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">UploadedFile</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(...)               </span><span style="color:#7B7F8B"># upload from Shrine storage</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uploaded-file">Uploaded file<a href="#uploaded-file" class="hash-link" aria-label="Direct link to Uploaded file" title="Direct link to Uploaded file">​</a></h2><p>The <code>Shrine::UploadedFile</code> object represents the file that was uploaded to a
storage, and it&#x27;s what&#x27;s returned from <code>Shrine#upload</code> or when retrieving a
record <a href="#attaching">attachment</a>.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploader.upload(file) </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile ...&gt;  (uploader)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image           </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile ...&gt;  (attachment)</span></span>
<span class="line"><span style="color:#F6F6F4">attacher.file         </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile ...&gt;  (attacher)</span></span></code></pre></div><p>An uploaded file object contains the following data:</p><table><thead><tr><th align="left">Key</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>id</code></td><td align="left">location of the file on the storage</td></tr><tr><td align="left"><code>storage</code></td><td align="left">identifier of the storage the file was uploaded to</td></tr><tr><td align="left"><code>metadata</code></td><td align="left">file <a href="#metadata">metadata</a> that was extracted before upload</td></tr></tbody></table><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;949sdjg834.jpg&quot; storage=:store metadata={...}&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.id          </span><span style="color:#7B7F8B">#=&gt; &quot;949sdjg834.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.storage_key </span><span style="color:#7B7F8B">#=&gt; :store</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.storage     </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::Storage::S3&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.metadata    </span><span style="color:#7B7F8B">#=&gt; {...}</span></span></code></pre></div><p>It comes with many convenient methods that delegate to the storage:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file.url                     </span><span style="color:#7B7F8B">#=&gt; &quot;https://my-bucket.s3.amazonaws.com/949sdjg834.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4"> { |io| ... }       </span><span style="color:#7B7F8B"># opens the uploaded file stream</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.download { |file| ... } </span><span style="color:#7B7F8B"># downloads the uploaded file to disk</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.stream(destination)     </span><span style="color:#7B7F8B"># streams uploaded content into a writable destination</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.exists?                 </span><span style="color:#7B7F8B">#=&gt; true</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.delete                  </span><span style="color:#7B7F8B"># deletes the uploaded file from the storage</span></span></code></pre></div><p>It also implements the IO-like interface that conforms to Shrine&#x27;s <a href="#io-abstraction">IO
abstraction</a>, which allows it to be uploaded again to other
storages.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file.read   </span><span style="color:#7B7F8B"># returns content of the uploaded file</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.eof?   </span><span style="color:#7B7F8B"># returns true if the whole IO was read</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.rewind </span><span style="color:#7B7F8B"># rewinds the IO</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.close  </span><span style="color:#7B7F8B"># closes the IO</span></span></code></pre></div><p>For more details, see the <a href="https://shrinerb.com/docs/retrieving-uploads" target="_blank" rel="noopener noreferrer">Retrieving Uploads</a> guide and
<a href="https://shrinerb.com/rdoc/classes/Shrine/UploadedFile/InstanceMethods.html" target="_blank" rel="noopener noreferrer"><code>Shrine::UploadedFile</code></a> API docs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="attaching">Attaching<a href="#attaching" class="hash-link" aria-label="Direct link to Attaching" title="Direct link to Attaching">​</a></h2><p>To attach uploaded files to database records, Shrine offers an attachment
interface built on top of uploaders and uploaded files. There are integrations
for various persistence libraries (<a href="https://shrinerb.com/docs/plugins/activerecord" target="_blank" rel="noopener noreferrer">ActiveRecord</a>,
<a href="https://shrinerb.com/docs/plugins/sequel" target="_blank" rel="noopener noreferrer">Sequel</a>, <a href="https://github.com/shrinerb/shrine-rom" target="_blank" rel="noopener noreferrer">ROM</a>, <a href="https://github.com/katafrakt/hanami-shrine" target="_blank" rel="noopener noreferrer">Hanami</a>,
<a href="https://github.com/shrinerb/shrine-mongoid" target="_blank" rel="noopener noreferrer">Mongoid</a>), but you can also attach files to plain structs
(<a href="https://shrinerb.com/docs/plugins/model" target="_blank" rel="noopener noreferrer">mutable</a> or <a href="https://shrinerb.com/docs/plugins/entity" target="_blank" rel="noopener noreferrer">immutable</a>).</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:sequel</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># :activerecord</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="attachment-module">Attachment module<a href="#attachment-module" class="hash-link" aria-label="Direct link to Attachment module" title="Direct link to Attachment module">​</a></h3><p>The easiest way to attach files is with the <code>Shrine::Attachment</code> module:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">Photo</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sequel::Model</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># ActiveRecord::Base</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attachment</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attachment</span><span style="color:#F6F6F4">[</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">]     </span><span style="color:#7B7F8B"># use your preferred syntax</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Attachment</span><span style="color:#F6F6F4">(</span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">)     </span><span style="color:#7B7F8B">#</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>The included module will add attachment methods for the specified attribute:</p><table><thead><tr><th align="left">Method</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>#image=</code></td><td align="left">uploads the file to temporary storage and serializes the result into <code>image_data</code></td></tr><tr><td align="left"><code>#image</code></td><td align="left">returns <a href="#uploaded-file"><code>Shrine::UploadedFile</code></a> instantiated from <code>image_data</code></td></tr><tr><td align="left"><code>#image_url</code></td><td align="left">calls <code>url</code> on the attachment if it&#x27;s present, otherwise returns nil</td></tr><tr><td align="left"><code>#image_attacher</code></td><td align="left">returns instance of <a href="#attacher"><code>Shrine::Attacher</code></a> which handles the attaching</td></tr></tbody></table><p>The persistence plugin we loaded will add callbacks that ensure cached files
are automatically promoted to permanent storage on when record is saved, and
that attachments are deleted when the record is destroyed.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># no file is attached</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#7B7F8B">#=&gt; nil</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># the assigned file is cached to temporary storage and written to `image_data` column</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">waterfall.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image      </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile ...&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_url  </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/cache/0sdfllasfi842.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_data </span><span style="color:#7B7F8B">#=&gt; &#x27;{&quot;id&quot;:&quot;0sdfllasfi842.jpg&quot;,&quot;storage&quot;:&quot;cache&quot;,&quot;metadata&quot;:{...}}&#x27;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># the cached file is promoted to permanent storage and saved to `image_data` column</span></span>
<span class="line"><span style="color:#F6F6F4">photo.save</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image      </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile ...&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_url  </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/store/l02kladf8jlda.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image_data </span><span style="color:#7B7F8B">#=&gt; &#x27;{&quot;id&quot;:&quot;l02kladf8jlda.jpg&quot;,&quot;storage&quot;:&quot;store&quot;,&quot;metadata&quot;:{...}}&#x27;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># the attached file is deleted with the record</span></span>
<span class="line"><span style="color:#F6F6F4">photo.destroy</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.exists? </span><span style="color:#7B7F8B">#=&gt; false</span></span></code></pre></div><p>If there is already a file attached and a new file is attached, the previous
attachment will get deleted when the record gets saved.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.update(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> new_file) </span><span style="color:#7B7F8B"># changes the attachment and deletes previous</span></span>
<span class="line"><span style="color:#F6F6F4">photo.update(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">)      </span><span style="color:#7B7F8B"># removes the attachment and deletes previous</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="attacher">Attacher<a href="#attacher" class="hash-link" aria-label="Direct link to Attacher" title="Direct link to Attacher">​</a></h3><p>The methods and callbacks added by the <code>Shrine::Attachment</code> module just
delegate the behaviour to an underlying <code>Shrine::Attacher</code> object.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image_attacher </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::Attacher&gt;</span></span></code></pre></div><p>The <code>Shrine::Attacher</code> object can be instantiated and used directly:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.from_model(photo, </span><span style="color:#BF9EEE">:image</span><span style="color:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">attacher.assign(file) </span><span style="color:#7B7F8B"># equivalent to `photo.image = file`</span></span>
<span class="line"><span style="color:#F6F6F4">attacher.file         </span><span style="color:#7B7F8B"># equivalent to `photo.image`</span></span>
<span class="line"><span style="color:#F6F6F4">attacher.url          </span><span style="color:#7B7F8B"># equivalent to `photo.image_url`</span></span></code></pre></div><p>The attacher is what drives attaching files to model instances; you can use it
as a more explicit alternative to models&#x27; attachment interface, or when you
need something that&#x27;s not available through the attachment methods.</p><p>See <a href="https://shrinerb.com/docs/attacher" target="_blank" rel="noopener noreferrer">Using Attacher</a> guide for more details.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="temporary-storage">Temporary storage<a href="#temporary-storage" class="hash-link" aria-label="Direct link to Temporary storage" title="Direct link to Temporary storage">​</a></h3><p>Shrine uses temporary storage to support <a href="#validation">file validation</a> and
<a href="#direct-uploads">direct uploads</a>. If you don&#x27;t need these features, you can tell Shrine to
upload files directly to permanent storage:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:model</span><span style="color:#F6F6F4">, cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">false</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">waterfall.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.storage_key </span><span style="color:#7B7F8B">#=&gt; :store</span></span></code></pre></div><p>If you&#x27;re using the attacher directly, you can just use <code>Attacher#attach</code>
instead of <code>Attacher#assign</code>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">attacher.attach </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">waterfall.jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">attacher.file.storage_key </span><span style="color:#7B7F8B">#=&gt; :store</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-system">Plugin system<a href="#plugin-system" class="hash-link" aria-label="Direct link to Plugin system" title="Direct link to Plugin system">​</a></h2><p>By default, Shrine comes with a small core which provides only the essential
functionality. All additional features are available via <a href="https://shrinerb.com/plugins" target="_blank" rel="noopener noreferrer">plugins</a>, which also
ship with Shrine. This way you can choose exactly what and how much Shrine does
for you, and you load the code only for features that you use.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:instrumentation</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># adds instrumentation</span></span></code></pre></div><p>Plugins add behaviour by extending Shrine core classes via module inclusion, and
many of them also accept configuration options. The plugin system respects
inheritance, so you can choose to load a plugin globally or per uploader.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:store_dimensions</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># extract image dimensions only for this uploader and its descendants</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>If you want to extend Shrine functionality with custom behaviour, you can also
<a href="https://shrinerb.com/docs/creating-plugins" target="_blank" rel="noopener noreferrer">create your own plugin</a>. There are also additional <a href="https://shrinerb.com/docs/external/extensions#plugins" target="_blank" rel="noopener noreferrer">external
plugins</a> created by others.</p><blockquote><p>NOTE: An uploader class will inherit a copy of current superclass&#x27; plugin
options at the time of subclassing. This means you should <em>not</em> load
additional plugins on a superclass after the subclass has already been
created, because new options will not get applied to the subclass, which
can result in errors.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a href="#metadata" class="hash-link" aria-label="Direct link to Metadata" title="Direct link to Metadata">​</a></h2><p>Shrine automatically extracts some basic file metadata and saves them to the
<code>Shrine::UploadedFile</code>. You can access them through the <code>#metadata</code> hash or via
metadata methods:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">uploaded_file.metadata </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;filename&quot; =&gt; &quot;matrix.mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;mime_type&quot; =&gt; &quot;video/mp4&quot;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;size&quot; =&gt; 345993,</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.original_filename </span><span style="color:#7B7F8B">#=&gt; &quot;matrix.mp4&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.extension         </span><span style="color:#7B7F8B">#=&gt; &quot;mp4&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.mime_type         </span><span style="color:#7B7F8B">#=&gt; &quot;video/mp4&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.size              </span><span style="color:#7B7F8B">#=&gt; 345993</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mime-type">MIME type<a href="#mime-type" class="hash-link" aria-label="Direct link to MIME type" title="Direct link to MIME type">​</a></h3><p>By default, <code>mime_type</code> metadata will be set from the <code>#content_type</code> attribute
of the uploaded file (if it exists), which is generally not secure and will
trigger a warning. You can load the <a href="https://shrinerb.com/docs/plugins/determine_mime_type" target="_blank" rel="noopener noreferrer"><code>determine_mime_type</code></a> plugin to have MIME type extracted from file <em>content</em> instead.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">marcel</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 0.3</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:determine_mime_type</span><span style="color:#F6F6F4">, analyzer</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:marcel</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">StringIO</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;?php ... ?&gt;</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">))</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image.mime_type </span><span style="color:#7B7F8B">#=&gt; &quot;application/x-php&quot;</span></span></code></pre></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-metadata">Other metadata<a href="#other-metadata" class="hash-link" aria-label="Direct link to Other metadata" title="Direct link to Other metadata">​</a></h3><p>In addition to basic metadata, you can also extract <a href="https://shrinerb.com/docs/plugins/store_dimensions" target="_blank" rel="noopener noreferrer">image
dimensions</a>, calculate <a href="https://shrinerb.com/docs/plugins/signature" target="_blank" rel="noopener noreferrer">signatures</a>,
and in general extract any <a href="https://shrinerb.com/docs/plugins/add_metadata" target="_blank" rel="noopener noreferrer">custom metadata</a>. Check out
the <a href="https://shrinerb.com/docs/metadata" target="_blank" rel="noopener noreferrer">Extracting Metadata</a> guide for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing">Processing<a href="#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h2><p>Shrine allows you to process attached files both &quot;eagerly&quot; and &quot;on-the-fly&quot;.
For example, if your app is accepting image uploads, you can generate a
predefined set of thumbnails when the image is attached to a record, or you
can have thumbnails generated dynamically as they&#x27;re needed.</p><p>For image processing, it&#x27;s recommended to use the <strong><a href="https://github.com/janko/image_processing" target="_blank" rel="noopener noreferrer">ImageProcessing</a></strong> gem,
which is a high-level wrapper for processing with
<a href="https://github.com/janko/image_processing/blob/master/doc/minimagick.md#readme" target="_blank" rel="noopener noreferrer">MiniMagick</a> and <a href="https://github.com/janko/image_processing/blob/master/doc/vips.md#readme" target="_blank" rel="noopener noreferrer">libvips</a>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ brew install imagemagick vips</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="eager-processing">Eager processing<a href="#eager-processing" class="hash-link" aria-label="Direct link to Eager processing" title="Direct link to Eager processing">​</a></h3><p>We can use the <a href="https://shrinerb.com/docs/plugins/derivatives" target="_blank" rel="noopener noreferrer"><code>derivatives</code></a> plugin to generate a
pre-defined set of processed files (e.g. image thumbnails). We do this by
registering a derivatives processor block and then explicitly triggering
creation:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 1.8</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:derivatives</span><span style="color:#F6F6F4">, create_on_promote</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/mini_magick</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.derivatives </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    magick </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(original)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    {</span></span>
<span class="line"><span style="color:#F6F6F4">      large</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      medium</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> magick.resize_to_limit!(</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">      small</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">  magick.resize_to_limit!(</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">),</span></span>
<span class="line"><span style="color:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Photo</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(image</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file)</span></span>
<span class="line"><span style="color:#F6F6F4">photo.save </span><span style="color:#7B7F8B"># automatically creates derivatives on promotion</span></span></code></pre></div><p>You can then retrieve the URL of a processed derivative:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image_url(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B">#=&gt; &quot;https://s3.amazonaws.com/path/to/large.jpg&quot;</span></span></code></pre></div><p>The derivatives data is stored in the <code>&lt;attachment&gt;_data</code> column, and you can
retrieve them as <a href="#uploaded-file"><code>Shrine::UploadedFile</code></a> objects:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">)           </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile id=&quot;path/to/large.jpg&quot; storage=:store metadata={...}&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">).url       </span><span style="color:#7B7F8B">#=&gt; &quot;https://s3.amazonaws.com/path/to/large.jpg&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">).size      </span><span style="color:#7B7F8B">#=&gt; 5825949</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">).mime_type </span><span style="color:#7B7F8B">#=&gt; &quot;image/jpeg&quot;</span></span></code></pre></div><p>For more details, see the <a href="https://shrinerb.com/docs/processing" target="_blank" rel="noopener noreferrer">File Processing</a> guide and the
<a href="https://shrinerb.com/docs/plugins/derivatives" target="_blank" rel="noopener noreferrer"><code>derivatives</code></a> plugin documentation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-the-fly-processing">On-the-fly processing<a href="#on-the-fly-processing" class="hash-link" aria-label="Direct link to On-the-fly processing" title="Direct link to On-the-fly processing">​</a></h3><p>On-the-fly processing is provided by the
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint" target="_blank" rel="noopener noreferrer"><code>derivation_endpoint</code></a> plugin. To set it up, we
configure the plugin with a secret key and a path prefix, <a href="https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints" target="_blank" rel="noopener noreferrer">mount</a> its Rack app in our routes on the configured path prefix, and define
processing we want to perform:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 1.8</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/initializers/rails.rb (Rails)</span></span>
<span class="line"><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:derivation_endpoint</span><span style="color:#F6F6F4">, secret_key</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">&lt;YOUR_SECRET_KEY&gt;</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/mini_magick</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  plugin </span><span style="color:#BF9EEE">:derivation_endpoint</span><span style="color:#F6F6F4">, prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">derivations/image</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># matches mount point</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  derivation </span><span style="color:#BF9EEE">:thumbnail</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |file, width, height|</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">MiniMagick</span></span>
<span class="line"><span style="color:#F6F6F4">      .source(file)</span></span>
<span class="line"><span style="color:#F6F6F4">      .resize_to_limit!(width.to_i, height.to_i)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/routes.rb (Rails)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.application.routes.draw </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  mount </span><span style="color:#97E1F1;font-style:italic">ImageUploader</span><span style="color:#F6F6F4">.derivation_endpoint </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/derivations/image</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>Now we can generate URLs from attached files that will perform the desired
processing:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">photo.image.derivation_url(</span><span style="color:#BF9EEE">:thumbnail</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">600</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">400</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#7B7F8B">#=&gt; &quot;/derivations/image/thumbnail/600/400/eyJpZCI6ImZvbyIsInN0b3JhZ2UiOiJzdG9yZSJ9?signature=...&quot;</span></span></code></pre></div><p>The on-the-fly processing feature is highly customizable, see the
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint" target="_blank" rel="noopener noreferrer"><code>derivation_endpoint</code></a> plugin documentation for
more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">​</a></h2><p>The <a href="https://shrinerb.com/docs/plugins/validation" target="_blank" rel="noopener noreferrer"><code>validation</code></a> plugin allows performing validation for
attached files. For common validations, the
<a href="https://shrinerb.com/docs/plugins/validation_helpers" target="_blank" rel="noopener noreferrer"><code>validation_helpers</code></a> plugin provides useful
validators for built in metadata:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:validation_helpers</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">DocumentUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.validate </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_max_size </span><span style="color:#BF9EEE">5</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">1024</span><span style="color:#F6F6F4">, message</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">is too large (max is 5 MB)</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">    validate_mime_type </span><span style="color:#F286C4">%</span><span style="color:#F6F6F4">w[application</span><span style="color:#F286C4">/</span><span style="color:#F6F6F4">pdf]</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">user </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">User</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span></span>
<span class="line"><span style="color:#F6F6F4">user.cv </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">File</span><span style="color:#F6F6F4">.</span><span style="color:#97E1F1">open</span><span style="color:#F6F6F4">(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">cv.pdf</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">rb</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">user.valid? </span><span style="color:#7B7F8B">#=&gt; false</span></span>
<span class="line"><span style="color:#F6F6F4">user.errors.to_hash </span><span style="color:#7B7F8B">#=&gt; {:cv=&gt;[&quot;is too large (max is 5 MB)&quot;]}</span></span></code></pre></div><p>For more details, see the <a href="https://shrinerb.com/docs/validation" target="_blank" rel="noopener noreferrer">File Validation</a> guide and
<a href="https://shrinerb.com/docs/plugins/validation_helpers" target="_blank" rel="noopener noreferrer"><code>validation_helpers</code></a> plugin docs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="location">Location<a href="#location" class="hash-link" aria-label="Direct link to Location" title="Direct link to Location">​</a></h2><p>Shrine automatically generates random locations before uploading files. By
default, the hierarchy is flat, meaning all files are stored in the root
directory of the storage.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">024d9fe83bf4fafb.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">768a336bf54de219.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">adfaa363629f7fc5.png</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <a href="https://shrinerb.com/docs/plugins/pretty_location" target="_blank" rel="noopener noreferrer"><code>pretty_location</code></a> plugin provides a good default
hierarchy:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:pretty_location</span></span></code></pre></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">user/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  564/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    avatar/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      aa3e0cd715.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      thumb-493g82jf23.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">photo/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  123/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      13f8a7bc18.png</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      thumb-9be62da67e.png</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But you can also override <code>Shrine#generate_location</code> with a custom
implementation, for example:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">generate_location</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">io</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">record</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">derivative</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">return</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">super</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">unless</span><span style="color:#F6F6F4"> record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    table  </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> record.class.table_name</span></span>
<span class="line"><span style="color:#F6F6F4">    id     </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> record.id</span></span>
<span class="line"><span style="color:#F6F6F4">    prefix </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> derivative </span><span style="color:#F286C4">||</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">original</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">uploads/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">table</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">id</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">prefix</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">-</span><span style="color:#F286C4">#{super}</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">uploads/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  photos/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    123/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      original-afe929b8b4.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      small-ad61f25883.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      medium-41b75c42bb.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      large-73e67abe50.jpg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>There should always be a random component in the location, so that the ORM
dirty tracking is detected properly.</p></blockquote><p>The <code>Shrine#generate_location</code> method contains a lot of useful context for the
upcoming upload:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">ImageUploader</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">generate_location</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">io</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">record</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">derivative</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">metadata</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> {}, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options)</span></span>
<span class="line"><span style="color:#F6F6F4">    storage_key </span><span style="color:#7B7F8B">#=&gt; :cache, :store, ...</span></span>
<span class="line"><span style="color:#F6F6F4">    io          </span><span style="color:#7B7F8B">#=&gt; #&lt;File&gt;, #&lt;Shrine::UploadedFile&gt;, ...</span></span>
<span class="line"><span style="color:#F6F6F4">    record      </span><span style="color:#7B7F8B">#=&gt; #&lt;Photo&gt;, #&lt;User&gt;, ...</span></span>
<span class="line"><span style="color:#F6F6F4">    name        </span><span style="color:#7B7F8B">#=&gt; :image, :avatar, ...</span></span>
<span class="line"><span style="color:#F6F6F4">    derivative  </span><span style="color:#7B7F8B">#=&gt; :small, :medium, :large, ... (derivatives plugin)</span></span>
<span class="line"><span style="color:#F6F6F4">    metadata    </span><span style="color:#7B7F8B">#=&gt; { &quot;filename&quot; =&gt; &quot;nature.jpg&quot;, &quot;mime_type&quot; =&gt; &quot;image/jpeg&quot;, &quot;size&quot; =&gt; 18573, ... }</span></span>
<span class="line"><span style="color:#F6F6F4">    options     </span><span style="color:#7B7F8B">#=&gt; { ... other uploader options ... }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="direct-uploads">Direct uploads<a href="#direct-uploads" class="hash-link" aria-label="Direct link to Direct uploads" title="Direct link to Direct uploads">​</a></h2><p>To improve the user experience, it&#x27;s recommended to upload files asynchronously
as soon as the user selects them. The direct uploads would go to temporary
storage, just like in the synchronous flow. Then, instead of attaching a raw
file to your model, you assign the cached file JSON data.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># in the regular synchronous flow</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># in the direct upload flow</span></span>
<span class="line"><span style="color:#F6F6F4">photo.image </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&#x27;</span><span style="color:#E7EE98">{&quot;id&quot;:&quot;...&quot;,&quot;storage&quot;:&quot;cache&quot;,&quot;metadata&quot;:{...}}</span><span style="color:#DEE492">&#x27;</span></span></code></pre></div><p>On the client side it&#x27;s highly recommended to use <strong><a href="https://uppy.io" target="_blank" rel="noopener noreferrer">Uppy</a></strong>, a very flexible
modern JavaScript file upload library that happens to integrate nicely with
Shrine.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="simple-direct-upload">Simple direct upload<a href="#simple-direct-upload" class="hash-link" aria-label="Direct link to Simple direct upload" title="Direct link to Simple direct upload">​</a></h3><p>The simplest approach is to upload directly to an endpoint in your app, which
forwards uploads to the specified storage. The
<a href="https://shrinerb.com/docs/plugins/upload_endpoint" target="_blank" rel="noopener noreferrer"><code>upload_endpoint</code></a> Shrine plugin provides a
<a href="https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints" target="_blank" rel="noopener noreferrer">mountable</a> Rack app that implements this endpoint:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:upload_endpoint</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/routes.rb (Rails)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.application.routes.draw </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  mount </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.upload_endpoint(</span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/upload</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># POST /upload</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>Then you can configure Uppy&#x27;s <a href="https://uppy.io/docs/xhr-upload/" target="_blank" rel="noopener noreferrer">XHR Upload</a> plugin to upload to
this endpoint. See <a href="https://github.com/shrinerb/shrine/wiki/Adding-Direct-App-Uploads" target="_blank" rel="noopener noreferrer">this walkthrough</a> for adding
simple direct uploads from scratch, it includes a complete JavaScript example
(there is also the <a href="https://github.com/shrinerb/shrine/tree/master/demo" target="_blank" rel="noopener noreferrer">Roda</a> / <a href="https://github.com/erikdahlstrand/shrine-rails-example" target="_blank" rel="noopener noreferrer">Rails</a> demo app).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="presigned-direct-upload">Presigned direct upload<a href="#presigned-direct-upload" class="hash-link" aria-label="Direct link to Presigned direct upload" title="Direct link to Presigned direct upload">​</a></h3><p>For better performance, you can also upload files directly to your cloud
storage service (AWS S3, Google Cloud Storage etc). For this, your temporary
storage needs to be your cloud service:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine/storage/s3</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(prefix</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">cache</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options),</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">S3</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(</span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">s3_options)</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span></code></pre></div><p>In this flow, the client needs to first fetch upload parameters from the
server, and then use these parameters for the upload to the cloud service.
The <a href="https://shrinerb.com/docs/plugins/presign_endpoint" target="_blank" rel="noopener noreferrer"><code>presign_endpoint</code></a> Shrine plugin provides a
<a href="https://github.com/shrinerb/shrine/wiki/Mounting-Endpoints" target="_blank" rel="noopener noreferrer">mountable</a> Rack app that generates upload parameters:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:presign_endpoint</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/routes.rb (Rails)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.application.routes.draw </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  mount </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.presign_endpoint(</span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/s3/params</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4"> </span><span style="color:#7B7F8B"># GET /s3/params</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>Then you can configure Uppy&#x27;s <a href="https://uppy.io/docs/aws-s3/" target="_blank" rel="noopener noreferrer">AWS S3</a> plugin to fetch params from
your endpoint before uploading to S3. See <a href="https://github.com/shrinerb/shrine/wiki/Adding-Direct-S3-Uploads" target="_blank" rel="noopener noreferrer">this walkthrough</a> for adding direct uploads to S3 from scratch, it includes a complete
JavaScript example (there is also the <a href="https://github.com/shrinerb/shrine/tree/master/demo" target="_blank" rel="noopener noreferrer">Roda</a> / <a href="https://github.com/erikdahlstrand/shrine-rails-example" target="_blank" rel="noopener noreferrer">Rails</a>
demo). See also the <a href="https://shrinerb.com/docs/direct-s3" target="_blank" rel="noopener noreferrer">Direct Uploads to S3</a> guide for more details.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resumable-direct-upload">Resumable direct upload<a href="#resumable-direct-upload" class="hash-link" aria-label="Direct link to Resumable direct upload" title="Direct link to Resumable direct upload">​</a></h3><p>If your app is accepting large uploads, you can improve resilience by making
the uploads <strong>resumable</strong>. This can significantly improve experience for users
on slow and flaky internet connections.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="uppy-s3-multipart">Uppy S3 Multipart<a href="#uppy-s3-multipart" class="hash-link" aria-label="Direct link to Uppy S3 Multipart" title="Direct link to Uppy S3 Multipart">​</a></h4><p>You can achieve resumable uploads directly to S3 with the <a href="https://uppy.io/docs/aws-s3-multipart/" target="_blank" rel="noopener noreferrer">AWS S3
Multipart</a> Uppy plugin, accompanied with
<code>uppy_s3_multipart</code> Shrine plugin provided by the <a href="https://github.com/janko/uppy-s3_multipart" target="_blank" rel="noopener noreferrer">uppy-s3_multipart</a> gem.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">uppy-s3_multipart</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 0.3</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:uppy_s3_multipart</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/routes.rb (Rails)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.application.routes.draw </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  mount </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.uppy_s3_multipart(</span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/s3/multipart</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>See the <a href="https://github.com/janko/uppy-s3_multipart" target="_blank" rel="noopener noreferrer">uppy-s3_multipart</a> docs for more details.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tus-protocol">Tus protocol<a href="#tus-protocol" class="hash-link" aria-label="Direct link to Tus protocol" title="Direct link to Tus protocol">​</a></h4><p>If you want a more generic approach, you can build your resumable uploads on
<strong><a href="https://tus.io" target="_blank" rel="noopener noreferrer">tus</a></strong> – an open resumable upload protocol. On the server side you can use
the <a href="https://github.com/janko/tus-ruby-server" target="_blank" rel="noopener noreferrer">tus-ruby-server</a> gem, on the client side Uppy&#x27;s <a href="https://uppy.io/docs/tus/" target="_blank" rel="noopener noreferrer">Tus</a> plugin,
and the <a href="https://github.com/shrinerb/shrine-tus" target="_blank" rel="noopener noreferrer">shrine-tus</a> gem for the glue.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># Gemfile</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">tus-server</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 2.0</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4">gem </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine-tus</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">, </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">~&gt; 2.1</span><span style="color:#DEE492">&quot;</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">shrine/storage/tus</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  cache</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Storage</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Tus</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">, </span><span style="color:#7B7F8B"># tus server acts as temporary storage</span></span>
<span class="line"><span style="color:#F6F6F4">  store</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> ...,                      </span><span style="color:#7B7F8B"># your permanent storage</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># config/routes.rb (Rails)</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.application.routes.draw </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F6F6F4">  mount </span><span style="color:#97E1F1;font-style:italic">Tus</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Server</span><span style="color:#F6F6F4"> </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/files</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>See <a href="https://github.com/shrinerb/shrine/wiki/Adding-Resumable-Uploads" target="_blank" rel="noopener noreferrer">this walkthrough</a> for adding tus-powered
resumable uploads from scratch, it includes a complete JavaScript example
(there is also a <a href="https://github.com/shrinerb/shrine-tus-demo" target="_blank" rel="noopener noreferrer">demo app</a>). See also <a href="https://github.com/shrinerb/shrine-tus" target="_blank" rel="noopener noreferrer">shrine-tus</a> and
<a href="https://github.com/janko/tus-ruby-server" target="_blank" rel="noopener noreferrer">tus-ruby-server</a> docs for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backgrounding">Backgrounding<a href="#backgrounding" class="hash-link" aria-label="Direct link to Backgrounding" title="Direct link to Backgrounding">​</a></h2><p>The <a href="https://shrinerb.com/docs/plugins/backgrounding" target="_blank" rel="noopener noreferrer"><code>backgrounding</code></a> plugin allows you to move file promotion
and deletion into a background job, using the backgrounding library <a href="https://github.com/shrinerb/shrine/wiki/Backgrounding-Libraries" target="_blank" rel="noopener noreferrer">of your
choice</a>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:backgrounding</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.promote_block </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">PromoteJob</span><span style="color:#F6F6F4">.perform_async(</span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">.class.name, record.class.name, record.id, name, file_data)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.destroy_block </span><span style="color:#F286C4">do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#97E1F1;font-style:italic">DestroyJob</span><span style="color:#F6F6F4">.perform_async(</span><span style="color:#BF9EEE;font-style:italic">self</span><span style="color:#F6F6F4">.class.name, data)</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">PromoteJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">record_id</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">name</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">file_data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"><span style="color:#F6F6F4">    record         </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(record_class).find(record_id) </span><span style="color:#7B7F8B"># if using Active Record</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.retrieve(model</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> record, name</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> name, file</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> file_data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.atomic_promote</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">rescue</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">AttachmentChanged</span><span style="color:#F6F6F4">, </span><span style="color:#97E1F1;font-style:italic">ActiveRecord</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">RecordNotFound</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#7B7F8B"># attachment has changed or the record has been deleted, nothing to do</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">class</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1">DestroyJob</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">include</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Sidekiq</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">perform</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">attacher_class</span><span style="color:#F6F6F4">, </span><span style="color:#FFB86C;font-style:italic">data</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher_class </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Object</span><span style="color:#F6F6F4">.const_get(attacher_class)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    attacher </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> attacher_class.from_data(data)</span></span>
<span class="line"><span style="color:#F6F6F4">    attacher.destroy</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clearing-cache">Clearing cache<a href="#clearing-cache" class="hash-link" aria-label="Direct link to Clearing cache" title="Direct link to Clearing cache">​</a></h2><p>Shrine doesn&#x27;t automatically delete files uploaded to temporary storage, instead
you should set up a separate recurring task that will automatically delete old
cached files.</p><p>Most Shrine storage classes come with a <code>#clear!</code> method, which you can call in
a recurring script. For FileSystem and S3 storage it would look like this:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># FileSystem storage</span></span>
<span class="line"><span style="color:#F6F6F4">file_system </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages[</span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">file_system.clear! { |path| path.mtime </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Time</span><span style="color:#F6F6F4">.now </span><span style="color:#F286C4">-</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">7</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">24</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span><span style="color:#F6F6F4"> } </span><span style="color:#7B7F8B"># delete files older than 1 week</span></span></code></pre></div><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#7B7F8B"># S3 storage</span></span>
<span class="line"><span style="color:#F6F6F4">s3 </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.storages[</span><span style="color:#BF9EEE">:cache</span><span style="color:#F6F6F4">]</span></span>
<span class="line"><span style="color:#F6F6F4">s3.clear! { |object| object.last_modified </span><span style="color:#F286C4">&lt;</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Time</span><span style="color:#F6F6F4">.now </span><span style="color:#F286C4">-</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">7</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">24</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span><span style="color:#F286C4">*</span><span style="color:#BF9EEE">60</span><span style="color:#F6F6F4"> } </span><span style="color:#7B7F8B"># delete files older than 1 week</span></span></code></pre></div><p>For S3, it may be easier and cheaper to use <a href="http://docs.aws.amazon.com/AmazonS3/latest/UG/lifecycle-configuration-bucket-no-versioning.html" target="_blank" rel="noopener noreferrer">S3 bucket lifecycle expiration rules</a>  instead.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging">​</a></h2><p>The <a href="https://shrinerb.com/docs/plugins/instrumentation" target="_blank" rel="noopener noreferrer"><code>instrumentation</code></a> plugin sends and logs events for
important operations:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.plugin </span><span style="color:#BF9EEE">:instrumentation</span><span style="color:#F6F6F4">, notifications</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ActiveSupport</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">Notifications</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.upload(io, </span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.exists?</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.download</span></span>
<span class="line"><span style="color:#F6F6F4">uploaded_file.delete</span></span></code></pre></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Metadata (32ms) – {:storage=&gt;:store, :io=&gt;StringIO, :uploader=&gt;Shrine}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Upload (1523ms) – {:storage=&gt;:store, :location=&gt;&quot;ed0e30ddec8b97813f2c1f4cfd1700b4&quot;, :io=&gt;StringIO, :upload_options=&gt;{}, :uploader=&gt;Shrine}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Exists (755ms) – {:storage=&gt;:store, :location=&gt;&quot;ed0e30ddec8b97813f2c1f4cfd1700b4&quot;, :uploader=&gt;Shrine}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Download (1002ms) – {:storage=&gt;:store, :location=&gt;&quot;ed0e30ddec8b97813f2c1f4cfd1700b4&quot;, :download_options=&gt;{}, :uploader=&gt;Shrine}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delete (700ms) – {:storage=&gt;:store, :location=&gt;&quot;ed0e30ddec8b97813f2c1f4cfd1700b4&quot;, :uploader=&gt;Shrine}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Some plugins add their own instrumentation as well when they detect that the
<code>instrumentation</code> plugin has been loaded. For that to work, the
<code>instrumentation</code> plugin needs to be loaded <em>before</em> any of these plugins.</p><table><thead><tr><th align="left">Plugin</th><th align="left">Instrumentation</th></tr></thead><tbody><tr><td align="left"><code>derivation_endpoint</code></td><td align="left">instruments file processing</td></tr><tr><td align="left"><code>derivatives</code></td><td align="left">instruments file processing</td></tr><tr><td align="left"><code>determine_mime_type</code></td><td align="left">instruments analyzing MIME type</td></tr><tr><td align="left"><code>store_dimensions</code></td><td align="left">instruments extracting image dimensions</td></tr><tr><td align="left"><code>signature</code></td><td align="left">instruments calculating signature</td></tr><tr><td align="left"><code>infer_extension</code></td><td align="left">instruments inferring extension</td></tr><tr><td align="left"><code>remote_url</code></td><td align="left">instruments remote URL downloading</td></tr><tr><td align="left"><code>data_uri</code></td><td align="left">instruments data URI parsing</td></tr></tbody></table><p>For instrumentation, warnings, and other logging, Shrine uses its internal
logger. You can tell Shrine to use a different logger. For example, if you&#x27;re
using Rails, you might want to tell it to use the Rails logger:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.logger </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Rails</span><span style="color:#F6F6F4">.logger</span></span></code></pre></div><p>In tests you might want to tell Shrine to log only warnings:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.logger.level </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">Logger</span><span style="color:#F286C4">::</span><span style="color:#BF9EEE">WARN</span></span></code></pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shrinerb/shrine/edit/master/doc/../doc/getting_started.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-06-01T23:07:30.000Z">Jun 1, 2023</time></b> by <b>Janko Marohnić</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/advantages"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advantages of Shrine</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The Design of Shrine</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick start</a></li><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#uploader" class="table-of-contents__link toc-highlight">Uploader</a><ul><li><a href="#uploading" class="table-of-contents__link toc-highlight">Uploading</a></li><li><a href="#io-abstraction" class="table-of-contents__link toc-highlight">IO abstraction</a></li></ul></li><li><a href="#uploaded-file" class="table-of-contents__link toc-highlight">Uploaded file</a></li><li><a href="#attaching" class="table-of-contents__link toc-highlight">Attaching</a><ul><li><a href="#attachment-module" class="table-of-contents__link toc-highlight">Attachment module</a></li><li><a href="#attacher" class="table-of-contents__link toc-highlight">Attacher</a></li><li><a href="#temporary-storage" class="table-of-contents__link toc-highlight">Temporary storage</a></li></ul></li><li><a href="#plugin-system" class="table-of-contents__link toc-highlight">Plugin system</a></li><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a><ul><li><a href="#mime-type" class="table-of-contents__link toc-highlight">MIME type</a></li><li><a href="#other-metadata" class="table-of-contents__link toc-highlight">Other metadata</a></li></ul></li><li><a href="#processing" class="table-of-contents__link toc-highlight">Processing</a><ul><li><a href="#eager-processing" class="table-of-contents__link toc-highlight">Eager processing</a></li><li><a href="#on-the-fly-processing" class="table-of-contents__link toc-highlight">On-the-fly processing</a></li></ul></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#location" class="table-of-contents__link toc-highlight">Location</a></li><li><a href="#direct-uploads" class="table-of-contents__link toc-highlight">Direct uploads</a><ul><li><a href="#simple-direct-upload" class="table-of-contents__link toc-highlight">Simple direct upload</a></li><li><a href="#presigned-direct-upload" class="table-of-contents__link toc-highlight">Presigned direct upload</a></li><li><a href="#resumable-direct-upload" class="table-of-contents__link toc-highlight">Resumable direct upload</a></li></ul></li><li><a href="#backgrounding" class="table-of-contents__link toc-highlight">Backgrounding</a></li><li><a href="#clearing-cache" class="table-of-contents__link toc-highlight">Clearing cache</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Janko Marohnić</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b0f70eb.js"></script>
<script src="/assets/js/main.d7cd1c0d.js"></script>
</body>
</html>