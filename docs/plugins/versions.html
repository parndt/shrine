<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-plugins/versions">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Versions | Shrine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://shrinerb.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://shrinerb.com/docs/plugins/versions"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Versions | Shrine"><meta data-rh="true" name="description" content="The versions plugin enables your uploader to deal with versions,"><meta data-rh="true" property="og:description" content="The versions plugin enables your uploader to deal with versions,"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shrinerb.com/docs/plugins/versions"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/plugins/versions" hreflang="en"><link data-rh="true" rel="alternate" href="https://shrinerb.com/docs/plugins/versions" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBFWBJ5DPX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Shrine" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.efb93a3c.css">
<link rel="preload" href="/assets/js/runtime~main.3b0f70eb.js" as="script">
<link rel="preload" href="/assets/js/main.867ecb28.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Shrine logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shrine</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Guides</a><a class="navbar__item navbar__link" href="/docs/plugins/activerecord">Plugins</a><a class="navbar__item navbar__link" href="/docs/external/extensions">External</a><a class="navbar__item navbar__link" href="/docs/release_notes/3.5.0">Release Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shrinerb/shrine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/shrinerb/shrine/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Versions</h1></header><p>The <a href="https://github.com/shrinerb/shrine/blob/master/lib/shrine/plugins/versions.rb" target="_blank" rel="noopener noreferrer"><code>versions</code></a> plugin enables your uploader to deal with versions,
by allowing you to return a Hash of files when processing.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">plugin </span><span style="color:#BF9EEE">:versions</span></span></code></pre></div><p>Here is an example of processing image thumbnails using the <a href="https://github.com/janko/image_processing" target="_blank" rel="noopener noreferrer">image_processing</a>
gem:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">require</span><span style="color:#F6F6F4"> </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">image_processing/mini_magick</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">plugin </span><span style="color:#BF9EEE">:processing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">process(</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options|</span></span>
<span class="line"><span style="color:#F6F6F4">  versions </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> { original</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> io } </span><span style="color:#7B7F8B"># retain original</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  io.download </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |original|</span></span>
<span class="line"><span style="color:#F6F6F4">    pipeline </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(original)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    versions[</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">]  </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> pipeline.resize_to_limit!(</span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">800</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    versions[</span><span style="color:#BF9EEE">:medium</span><span style="color:#F6F6F4">] </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> pipeline.resize_to_limit!(</span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">500</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">    versions[</span><span style="color:#BF9EEE">:small</span><span style="color:#F6F6F4">]  </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> pipeline.resize_to_limit!(</span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">300</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  versions </span><span style="color:#7B7F8B"># return the hash of processed files</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>You probably want to load the <code>delete_raw</code> plugin to automatically delete
processed files after they have been uploaded.</p><p>Now when you access the stored attachment through the model, a hash of uploaded
files will be returned:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">user.avatar_data </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># &#x27;{</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;original&quot;: {&quot;id&quot;:&quot;0gsdf.jpg&quot;, &quot;storage&quot;:&quot;store&quot;, &quot;metadata&quot;:{...}},</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;large&quot;: {&quot;id&quot;:&quot;lg043.jpg&quot;, &quot;storage&quot;:&quot;store&quot;, &quot;metadata&quot;:{...}},</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;medium&quot;: {&quot;id&quot;:&quot;kd9fk.jpg&quot;, &quot;storage&quot;:&quot;store&quot;, &quot;metadata&quot;:{...}},</span></span>
<span class="line"><span style="color:#7B7F8B">#   &quot;small&quot;: {&quot;id&quot;:&quot;932fl.jpg&quot;, &quot;storage&quot;:&quot;store&quot;, &quot;metadata&quot;:{...}}</span></span>
<span class="line"><span style="color:#7B7F8B"># }&#x27;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">user.avatar </span><span style="color:#7B7F8B">#=&gt;</span></span>
<span class="line"><span style="color:#7B7F8B"># {</span></span>
<span class="line"><span style="color:#7B7F8B">#   :original =&gt; #&lt;Shrine::UploadedFile id=0gsdf.jpg&quot; ...}&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   :large    =&gt; #&lt;Shrine::UploadedFile id=lg043.jpg&quot; ...}&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   :medium   =&gt; #&lt;Shrine::UploadedFile id=kd9fk.jpg&quot; ...}&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B">#   :small    =&gt; #&lt;Shrine::UploadedFile id=932fl.jpg&quot; ...}&gt;,</span></span>
<span class="line"><span style="color:#7B7F8B"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">user.avatar[</span><span style="color:#BF9EEE">:medium</span><span style="color:#F6F6F4">]     </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">user.avatar[</span><span style="color:#BF9EEE">:medium</span><span style="color:#F6F6F4">].url </span><span style="color:#7B7F8B">#=&gt; &quot;/uploads/store/lg043.jpg&quot;</span></span></code></pre></div><p>The plugin also extends the <code>Attacher#url</code> to accept versions:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">user.avatar_url(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">user.avatar_url(</span><span style="color:#BF9EEE">:small</span><span style="color:#F6F6F4">, public</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">true</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># with URL options</span></span></code></pre></div><p><code>Shrine.uploaded_file</code> will also instantiate a hash of <code>Shrine::UploadedFile</code>
objects if given data with versions. If you want to apply a change to all files
in an attachment, regardless of whether it consists of a single file or a hash
of versions, you can pass a block to <code>Shrine.uploaded_file</code> and it will yield
each file:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#97E1F1;font-style:italic">Shrine</span><span style="color:#F6F6F4">.uploaded_file(attachment_data) </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |uploaded_file|</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># ...</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fallbacks">Fallbacks<a href="#fallbacks" class="hash-link" aria-label="Direct link to Fallbacks" title="Direct link to Fallbacks">​</a></h2><p>If versions are processed in a background job, there will be a period where the
user will browse the site before versions have finished processing. In this
period <code>Attacher#url</code> will by default fall back to the original file.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">user.avatar </span><span style="color:#7B7F8B">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></span>
<span class="line"><span style="color:#F6F6F4">user.avatar_url(</span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># falls back to `user.avatar_url`</span></span></code></pre></div><p>This behaviour is convenient if you want to gracefully degrade to the cached
file until the background job has finished processing. However, if you would
rather provide your own default URLs for versions, you can disable this
fallback:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">plugin </span><span style="color:#BF9EEE">:versions</span><span style="color:#F6F6F4">, fallback_to_original</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">false</span></span></code></pre></div><p>If you already have some versions processed in the foreground after a
background job is kicked off (with the <code>recache</code> plugin), you can have URLs for
versions that are yet to be processed fall back to existing versions:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">plugin </span><span style="color:#BF9EEE">:versions</span><span style="color:#F6F6F4">, fallbacks</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">thumb_2x </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:thumb</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">:</span><span style="color:#F6F6F4">large_2x </span><span style="color:#F286C4">=&gt;</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">:large</span><span style="color:#F6F6F4">,</span></span>
<span class="line"><span style="color:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B"># ... (background job is kicked off)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">user.avatar_url(</span><span style="color:#BF9EEE">:thumb_2x</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># returns :thumb URL until :thumb_2x becomes available</span></span>
<span class="line"><span style="color:#F6F6F4">user.avatar_url(</span><span style="color:#BF9EEE">:large_2x</span><span style="color:#F6F6F4">) </span><span style="color:#7B7F8B"># returns :large URL until :large_2x becomes available</span></span></code></pre></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="arrays">Arrays<a href="#arrays" class="hash-link" aria-label="Direct link to Arrays" title="Direct link to Arrays">​</a></h2><p>In addition to Hashes, the plugin also supports Arrays of files. For example,
you might want to split a PDf into pages:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">process(</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options|</span></span>
<span class="line"><span style="color:#F6F6F4">  versions </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> { pages</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> [] }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  io.download </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |pdf|</span></span>
<span class="line"><span style="color:#F6F6F4">    page_count </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">Image</span><span style="color:#F6F6F4">.</span><span style="color:#F286C4">new</span><span style="color:#F6F6F4">(pdf.path).pages.count</span></span>
<span class="line"><span style="color:#F6F6F4">    pipeline   </span><span style="color:#F286C4">=</span><span style="color:#F6F6F4"> </span><span style="color:#97E1F1;font-style:italic">ImageProcessing</span><span style="color:#F286C4">::</span><span style="color:#97E1F1;font-style:italic">MiniMagick</span><span style="color:#F6F6F4">.source(pdf).convert(</span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">jpg</span><span style="color:#DEE492">&quot;</span><span style="color:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">    page_count.times </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |page_number|</span></span>
<span class="line"><span style="color:#F6F6F4">      versions[</span><span style="color:#BF9EEE">:pages</span><span style="color:#F6F6F4">] </span><span style="color:#F286C4">&lt;&lt;</span><span style="color:#F6F6F4"> pipeline.loader(page</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> page_number).call</span></span>
<span class="line"><span style="color:#F6F6F4">    </span><span style="color:#F286C4">end</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4">  versions</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>You can also combine Hashes and Arrays, there is no limit to the level of
nesting.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="original-file">Original file<a href="#original-file" class="hash-link" aria-label="Direct link to Original file" title="Direct link to Original file">​</a></h2><p>It&#x27;s recommended to always keep the original file after processing versions,
which you can do by adding the yielded <code>Shrine::UploadedFile</code> object as one of
the versions, by convention named <code>:original</code>:</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F6F6F4">process(</span><span style="color:#BF9EEE">:store</span><span style="color:#F6F6F4">) </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |io, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">options|</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#7B7F8B"># processing thumbnail</span></span>
<span class="line"><span style="color:#F6F6F4">  { original</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> io, thumbnail</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> thumbnail }</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div><p>If both temporary and permanent storage are Amazon S3, the cached original will
simply be copied over to permanent storage (without any downloading and
reuploading), so in these cases the performance impact of storing the original
file in addition to processed versions is neglibible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>The version name will be available via <code>:version</code> when generating location or a
default URL.</p><div data-rehype-pretty-code-fragment=""><pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="line"><span style="color:#F286C4">def</span><span style="color:#F6F6F4"> </span><span style="color:#62E884">generate_location</span><span style="color:#F6F6F4">(</span><span style="color:#FFB86C;font-style:italic">io</span><span style="color:#F6F6F4">, </span><span style="color:#BF9EEE">version</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">)</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">uploads/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">version</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">-</span><span style="color:#F286C4">#{super}</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#97E1F1;font-style:italic">Attacher</span><span style="color:#F6F6F4">.default_url </span><span style="color:#F286C4">do</span><span style="color:#F6F6F4"> |version</span><span style="color:#F286C4">:</span><span style="color:#F6F6F4"> </span><span style="color:#BF9EEE">nil</span><span style="color:#F6F6F4">, </span><span style="color:#F286C4">**</span><span style="color:#F6F6F4">|</span></span>
<span class="line"><span style="color:#F6F6F4">  </span><span style="color:#DEE492">&quot;</span><span style="color:#E7EE98">/images/defaults/</span><span style="color:#F286C4">#{</span><span style="color:#E7EE98">version</span><span style="color:#F286C4">}</span><span style="color:#E7EE98">.jpg</span><span style="color:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#F286C4">end</span></span></code></pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/shrinerb/shrine/edit/master/doc/../doc/plugins/versions.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2020-01-15T15:32:30.000Z">Jan 15, 2020</time></b> by <b>Janko Marohnić</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#fallbacks" class="table-of-contents__link toc-highlight">Fallbacks</a></li><li><a href="#arrays" class="table-of-contents__link toc-highlight">Arrays</a></li><li><a href="#original-file" class="table-of-contents__link toc-highlight">Original file</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Janko Marohnić</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b0f70eb.js"></script>
<script src="/assets/js/main.867ecb28.js"></script>
</body>
</html>