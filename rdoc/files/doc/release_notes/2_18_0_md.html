<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>2.18.0.md</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>2.18.0.md
</h1>
<div class='paths'>
doc/release_notes/2.18.0.md
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2023-07-07 09:26:16 +0200</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>—</p>

<h2 id="label-title-3A+Shrine+2.18.0">title: <a href="../../../classes/Shrine.html"><code>Shrine</code></a> <a href="2_18_0_md.html">2.18.0</a><span><a href="#label-title-3A+Shrine+2.18.0">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h2 id="label-New+features">New features<span><a href="#label-New+features">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>Added <code>Shrine.upload_response</code> to <code>upload_endpoint</code> plugin for handling  uploads inside a custom controller. This allows authenticating uploads on the  controller level:</p>
</li></ul>

<p><code>rb   # config/routes.rb (Rails)   Rails.application.routes.draw do     # ...     post &quot;/images/upload&quot; =&gt; &quot;uploads#image&quot;   end </code>  “‘rb  # app/controllers/uploads_controller.rb (Rails)  class UploadsController &lt; ApplicationController  def image  authenticate_user!</p>

<pre>  set_rack_response ImageUploader.upload_response(:cache, request.env)
end

private

def set_rack_response((status, headers, body))
  self.status = status
  self.headers.merge!(headers)
  self.response_body = body
end</pre>

<p>end  “‘</p>
<ul><li>
<p>Added <code>Shrine.presign_response</code> to <code>presign_endpoint</code> plugin for handling  uploads inside a custom controller. This allows authenticating uploads on the  controller level:</p>
</li></ul>

<p><code>rb   # config/routes.rb (Rails)   Rails.application.routes.draw do     # ...     post &quot;/images/presign&quot;, to: &quot;presigns#image&quot;   end </code>  “‘rb  # app/controllers/presigns_controller.rb (Rails)  class PresignsController &lt; ApplicationController  def image  authenticate_user!</p>

<pre>  set_rack_response ImageUploader.presign_response(:cache, request.env)
end

private

def set_rack_response((status, headers, body))
  self.status = status
  self.headers.merge!(headers)
  self.response_body = body
end</pre>

<p>end  “‘</p>
<ul><li>
<p>The <code>:url</code> option has been added to the <code>upload_endpoint</code> plugin for  returning the uploaded file URL in the response.</p>
</li></ul>

<p><code>rb   plugin :upload_endpoint, url: true   # or   plugin :upload_endpoint, url: { public: true }   # or   plugin :upload_endpoint, url: -&gt; (uploaded_file, request) {     uploaded_file.url(**options)   } </code>  <code>rb   {     &quot;data&quot;: { &quot;id&quot;: &quot;...&quot;, &quot;storage&quot;: &quot;...&quot;, &quot;metadata&quot;: {...} },     &quot;url&quot;: &quot;https://example.com/path/to/file&quot;   } </code></p>

<p>This will additionally be recognized by Uppy, so e.g. the Dashboard plugin  will display preview link to the file.</p>

<p><code>js   uppy.on(&#39;upload-success&#39;, (file, response) =&gt; {     response.uploadURL // =&gt; &quot;https://example.com/path/to/file&quot;   }) </code></p>

<h2 id="label-Other+improvements">Other improvements<span><a href="#label-Other+improvements">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>The <code>upload_endpoint</code> now accepts the <code>files[]</code> array that Uppy’s XHR Upload  plugin sends by default. This means the <code>fieldName</code> parameter can now be  omitted.</p>
</li></ul>

<p>“‘js  // BEFORE  uppy.use(Uppy.XHRUpload, {  endpoint: ’/upload’,  fieldName: ‘file’,  })</p>

<p>// AFTER  uppy.use(Uppy.XHRUpload, {  endpoint: ‘/upload’,  })  “‘</p>
<ul><li>
<p>The <code>Shrine.upload</code> convenience method has been added, which is a bit shorter  when you don’t need the uploader instance.</p>
</li></ul>

<p>“‘rb  <a href="../../../classes/Shrine/InstanceMethods.html#method-i-upload"><code>Shrine.upload</code></a>(io, :storage)</p>

<p># expands to</p>

<p>uploader = <a href="../../../classes/Shrine/InstanceMethods.html#method-c-new"><code>Shrine.new</code></a>(:storage)  uploader.upload(io)  “‘</p>
<ul><li>
<p>The <code>Shrine.Attachment(...)</code> shorthand for <code>Shrine::Attachment.new(...)</code> has  been added.</p>
</li></ul>

<p><code>rb   class Photo     include Shrine::Attachment(:image) # expands to Shrine::Attachment.new(:image)   end </code></p>
<ul><li>
<p>The <code>parsed_json</code> and <code>rack_file</code> plugins now correctly retain the second  argument in the <code>Attacher#assign</code> method signature.</p>
</li></ul>

<h2 id="label-Backwards+compatibility">Backwards compatibility<span><a href="#label-Backwards+compatibility">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>The <code>aws-sdk-s3</code> version lower than <code>1.14.0</code> has been deprecated for  <code>Shrine::Storage::S3</code> and will be removed in <a href="../../../classes/Shrine.html"><code>Shrine</code></a> 3.</p>
</li><li>
<p>The <code>:download</code> option in <code>Shrine::Storage::S3#url</code> has been deprecated and  will be removed in <a href="../../../classes/Shrine.html"><code>Shrine</code></a> 3. The <code>:response_content_disposition</code> option  should be used instead.</p>
</li></ul>

<p>“‘rb  # This is deprecated:  uploaded_file.url(download: true)</p>

<p># Use this:  uploaded_file.url(response_content_disposition: “attachment”)  “‘</p>
<ul><li>
<p><code>Shrine::Storage::S3#upload</code> doesn’t backfill the <code>size</code> metadata value for  input IOs with unknown size (e.g. pipes, sockets). This behaviour was not  documented and added unnecessary complexity. Moreover, this functionality  should be storage agnostic, so if someone requests it we can add it back in  form of a plugin.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
