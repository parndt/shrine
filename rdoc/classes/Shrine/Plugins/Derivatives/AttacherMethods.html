<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Shrine::Plugins::Derivatives::AttacherMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Shrine::Plugins::Derivatives::AttacherMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/shrine/plugins/derivatives_rb.html">lib/shrine/plugins/derivatives.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-add_derivative">add_derivative</a></li>
<li><a href="#method-i-add_derivatives">add_derivatives</a></li>
<li><a href="#method-i-change">change</a></li>
<li><a href="#method-i-create_derivatives">create_derivatives</a></li>
<li><a href="#method-i-data">data</a></li>
<li><a href="#method-i-delete_derivatives">delete_derivatives</a></li>
<li><a href="#attribute-i-derivatives">derivatives</a></li>
<li><a href="#method-i-derivatives-3D">derivatives=</a></li>
<li><a href="#method-i-destroy">destroy</a></li>
<li><a href="#method-i-get">get</a></li>
<li><a href="#method-i-get_derivatives">get_derivatives</a></li>
<li><a href="#method-i-load_data">load_data</a></li>
<li><a href="#method-i-map_derivative">map_derivative</a></li>
<li><a href="#method-i-merge_derivatives">merge_derivatives</a></li>
<li><a href="#method-i-process_derivatives">process_derivatives</a></li>
<li><a href="#method-i-promote">promote</a></li>
<li><a href="#method-i-promote_derivatives">promote_derivatives</a></li>
<li><a href="#method-i-remove_derivative">remove_derivative</a></li>
<li><a href="#method-i-remove_derivatives">remove_derivatives</a></li>
<li><a href="#method-i-set_derivatives">set_derivatives</a></li>
<li><a href="#method-i-upload_derivative">upload_derivative</a></li>
<li><a href="#method-i-upload_derivatives">upload_derivatives</a></li>
<li><a href="#method-i-url">url</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-derivatives'>derivatives</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span><span class='arguments'>(derivatives: {}, **options)</span>

</div>
<div class='description'>

<p>Adds the ability to accept derivatives.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">108</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-value">derivatives:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">109</span>   <span class="ruby-keyword">super</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">110</span> 
<span class="line-num">111</span>   <span class="ruby-ivar">@derivatives</span>       = <span class="ruby-identifier">derivatives</span>
<span class="line-num">112</span>   <span class="ruby-ivar">@derivatives_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">derivatives_options</span>[<span class="ruby-value">:mutex</span>]
<span class="line-num">113</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-add_derivative'>
<a name='method-i-add_derivative'></a>
<div class='synopsis'>
<span class='name'>add_derivative</span><span class='arguments'>(name, file, **options)</span>

</div>
<div class='description'>

<p>Uploads a given file and adds it to the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>
<span class="ruby-comment"># {</span>
<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment"># }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivative</span>(<span class="ruby-value">:cropped</span>, <span class="ruby-identifier">cropped</span>)
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>
<span class="ruby-comment"># {</span>
<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment">#   cropped: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment"># }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">235</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_derivative</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">236</span>   <span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-identifier">name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">file</span> }, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">237</span>   <span class="ruby-identifier">derivatives</span>[<span class="ruby-identifier">name</span>]
<span class="line-num">238</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-add_derivatives'>
<a name='method-i-add_derivatives'></a>
<div class='synopsis'>
<span class='name'>add_derivatives</span><span class='arguments'>(files, **options)</span>

</div>
<div class='description'>

<p>Uploads given hash of files and adds uploaded files to the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>
<span class="ruby-comment"># {</span>
<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment"># }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-value">cropped:</span> <span class="ruby-identifier">cropped</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>
<span class="ruby-comment"># {</span>
<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment">#   cropped: #&lt;Shrine::UploadedFile&gt;,</span>
<span class="ruby-comment"># }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">217</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">218</span>   <span class="ruby-identifier">new_derivatives</span> = <span class="ruby-identifier">upload_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">219</span>   <span class="ruby-identifier">merge_derivatives</span>(<span class="ruby-identifier">new_derivatives</span>)
<span class="line-num">220</span>   <span class="ruby-identifier">new_derivatives</span>
<span class="line-num">221</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-change'>
<a name='method-i-change'></a>
<div class='synopsis'>
<span class='name'>change</span><span class='arguments'>(*)</span>

</div>
<div class='description'>

<p>Clears derivatives when attachment changes.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">change</span>(<span class="ruby-identifier">file</span>)
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; {}</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-change-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-change-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">462</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">change</span>(<span class="ruby-operator">*</span>)
<span class="line-num">463</span>   <span class="ruby-identifier">result</span> = <span class="ruby-keyword">super</span>
<span class="line-num">464</span>   <span class="ruby-identifier">set_derivatives</span>({})
<span class="line-num">465</span>   <span class="ruby-identifier">result</span>
<span class="line-num">466</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_derivatives'>
<a name='method-i-create_derivatives'></a>
<div class='synopsis'>
<span class='name'>create_derivatives</span><span class='arguments'>(*args, storage: nil, **options)</span>

</div>
<div class='description'>

<p>Calls processor and adds returned derivatives.</p>

<pre class="ruby"><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">derivatives_processor</span> <span class="ruby-value">:my_processor</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">create_derivatives</span>(<span class="ruby-value">:my_processor</span>)
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">199</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-value">storage:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">200</span>   <span class="ruby-identifier">files</span> = <span class="ruby-identifier">process_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">201</span>   <span class="ruby-identifier">add_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-value">storage:</span> <span class="ruby-identifier">storage</span>)
<span class="line-num">202</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-data'>
<a name='method-i-data'></a>
<div class='synopsis'>
<span class='name'>data</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>Adds derivative data into the hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">attach</span>(<span class="ruby-identifier">io</span>)
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">data</span>
<span class="ruby-comment">#=&gt;</span>
<span class="ruby-comment"># {</span>
<span class="ruby-comment">#   &quot;id&quot; =&gt; &quot;...&quot;,</span>
<span class="ruby-comment">#   &quot;storage&quot; =&gt; &quot;store&quot;,</span>
<span class="ruby-comment">#   &quot;metadata&quot; =&gt; { ... },</span>
<span class="ruby-comment">#   &quot;derivatives&quot; =&gt; {</span>
<span class="ruby-comment">#     &quot;thumb&quot; =&gt; {</span>
<span class="ruby-comment">#       &quot;id&quot; =&gt; &quot;...&quot;,</span>
<span class="ruby-comment">#       &quot;storage&quot; =&gt; &quot;store&quot;,</span>
<span class="ruby-comment">#       &quot;metadata&quot; =&gt; { ... },</span>
<span class="ruby-comment">#     }</span>
<span class="ruby-comment">#   }</span>
<span class="ruby-comment"># }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-data-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-data-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">416</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">data</span>
<span class="line-num">417</span>   <span class="ruby-identifier">result</span> = <span class="ruby-keyword">super</span>
<span class="line-num">418</span> 
<span class="line-num">419</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">any?</span>
<span class="line-num">420</span>     <span class="ruby-identifier">result</span> <span class="ruby-operator">||=</span> {}
<span class="line-num">421</span>     <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;derivatives&quot;</span>] = <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-value">transform_keys:</span> <span class="ruby-value">:to_s</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span>
<span class="line-num">422</span>       <span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">data</span>
<span class="line-num">423</span>     <span class="ruby-keyword">end</span>
<span class="line-num">424</span>   <span class="ruby-keyword">end</span>
<span class="line-num">425</span> 
<span class="line-num">426</span>   <span class="ruby-identifier">result</span>
<span class="line-num">427</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-delete_derivatives'>
<a name='method-i-delete_derivatives'></a>
<div class='synopsis'>
<span class='name'>delete_derivatives</span><span class='arguments'>(derivatives = self.derivatives)</span>

</div>
<div class='description'>

<p>Deletes given hash of uploaded files.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">delete_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">uploaded_file</span> })
<span class="ruby-identifier">uploaded_file</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-delete_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-delete_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">384</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_derivatives</span>(<span class="ruby-identifier">derivatives</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">derivatives</span>)
<span class="line-num">385</span>   <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span> <span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">delete</span> }
<span class="line-num">386</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-derivatives-3D'>
<a name='method-i-derivatives-3D'></a>
<div class='synopsis'>
<span class='name'>derivatives=</span><span class='arguments'>(derivatives)</span>

</div>
<div class='description'>

<p>Sets a hash of derivatives.</p>

<pre>attacher.derivatives = { thumb: Shrine.uploaded_file(...) }
attacher.derivatives #=&gt; { thumb: #&lt;Shrine::UploadedFile ...&gt; }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-derivatives-3D-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-derivatives-3D-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">472</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">derivatives=</span>(<span class="ruby-identifier">derivatives</span>)
<span class="line-num">473</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
<span class="line-num">474</span>     <span class="ruby-identifier">fail</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;expected derivatives to be a Hash, got #{derivatives.inspect}&quot;</span>
<span class="line-num">475</span>   <span class="ruby-keyword">end</span>
<span class="line-num">476</span> 
<span class="line-num">477</span>   <span class="ruby-ivar">@derivatives</span> = <span class="ruby-identifier">derivatives</span>
<span class="line-num">478</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-destroy'>
<a name='method-i-destroy'></a>
<div class='synopsis'>
<span class='name'>destroy</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>In addition to deleting the main file it also deletes any derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>].<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; true</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">destroy</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>].<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-destroy-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-destroy-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">187</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy</span>
<span class="line-num">188</span>   <span class="ruby-keyword">super</span>
<span class="line-num">189</span>   <span class="ruby-identifier">delete_derivatives</span>
<span class="line-num">190</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-get'>
<a name='method-i-get'></a>
<div class='synopsis'>
<span class='name'>get</span><span class='arguments'>(*path)</span>

</div>
<div class='description'>

<p>Convenience method for accessing derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span>
<span class="ruby-comment"># can be shortened to</span>
<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-get-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-get-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">120</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
<span class="line-num">121</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">122</span> 
<span class="line-num">123</span>   <span class="ruby-identifier">get_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
<span class="line-num">124</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-get_derivatives'>
<a name='method-i-get_derivatives'></a>
<div class='synopsis'>
<span class='name'>get_derivatives</span><span class='arguments'>(*path)</span>

</div>
<div class='description'>

<p>Convenience method for accessing derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-value">:thumbnails</span>, <span class="ruby-value">:large</span>)
<span class="ruby-comment"># can be shortened to</span>
<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>(<span class="ruby-value">:thumbnails</span>, <span class="ruby-value">:large</span>)
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-get_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-get_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">131</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
<span class="line-num">132</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">derivatives</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">133</span> 
<span class="line-num">134</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">135</span> 
<span class="line-num">136</span>   <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
<span class="line-num">137</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-load_data'>
<a name='method-i-load_data'></a>
<div class='synopsis'>
<span class='name'>load_data</span><span class='arguments'>(data)</span>

</div>
<div class='description'>

<p>Loads derivatives from data generated by <code>Attacher#data</code>.</p>

<pre>attacher.load_data({
  &quot;id&quot; =&gt; &quot;...&quot;,
  &quot;storage&quot; =&gt; &quot;store&quot;,
  &quot;metadata&quot; =&gt; { ... },
  &quot;derivatives&quot; =&gt; {
    &quot;thumb&quot; =&gt; {
      &quot;id&quot; =&gt; &quot;...&quot;,
      &quot;storage&quot; =&gt; &quot;store&quot;,
      &quot;metadata&quot; =&gt; { ... },
    }
  }
})
attacher.file        #=&gt; #&lt;Shrine::UploadedFile&gt;
attacher.derivatives #=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-load_data-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-load_data-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">445</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_data</span>(<span class="ruby-identifier">data</span>)
<span class="line-num">446</span>   <span class="ruby-identifier">data</span> <span class="ruby-operator">||=</span> {}
<span class="line-num">447</span>   <span class="ruby-identifier">data</span>   = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>
<span class="line-num">448</span> 
<span class="line-num">449</span>   <span class="ruby-identifier">derivatives_data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;derivatives&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:derivatives</span>) <span class="ruby-operator">||</span> {}
<span class="line-num">450</span>   <span class="ruby-ivar">@derivatives</span>     = <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">derivatives</span>(<span class="ruby-identifier">derivatives_data</span>)
<span class="line-num">451</span> 
<span class="line-num">452</span>   <span class="ruby-identifier">data</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">453</span> 
<span class="line-num">454</span>   <span class="ruby-keyword">super</span>(<span class="ruby-identifier">data</span>)
<span class="line-num">455</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-map_derivative'>
<a name='method-i-map_derivative'></a>
<div class='synopsis'>
<span class='name'>map_derivative</span><span class='arguments'>(derivatives, **options, &block)</span>

</div>
<div class='description'>

<p>Iterates through nested derivatives and maps results.</p>

<pre>attacher.map_derivative(derivatives) { |path, file| ... }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-map_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-map_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">483</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">map_derivative</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">484</span>   <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">485</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-merge_derivatives'>
<a name='method-i-merge_derivatives'></a>
<div class='synopsis'>
<span class='name'>merge_derivatives</span><span class='arguments'>(new_derivatives)</span>

</div>
<div class='description'>

<p>Deep merges given uploaded derivatives with current derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt; }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">merge_derivatives</span>({ <span class="ruby-value">two:</span> <span class="ruby-identifier">uploaded_file</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-merge_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-merge_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">303</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_derivatives</span>(<span class="ruby-identifier">new_derivatives</span>)
<span class="line-num">304</span>   <span class="ruby-identifier">derivatives_synchronize</span> <span class="ruby-keyword">do</span>
<span class="line-num">305</span>     <span class="ruby-identifier">merged_derivatives</span> = <span class="ruby-identifier">deep_merge_derivatives</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-identifier">new_derivatives</span>)
<span class="line-num">306</span>     <span class="ruby-identifier">set_derivatives</span>(<span class="ruby-identifier">merged_derivatives</span>)
<span class="line-num">307</span>   <span class="ruby-keyword">end</span>
<span class="line-num">308</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-process_derivatives'>
<a name='method-i-process_derivatives'></a>
<div class='synopsis'>
<span class='name'>process_derivatives</span><span class='arguments'>(processor_name = :default, source = nil, **options)</span>

</div>
<div class='description'>

<p>Downloads the attached file and calls the specified processor.</p>

<pre class="ruby"><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">derivatives_processor</span> <span class="ruby-value">:thumbnails</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">processor</span> = <span class="ruby-constant">ImageProcessing</span><span class="ruby-operator">::</span><span class="ruby-constant">MiniMagick</span>.<span class="ruby-identifier">source</span>(<span class="ruby-identifier">original</span>)

  {
    <span class="ruby-value">small:</span>  <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">300</span>, <span class="ruby-value">300</span>),
    <span class="ruby-value">medium:</span> <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">500</span>, <span class="ruby-value">500</span>),
    <span class="ruby-value">large:</span>  <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">800</span>, <span class="ruby-value">800</span>),
  }
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">process_derivatives</span>(<span class="ruby-value">:thumbnails</span>)
<span class="ruby-comment">#=&gt; { small: #&lt;File:...&gt;, medium: #&lt;File:...&gt;, large: #&lt;File:...&gt; }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-process_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-process_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">278</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_derivatives</span>(<span class="ruby-identifier">processor_name</span> = <span class="ruby-value">:default</span>, <span class="ruby-identifier">source</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">279</span>   <span class="ruby-comment"># handle receiving only source file without a processor</span>
<span class="line-num">280</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">processor_name</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_sym</span>)
<span class="line-num">281</span>     <span class="ruby-identifier">source</span>         = <span class="ruby-identifier">processor_name</span>
<span class="line-num">282</span>     <span class="ruby-identifier">processor_name</span> = <span class="ruby-value">:default</span>
<span class="line-num">283</span>   <span class="ruby-keyword">end</span>
<span class="line-num">284</span> 
<span class="line-num">285</span>   <span class="ruby-identifier">source</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">file!</span>
<span class="line-num">286</span> 
<span class="line-num">287</span>   <span class="ruby-identifier">processor_settings</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">derivatives_processor_settings</span>(<span class="ruby-identifier">processor_name</span>) <span class="ruby-operator">||</span> {}
<span class="line-num">288</span> 
<span class="line-num">289</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">processor_settings</span>[<span class="ruby-value">:download</span>]
<span class="line-num">290</span>     <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">with_file</span>(<span class="ruby-identifier">source</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
<span class="line-num">291</span>       <span class="ruby-identifier">_process_derivatives</span>(<span class="ruby-identifier">processor_name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">292</span>     <span class="ruby-keyword">end</span>
<span class="line-num">293</span>   <span class="ruby-keyword">else</span>
<span class="line-num">294</span>     <span class="ruby-identifier">_process_derivatives</span>(<span class="ruby-identifier">processor_name</span>, <span class="ruby-identifier">source</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">295</span>   <span class="ruby-keyword">end</span>
<span class="line-num">296</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-promote'>
<a name='method-i-promote'></a>
<div class='synopsis'>
<span class='name'>promote</span><span class='arguments'>(**options)</span>

</div>
<div class='description'>

<p>In addition to promoting the main file, also promotes any cached derivatives. This is useful when these derivatives are being created as part of a direct upload.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">assign</span>(<span class="ruby-identifier">io</span>)
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivative</span>(<span class="ruby-value">:thumb</span>, <span class="ruby-identifier">file</span>, <span class="ruby-value">storage:</span> <span class="ruby-value">:cache</span>)
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">promote</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">stored?</span>(<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>]) <span class="ruby-comment">#=&gt; true</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-promote-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-promote-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">162</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">promote</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">163</span>   <span class="ruby-keyword">super</span>
<span class="line-num">164</span>   <span class="ruby-identifier">promote_derivatives</span>
<span class="line-num">165</span>   <span class="ruby-identifier">create_derivatives</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_derivatives_on_promote?</span>
<span class="line-num">166</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-promote_derivatives'>
<a name='method-i-promote_derivatives'></a>
<div class='synopsis'>
<span class='name'>promote_derivatives</span><span class='arguments'>(**options)</span>

</div>
<div class='description'>

<p>Uploads any cached derivatives to permanent storage.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-promote_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-promote_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">169</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">promote_derivatives</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">170</span>   <span class="ruby-identifier">stored_derivatives</span> = <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span>
<span class="line-num">171</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">cached?</span>(<span class="ruby-identifier">derivative</span>)
<span class="line-num">172</span>       <span class="ruby-identifier">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">derivative</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">173</span>     <span class="ruby-keyword">else</span>
<span class="line-num">174</span>       <span class="ruby-identifier">derivative</span>
<span class="line-num">175</span>     <span class="ruby-keyword">end</span>
<span class="line-num">176</span>   <span class="ruby-keyword">end</span>
<span class="line-num">177</span> 
<span class="line-num">178</span>   <span class="ruby-identifier">set_derivatives</span>(<span class="ruby-identifier">stored_derivatives</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">derivatives</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stored_derivatives</span>
<span class="line-num">179</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-remove_derivative'>
<a name='method-i-remove_derivative'></a>
<div class='synopsis'>
<span class='name'>remove_derivative</span><span class='arguments'>(path, **options)</span>

</div>
<div class='description'>

<p>Removes derivative with specified name from the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivative</span>(<span class="ruby-value">:one</span>) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt; (removed derivative)</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { two: #&lt;Shrine::UploadedFile&gt; }</span>
</pre>

<p>Nested derivatives are also supported:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; } }</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivative</span>([<span class="ruby-value">:nested</span>, <span class="ruby-value">:one</span>]) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt; (removed derivative)</span>
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt; } }</span>
</pre>

<p>The :delete option can be passed for deleting removed derivative:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span>
<span class="ruby-identifier">derivative</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>)
<span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-remove_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-remove_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">376</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">377</span>   <span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>).<span class="ruby-identifier">first</span>
<span class="line-num">378</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-remove_derivatives'>
<a name='method-i-remove_derivatives'></a>
<div class='synopsis'>
<span class='name'>remove_derivatives</span><span class='arguments'>(*paths, delete: false)</span>

</div>
<div class='description'>

<p>Removes derivatives with specified name from the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>
<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; }</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">:three</span>)
<span class="ruby-comment">#=&gt; [#&lt;Shrine::UploadedFile&gt;, #&lt;Shrine::UploadedFile&gt;] (removed derivatives)</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>
<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt; }</span>
</pre>

<p>Nested derivatives are also supported:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>
<span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; } }</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>([<span class="ruby-value">:nested</span>, <span class="ruby-value">:two</span>], [<span class="ruby-value">:nested</span>, <span class="ruby-value">:three</span>])
<span class="ruby-comment">#=&gt; [#&lt;Shrine::UploadedFile&gt;, #&lt;Shrine::UploadedFile&gt;] (removed derivatives)</span>

<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>
<span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt; } }</span>
</pre>

<p>The :delete option can be passed for deleting removed derivatives:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>
<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; }</span>

<span class="ruby-identifier">two</span>, <span class="ruby-identifier">three</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">:three</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>)

<span class="ruby-identifier">two</span>.<span class="ruby-identifier">exists?</span>   <span class="ruby-comment">#=&gt; false</span>
<span class="ruby-identifier">three</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-remove_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-remove_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">341</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">paths</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">false</span>)
<span class="line-num">342</span>   <span class="ruby-identifier">removed_derivatives</span> = <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
<span class="line-num">343</span>     <span class="ruby-identifier">path</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">344</span> 
<span class="line-num">345</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">one?</span>
<span class="line-num">346</span>       <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">first</span>)
<span class="line-num">347</span>     <span class="ruby-keyword">else</span>
<span class="line-num">348</span>       <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]).<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>[<span class="ruby-value">-1</span>])
<span class="line-num">349</span>     <span class="ruby-keyword">end</span>
<span class="line-num">350</span>   <span class="ruby-keyword">end</span>
<span class="line-num">351</span> 
<span class="line-num">352</span>   <span class="ruby-identifier">set_derivatives</span> <span class="ruby-identifier">derivatives</span>
<span class="line-num">353</span> 
<span class="line-num">354</span>   <span class="ruby-identifier">delete_derivatives</span>(<span class="ruby-identifier">removed_derivatives</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">delete</span>
<span class="line-num">355</span> 
<span class="line-num">356</span>   <span class="ruby-identifier">removed_derivatives</span>
<span class="line-num">357</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-set_derivatives'>
<a name='method-i-set_derivatives'></a>
<div class='synopsis'>
<span class='name'>set_derivatives</span><span class='arguments'>(derivatives)</span>

</div>
<div class='description'>

<p>Sets the given hash of uploaded files as derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">set_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">uploaded_file</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-set_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-set_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">392</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_derivatives</span>(<span class="ruby-identifier">derivatives</span>)
<span class="line-num">393</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">derivatives</span> = <span class="ruby-identifier">derivatives</span>
<span class="line-num">394</span>   <span class="ruby-identifier">set</span> <span class="ruby-identifier">file</span> <span class="ruby-comment"># trigger model write</span>
<span class="line-num">395</span>   <span class="ruby-identifier">derivatives</span>
<span class="line-num">396</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-upload_derivative'>
<a name='method-i-upload_derivative'></a>
<div class='synopsis'>
<span class='name'>upload_derivative</span><span class='arguments'>(path, file, storage: nil, **options)</span>

</div>
<div class='description'>

<p>Uploads the given file and deletes it afterwards.</p>

<pre class="ruby"><span class="ruby-identifier">hash</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">upload_derivative</span>(<span class="ruby-value">:thumb</span>, <span class="ruby-identifier">thumb</span>)
<span class="ruby-identifier">hash</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-upload_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-upload_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">254</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span>, <span class="ruby-value">storage:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">255</span>   <span class="ruby-identifier">path</span>      = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">256</span>   <span class="ruby-identifier">storage</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">derivative_storage</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">257</span> 
<span class="line-num">258</span>   <span class="ruby-identifier">file</span>.<span class="ruby-identifier">open</span>    <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Tempfile</span>)       <span class="ruby-comment"># refresh file descriptor</span>
<span class="line-num">259</span>   <span class="ruby-identifier">file</span>.<span class="ruby-identifier">binmode</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:binmode</span>) <span class="ruby-comment"># ensure binary mode</span>
<span class="line-num">260</span> 
<span class="line-num">261</span>   <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">storage</span>, <span class="ruby-value">derivative:</span> <span class="ruby-identifier">path</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">action:</span> <span class="ruby-value">:derivatives</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">262</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-upload_derivatives'>
<a name='method-i-upload_derivatives'></a>
<div class='synopsis'>
<span class='name'>upload_derivatives</span><span class='arguments'>(files, **options)</span>

</div>
<div class='description'>

<p>Uploads given hash of files.</p>

<pre class="ruby"><span class="ruby-identifier">hash</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">upload_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span> })
<span class="ruby-identifier">hash</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-upload_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-upload_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">244</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">245</span>   <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">files</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
<span class="line-num">246</span>     <span class="ruby-identifier">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">247</span>   <span class="ruby-keyword">end</span>
<span class="line-num">248</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-url'>
<a name='method-i-url'></a>
<div class='synopsis'>
<span class='name'>url</span><span class='arguments'>(*path, **options)</span>

</div>
<div class='description'>

<p>Allows generating a URL to the derivative by passing the derivative name.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span> })
<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-comment">#=&gt; &quot;https://example.org/thumb.jpg&quot;</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-url-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-url-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>
<span class="line-num">144</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">url</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">145</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">146</span> 
<span class="line-num">147</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">148</span> 
<span class="line-num">149</span>   <span class="ruby-identifier">url</span>   = <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&amp;.<span class="ruby-identifier">url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
<span class="line-num">150</span>   <span class="ruby-identifier">url</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">default_url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>, <span class="ruby-value">derivative:</span> <span class="ruby-identifier">path</span>)
<span class="line-num">151</span>   <span class="ruby-identifier">url</span>
<span class="line-num">152</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
